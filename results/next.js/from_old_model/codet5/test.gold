0	turbopack : more deterministic manifest order ( # 79977 ) fix non - deterministic next font manifest order : ! [ bildschirmfoto 2025 - 05 - 30 um 15 . 41 . 12 . png ] ( https : / / graphite - user - uploaded - assets - prod . s3 . amazonaws . com / sjzsbv6afeudg7gb9rma / e2de4601 - a90e - 41db - ac4c - 7fde7ffec146 . png )
1	turbopack : fix run_once when returning error ( # 84142 ) errors returned from the callback are never read . instead , send errors returned from the ` future ` over the channel .
2	docs : sort and update cms examples ( # 73295 ) # # # what ? add missing related cms examples and sort them . # # # why ? to improve readability and convinience . # # # how ? update with the following text . ` ` ` md - [ agility cms example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - agilitycms ) ( [ demo ] ( https : / / next - blog - agilitycms . vercel . app / ) ) - [ builder . io example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - builder - io ) ( [ demo ] ( https : / / cms - builder - io . vercel . app / ) ) - [ buttercms example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - buttercms ) ( [ demo ] ( https : / / next - blog - buttercms . vercel . app / ) ) - [ contentful example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - contentful ) ( [ demo ] ( https : / / app - router - contentful . vercel . app / ) ) - [ cosmic example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - cosmic ) ( [ demo ] ( https : / / next - blog - cosmic . vercel . app / ) ) - [ datocms example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - datocms ) ( [ demo ] ( https : / / next - blog - datocms . vercel . app / ) ) - [ dotcms example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - dotcms ) ( [ demo ] ( https : / / nextjs - dotcms - blog . vercel . app / ) ) - [ drupal example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - drupal ) ( [ demo ] ( https : / / cms - drupal . vercel . app / ) ) - [ enterspeed example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - enterspeed ) ( [ demo ] ( https : / / next - blog - demo . enterspeed . com / ) ) - [ graphcms example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - graphcms ) ( [ demo ] ( https : / / next - blog - graphcms . vercel . app / ) ) - [ keystone example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - keystonejs - embedded ) ( [ demo ] ( https : / / nextjs - keystone - demo . vercel . app / ) ) - [ kontent . ai example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - kontent - ai ) ( [ demo ] ( https : / / next - blog - kontent - ai . vercel . app / ) ) - [ makeswift example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - makeswift ) ( [ demo ] ( https : / / nextjs - makeswift - example . vercel . app / ) ) - [ plasmic example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - plasmic ) ( [ demo ] ( https : / / nextjs - plasmic - example . vercel . app / ) ) - [ prepr example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - prepr ) ( [ demo ] ( https : / / next - blog - prepr . vercel . app / ) ) - [ prismic example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - prismic ) ( [ demo ] ( https : / / next - blog - prismic . vercel . app / ) ) - [ sanity example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - sanity ) ( [ demo ] ( https : / / next - blog . sanity . build / ) ) - [ sitecore xm cloud example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - sitecore - xmcloud ) ( [ demo ] ( https : / / vercel - sitecore - xmcloud - demo . vercel . app / ) ) - [ storyblok example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - storyblok ) ( [ demo ] ( https : / / next - blog - storyblok . vercel . app / ) ) - [ strapi example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - strapi ) ( [ demo ] ( https : / / next - blog - strapi . vercel . app / ) ) - [ takeshape example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - takeshape ) ( [ demo ] ( https : / / next - blog - takeshape . vercel . app / ) ) - [ tina example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - tina ) ( [ demo ] ( https : / / cms - tina - example . vercel . app / ) ) - [ umbraco example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - umbraco ) ( [ demo ] ( https : / / nextjs - umbraco - sample - blog . vercel . app / ) ) - [ umbraco heartcore example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - umbraco - heartcore ) ( [ demo ] ( https : / / next - blog - umbraco - heartcore . vercel . app / ) ) - [ webiny example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - webiny ) ( [ demo ] ( https : / / webiny - headlesscms - nextjs - example . vercel . app / ) ) - [ wordpress example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / cms - wordpress ) ( [ demo ] ( https : / / next - blog - wordpress . vercel . app / ) ) - [ blog starter example ] ( https : / / github . com / vercel / next . js / tree / canary / examples / blog - starter ) ( [ demo ] ( https : / / next - blog - starter . vercel . app / ) ) ` ` ` # # # improving documentation - [ x ] run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - [ x ] read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com>
3	[ dev - overlay ] fix dark theme missing close bracket ( # 76672 ) # # # why ? the dark theme was broken due to invalid css syntax been shipped at https : / / github . com / vercel / next . js / issues / 76528 . # # # follow up restore the removed vs code extension styled - components as recommended , and apply a real " noop " to css template literals so that it can leverage the extension .
4	[ segment explorer ] fix route url is missing cases ( # 81622 )
5	feat ( next - codemod ) : add ` app - dir - runtime - config - experimental - edge ` ( # 70968 ) # # # why ? we had breaking change in app router at https : / / github . com / vercel / next . js / pull / 70480 where it strictly checks ` runtime ` route segment config . if it is set to ` experimental - edge ` , will throw . therefore we support a codemod to replace it to ` edge ` .
6	allow silencing direct access of dynamic apis to unblock internal sync ( # 70705 )
7	compare error stack to dedupe error ( # 71798 )
8	remove legacy launch configs ( # 67498 ) instead , the launch configs " launch app " , or " launch current directory " can be used .
9	client instrumentation : onroutertransitionstart ( # 77791 ) adds a new api for observing the start of an app router navigation : ` ` ` ts / / <project_root> / instrumentation - client . ts export function onroutertransitionstart ( url : string , navigationtype : ' push ' | ' replace ' | ' traverse ' ) { / / . . . } ` ` ` ` navigationtype ` is one of " push " , " replace " , or " traverse " . this is inspired by the navigation api : https : / / developer . mozilla . org / en - us / docs / web / api / navigateevent / navigationtype ` onroutertransitionstart ` is intended for sending logs to a performance monitoring tool . it is _not_ intended as a general purpose event for implementing application behavior . it fires at the start of every client - side navigation , including those initiated by a popstate ( back / forward ) event . there is no corresponding api for observing the end of a navigation . we intend to build support for this in the future , but it ' s a non - trivial problem space due of the streaming nature of react transitions . refer to the react transition tracing proposal for more details : https : / / github . com / reactjs / rfcs / blob / transition - tracing / text / 0235 - transition - tracing . md ` onroutertransitionstart ` is only called during app router navigations . to instrument pages router navigations , use ` router . events ` .
10	increase retry duration from 3 to 5 seconds in rsc hmr cache tests ( # 70467 ) the compilation for hmr changes often takes around 3 seconds in ci , so we need to increase the duration for the ` retry ` calls to avoid flakiness . [ this test run ] ( https : / / github . com / vercel / next . js / actions / runs / 11036231635 / job / 30654233890 ) shows that it sometimes barely finishes the compilation before the timeout : <img width = " 467 " alt = " screenshot 2024 - 10 - 11 at 19 14 41 " src = " https : / / github . com / user - attachments / assets / faae5593 - 3b03 - 4085 - b3e6 - 54eff5c514bc " > . . . and sometimes it doesn ' t : <img width = " 591 " alt = " screenshot 2024 - 10 - 11 at 19 22 48 " src = " https : / / github . com / user - attachments / assets / 4441b700 - 6c79 - 42dc - bdb6 - abf29d7ceeec " >
11	fix bad decoding for x - matched - path header ( # 78677 ) this is a follow - up to https : / / github . com / vercel / next . js / pull / 78326 which reverts the change that interferes with the added middleware rewrite test while also ensuring the encoding test from the ` vercel / vercel ` repo is still passing as expected . the issue with the encoding seems to be from the ` x - matched - path ` value being incorrectly decoded when using non - utf8 characters so this fixes the encoding . fixes : https : / / github . com / vercel / next . js / actions / runs / 14717733032 / attempts / 2 <details> <summary>test runs with patch< / summary> ! [ cleanshot 2025 - 04 - 29 at 09 21 44 @ 2x ] ( https : / / github . com / user - attachments / assets / de5d66c5 - 5eb2 - 4e87 - 877e - 875a7c937f35 ) ! [ cleanshot 2025 - 04 - 29 at 09 21 51 @ 2x ] ( https : / / github . com / user - attachments / assets / f1743f6c - d06c - 4999 - 869a - 9afaf1b69ab5 ) < / details>
12	turbopack : fix unused import on mac ( # 78341 ) # # # what ? fix an unused import on non - linux platforms
13	turbopack : switch some deps back to upstream ( # 75752 ) our prs were merged there
14	turbopack build : fix metadata test ( # 79776 ) # # what ? changes the test to not use the ` . next ` folder but instead fetch the running server which makes sure it does not rely on specific formats .
15	fix watchmode for ` taskr ` tasks ( # 80020 )
16	update turbopack production test manifest ( # 78697 )
17	test : fix type error in segment - cache - basic test ( # 73755 ) fix type error introduced in # 73540
18	turbopack : debug ids for server chunks ( # 84557 ) looks like # 84319 forgot to enable them for the server chunks
19	add additional handling for experimental tracing ( # 67785 ) this adds additional trace handling under the experimental trace mode . outside of the feature flag the bloom filter for app router paths used in pages to hard navigate was updated to no longer be inlined by default with webpack to avoid invalidating the main bundle for pages too often . instead the bloom filter data is stored in the ` _buildmanifest ` file which is only used in the pages router and is easier to update as it ' s per - build already . this tracing feature is still very experimental and should not be leveraged in production or outside of testing . - - - - - - - - - co - authored - by : zack tanner <1939140 + ztanner @ users . noreply . github . com>
20	[ segment explorer ] reset error and not - found boundary ( # 81115 ) # # # description add a ` key ` prop to the segment state boundary and change the key when we call reset , this way it will force the children re - render with the new state where the boundaries will get reset and the simulated error will be gone since we ' re rendering the page component now . reseting the error boundary only won ' t help , it will still get the error from ` getderivedstatefromerror ` class method and apply to the state . this approach will reset the state group of layout - router , and ensure we keep rendering the page segment ( or anything by default ) . # # # video https : / / github . com / user - attachments / assets / f6fc21da - abc1 - 41fc - 857f - 136a203f6039 closes next - 4583
21	[ cache components ] only validate the shell on ssr render ( # 82381 ) prior to this change on every navigation we would validate that the initial static shell satisified the rules of cache components . this offers more protection as you edit pages but it slows down navigations and we are already concerned with dev speed and the extra cpu contention can potenially hide or exacerbate other performance characteristics you might notice in dev . so for now we will only validate a page on initial load . this means that if you are trying to debug a page ' s static shell suitability you will need to refresh the page not just navigate to and from it .
22	turbopack : make the " non - recursive " logic for the fs watcher a runtime flag instead of a build - time one ( # 82031 ) we use different modes on macos / windows and linux for watching files for performance reasons : https : / / github . com / vercel / turborepo / pull / 4100 now with ` turbo_tasks_force_watch_mode = recursive ` or ` turbo_tasks_force_watch_mode = nonrecursive ` , you can force the watcher into either mode , independent of platform . # # # why ? - platform - specific compilation flags are annoying and it ' s easy to accidentally break compilation on another platform . - it ' s actually really useful to be able to force recursive or non - recursive mode without switching platforms when testing the watcher to narrow down bugs . e . g . on linux : ` ` ` # this fails to receive watch events after directories are added / removed rm - rf / tmp / fuzz & & rust_backtrace = 1 turbo_tasks_force_watch_mode = nonrecursive cargo run - - release - p turbo - tasks - fuzz - - fs - watcher - - fs - root / tmp / fuzz # but this ( simulating the behavior of macos / windows ) works fine rm - rf / tmp / fuzz & & rust_backtrace = 1 turbo_tasks_force_watch_mode = recursive cargo run - - release - p turbo - tasks - fuzz - - fs - watcher - - fs - root / tmp / fuzz ` ` ` - there ' s not all that many places this flag needs to be checked , and compared to the cost of the syscalls happening at those callsites , the impact should be basically zero .
23	docs : fix broken link in architecture / turbopack documentation ( # 71412 ) this pr fixes a broken link ( 404 not found ) in the [ architecture / turbopack ] ( https : / / nextjs . org / docs / architecture / turbopack ) documentation . it appears the actual url differs from the expected one , so i have corrected it to the expected url . expected url : https : / / nextjs . org / docs / canary / architecture / nextjs - compiler # supported - features actual url : https : / / nextjs . org / docs / canary / architecture / docs / canary / architecture / nextjs - compiler # supported - features ! [ image ] ( https : / / github . com / user - attachments / assets / ea63f62d - f00a - 4a02 - a330 - 20be1e8a67c7 ) co - authored - by : jj kasper <jj @ jjsweb . site>
24	only reference published ` @ types / react - dom ` versions ( # 75606 )
25	[ docs ] recommend disabling static analysis to combat build oom if ci already handles that ( # 69186 ) [ preview ] ( https : / / github . com / vercel / next . js / blob / sebbie / 08 - 22 - _docs_recommend_disabling_static_analysis_to_combat_build_oom_iff_ci_already_handles_that / docs / 02 - app / 01 - building - your - application / 06 - optimizing / 13 - memory - usage . mdx # disable - static - analysis ) larger apps may encounter oom in builds during static analysis ( eslint + ts ) . most larger apps already have a dedicated ci which is better suited for these tasks . this may result in deploy of broken builds but so is deploying without waiting for tests . the added section specifically talks about oom and recommends manual promotion after static analysis . how to do ci / cd properly is its own industry though so we shouldn ' t be too opinionated in smaller sections and just describe what tools are available . closes https : / / linear . app / vercel / issue / next - 3690
26	[ turbopack ] fix a few references to caching configuration as it is no longer canary guarded ( # 84761 )
27	stabilize node middleware support ( # 81907 ) as mentioned in our last blog post we are going to be stabilizing node middleware now so this removes the experimental flag canary gating the feature .
28	test : remove deleted examples ( # 72374 ) # summary update [ ` example . test . ts ` ] ( https : / / github . com / vercel / next . js / blob / canary / test / examples / examples . test . ts ) and [ ` turbopack - dev - examples - manifest . json ` ] ( https : / / github . com / vercel / next . js / blob / canary / test / turbopack - dev - examples - manifest . json ) by removing deleted examples . # # descriptions [ examples : cleanup # 57845 ] ( https : / / github . com / vercel / next . js / pull / 57845 ) deleted . . . - amp - first - amp - story - data - fetch - fast - refresh - demo - hello - world - esm - progressive - render - using - router - with - app - layout - with - env - from - next - config - js - with - loading [ updated the example of modularize - imports to utilize the app router # 69771 ] ( https : / / github . com / vercel / next . js / pull / 69771 ) deleted . . . - modularize - imports [ docs : add docs on csp and nonce generation # 54601 ] ( https : / / github . com / vercel / next . js / pull / 54601 / files ) deleted . . . - styled - jsx - with - csp [ updated the example of with - draft - js to utilize the app router . # 70045 ] ( https : / / github . com / vercel / next . js / pull / 70045 ) deleted . . . - with - draft - js [ remove deprecated library example # 62813 ] ( https : / / github . com / vercel / next . js / pull / 62813 ) deleted . . . - with - react - with - styles [ remove with - reasonml - todo example # 62812 ] ( https : / / github . com / vercel / next . js / pull / 62812 / files ) deleted . . . - with - reasonml - todo [ remove with - semantic - ui example # 62811 ] ( https : / / github . com / vercel / next . js / pull / 62811 / files ) deleted . . . - with - semantic - ui [ updated the example of with - vercel - fetch to utilize the app router . # 70069 ] ( https : / / github . com / vercel / next . js / pull / 70069 ) deleted . . . - with - vercel - fetch co - authored - by : jj kasper <jj @ jjsweb . site>
29	fix ( turbopack ) : apply ` import_map ` option of ` swc_emotion ` correctly ( # 71776 ) # # # what ? preserve the ` import_map ` config specified by the user # # # why ? the default mode ( webpack mode ) supports the ` import_map ` config , so turbopack should also support it . # # # how ? closes https : / / github . com / vercel / next . js / issues / 71408
30	docs : fix vitest manual setup ( # 73754 ) co - authored - by : lee robinson <me @ leerob . io>
31	[ dev - overlay ] deprecate ` devindicators . buildactivityposition ` and rename to ` position ` ( # 76069 ) # # # why ? since the ` buildactivity ` is deprecated at # 76067 , ` buildactivityposition ` may also be deprecated . however , we are planning to preserve the option to position the dev indicator . therefore , this pr adds a new option ` position ` and deprecates and aliases the ` buildactivityposition ` to ` position ` . # # # success criteria deprecation : - [ x ] does using ` buildactivityposition ` show a deprecation warning ? - [ x ] does ` buildactivityposition ` have a deprecation in jsdoc ? alias : > is it backward compatible with the old overlay ? - [ x ] does setting ` buildactivityposition ` correctly set the build activity indicator position ? - [ x ] does it warn if ` buildactivityposition ` is set instead of ` position ` ? - [ x ] does ` buildactivityposition ` supersede ` position ` value to prevent breaking change ? - [ x ] does setting the ` position ` correctly set the build activity indicator position ? # # # follow up in the following prs , we will add the behavior for ` position ` to adjust the dev indicator ' s position . after removing the old overlay ' s sources , we can remove any logic that ` buildactivityposition ` was holding for the old overlay and make it fully an alias for backwards compatibility . closes ndx - 837
32	[ test ] add test for dev rendering indicator ( # 80205 ) automated test for https : / / github . com / vercel / next . js / pull / 74833
33	turbopack : leave ` chunks ` in ` rscmodulemapping ` empty ( # 79511 ) previously , ` clientreferencemanifest . rscmodulemapping . * . chunks ` would list the rsc entry , such as ` server / app / encryption / page . js ` which contains ` ` ` js const chunk_public_path = " server / app / encryption / page . js " ; const runtime = require ( " . . / . . / chunks / ssr / [ turbopack ] _runtime . js " ) ; runtime . loadchunk ( " server / chunks / ssr / [ root - of - the - server ] __a810eacb . _ . js " ) ; runtime . loadchunk ( " server / chunks / ssr / _7a4bd82c . _ . js " ) ; runtime . loadchunk ( " server / chunks / ssr / test_e2e_app - dir_actions_app_not - found_b8caa540 . js " ) ; runtime . loadchunk ( " server / chunks / ssr / packages_next_dist_client_components_1d957a03 . _ . js " ) ; runtime . loadchunk ( " server / chunks / ssr / packages_next_dist_client_components_unauthorized - error_4ad694c5 . js " ) ; runtime . loadchunk ( " server / chunks / ssr / _0aa93936 . _ . js " ) ; runtime . getorinstantiateruntimemodule ( " [ project ] / test / e2e / app - dir / actions / . next - internal / server / app / encryption / page / actions . js { actions_module0 = > \ " [ project ] / test / e2e / app - dir / actions / app / encryption / page . js [ app - rsc ] ( ecmascript ) \ " } [ app - rsc ] ( server actions loader , ecmascript ) " , chunk_public_path ) ; runtime . getorinstantiateruntimemodule ( " [ project ] / packages / next / dist / esm / build / templates / app - page . js ? ? page = / encryption / page { module_0 = > \ " [ project ] / test / e2e / app - dir / actions / app / layout . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_1 = > \ " [ project ] / test / e2e / app - dir / actions / app / not - found . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_2 = > \ " [ project ] / packages / next / dist / client / components / forbidden - error . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_3 = > \ " [ project ] / packages / next / dist / client / components / unauthorized - error . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_4 = > \ " [ project ] / test / e2e / app - dir / actions / app / encryption / page . js [ app - rsc ] ( ecmascript , next . js server component ) \ " } [ app - rsc ] ( ecmascript ) " , chunk_public_path ) ; module . exports = runtime . getorinstantiateruntimemodule ( " [ project ] / packages / next / dist / esm / build / templates / app - page . js ? ? page = / encryption / page { module_0 = > \ " [ project ] / test / e2e / app - dir / actions / app / layout . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_1 = > \ " [ project ] / test / e2e / app - dir / actions / app / not - found . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_2 = > \ " [ project ] / packages / next / dist / client / components / forbidden - error . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_3 = > \ " [ project ] / packages / next / dist / client / components / unauthorized - error . js [ app - rsc ] ( ecmascript , next . js server component ) \ " , module_4 = > \ " [ project ] / test / e2e / app - dir / actions / app / encryption / page . js [ app - rsc ] ( ecmascript , next . js server component ) \ " } [ app - rsc ] ( ecmascript ) " , chunk_public_path ) . exports ; ` ` ` the problem is that this chunk ( turbopack calls them " entry chunk " ) exports some entry point , as opposed to the usual chunk which does ` module . exports = { 19285 : function ( ) { } , . . . } ` to export the module factories ( called an " evaluated chunk " ) if you use ` __turbopack_load__ ` to load an entry chunk , stuff breaks because you end up with the entry module ' s exports in the module factory map . hendrik confirmed that webpack also doesn ' t specify any chunks in here , they are already loaded anyway . then this case of ` __turbopack_load__ ` ing an entry chunk never occurs .
34	upgrade react from ` e2332183 - 20250924 ` to ` b0c1dc01 - 20250925 ` ( # 84248 ) [ diff facebook / react @ e2332183 . . . b0c1dc01 ] ( https : / / github . com / facebook / react / compare / e2332183 . . . b0c1dc01 ) <details> <summary>react upstream changes< / summary> - https : / / github . com / facebook / react / pull / 34601 - https : / / github . com / facebook / react / pull / 34552 - https : / / github . com / facebook / react / pull / 34524 - https : / / github . com / facebook / react / pull / 34587 - https : / / github . com / facebook / react / pull / 34589 - https : / / github . com / facebook / react / pull / 34585 - https : / / github . com / facebook / react / pull / 34586 < / details>
35	enable anonymous function naming in react compiler ( # 84070 ) co - authored - by : benjamin woodruff <benjamin . woodruff @ vercel . com>
36	fix ` use server ` diagnostics for type exports ( # 74256 ) # # # what ? nextjs should not throw ` the " use server " file can only export async functions . ` for type exports . # # # why ? because type exports are just a compile time abstraction .
37	[ test ] use new redbox matchers in app / dynamic - error - trace ( # 76783 )
38	turbopack : turn panic into bail ( # 84927 ) eventual consistency strikes again
39	turbopack : make ` turbo - tasks ` crate rust 2024 ( # 79127 ) marked ` extern ` blocks as ` unsafe extern `
40	[ devtools ] remove unused code ( # 82299 )
41	sitemap video tag support ( # 69349 ) co - authored - by : sam ko <sam @ vercel . com> co - authored - by : jiachi liu <inbox @ huozhi . im>
42	turbopack : fix duplicate unsupported edge import modules ( # 78236 ) 1 . add the import in question to the module ident : ` [ project ] / test / e2e / on - request - error / isr ( unsupported edge import fs ) ` 2 . wrap the source creation into a separate turbotask , so that ` fs ` and ` fs / promises ` get the same source cell ( instead of two different sources with the same ident )
43	fix ( react - compiler ) : fix detection of interest ( # 78874 ) # # # what ? mark function components declared as a variable interesting # # # why ? because those are also react components # # # how ? - closes swc - 646 - closes https : / / github . com / vercel / next . js / issues / 78867
44	fix : remove useless set - cookie in action - handler ( # 76839 ) ` handleaction ` had a weird spot where it ' d add a ` set - cookie ` header if a redirect was thrown during handling a no - js action . afaict , this is unnecessary - - we set the ` set - cookie ` header on the response as soon as ` cookies ( ) . set ( ) ` is called , so there ' s no need to set the cookies again in that branch of the handler . this is done through a combination of the patched setter from ` requestcookies ` : https : / / github . com / vercel / next . js / blob / 0abd87717f19bced6c35af1255837628513cf772 / packages / next / src / server / web / spec - extension / adapters / request - cookies . ts # l160 - l171 and this cookie updating function from the request store ( which ` updateresponsecookies ` above would invoke with the new cookies ) : https : / / github . com / vercel / next . js / blob / 0abd87717f19bced6c35af1255837628513cf772 / packages / next / src / server / async - storage / request - store . ts # l170 - l174 i ' ve also added a test for this specific scenario to ensure that this wasn ' t actually doing anything useful .
45	refactor ( turbo - tasks ) : port task statistics to the new backend ( # 75303 ) this was available on the old memory backend , this ports it to the new backend , which is important now that it ' s the default . plus , the code ' s cleaner now that the trait resolution hack i had was cleaned up in # 75214 !
46	improved network url in ( dev ) cli ( # 72634 ) continues : https : / / github . com / vercel / next . js / pull / 57882 with added test and rebased history closes : https : / / github . com / vercel / next . js / pull / 57882 - - - - - - - - - co - authored - by : ward werbrouck <34573943 + kletse @ users . noreply . github . com>
47	use fs and vm for async chunk loading in node ( vercel / turbo # 8722 ) # # # description use ` fs ` and ` vm ` when loading chunks asynchronously in node , to not block the thread while reading large chunks closes pack - 411 # # # testing instructions using the ` test / e2e / app - dir / dynamic / ` next . js tests
48	[ test ] add repro for ssr bug when large chunks are deferred in flight ( # 80661 )
49	chore : port more nextpack scripts ( # 68586 ) # # # what ? ports a few more useful scripts from nextpack , namely : - ` patch - next ` - ` sweep ` - ` build - native ` ( to clean up incremental artifacts on compiler panics ) - the macos compression agent
50	fix : add whitespace before seconds in trace - to - tree output ( # 67593 ) # # # what ? adds a whitespace character before seconds output of ` scripts / trace - to - tree . mjs ` # # # why ? i was regexing a big output , looking for sources of slowness and failed to do so because ` \ss ` would not find anything , whist ` \sms ` would , because it printed whitespace before ` ms ` but not before ` s ` . co - authored - by : jj kasper <jj @ jjsweb . site>
51	remove experimental appdocumentpreloading ( # 82895 ) # # what ? this functionality has been succeeded by experimental . preloadentriesonstart which is enabled by default . ` preloadentriesonstart ` can likely also be removed as an option given that it ' s ` true ` since 16 months ago . but that ' s for another pr .
52	[ sourcemaps ] improve ignore - listing performance ( # 81311 ) this improves performance of finding the relevant section in index source maps by using binary search ( o ( n ) - > o ( log n ) ) . this allows us to improve the performance of the fast path for checking if a source is ignore - listed in index source maps : instead of checking if every section in index source maps ignores everything , we just find the relevant section ( now o ( log n ) instead of o ( n ) ) and check if that section ignores everything .
53	update rspack development test manifest ( # 82526 ) this auto - generated pr updates the development integration test manifest used when testing rspack .
54	implement runtime prefetching via segment opt - in ( # 83072 ) follow - up to # 82905 . when prefetching a link , we should perform a runtime prefetch for any segment that - has runtime prefetching enabled - is not a shared layout or - is a child of a segment that meets the above criteria . anything that doesn ' t meet those criteria will be prefetched statically , i . e . the behavior before this pr . in other words , we disregard the ` prefetch ` config of shared layouts when deciding whether to perform a runtime prefetch . this means if you opt into runtime prefetching in a layout , navigating to a page inside that layout for the first time will perform a runtime prefetch , but navigating across multiple pages inside that layout will be static ( until / unless there ' s a child that has also opted into runtime prefetching ) . for example , given a route structure like ` / store / [ id ] ` , where ` / store / layout . tsx ` has runtime prefetching enabled , but ` / store / [ id ] / page . tsx ` does not : - a link from ` / home ` to ` / store / 1 ` results in a * * runtime prefetch * * - a link from ` / store / 1 ` to ` / store / 2 ` results in a * * static prefetch * * if we didn ' t make this distinction , then opting into prefetching in a layout would override the config of everything inside it . ( however , the most common pattern will be to set this config at the page level , where the distinction doesn ' t matter , since there are no child segments . ) - - - - - - - - - co - authored - by : janka uryga <lolzatu2 @ gmail . com>
55	turbopack : remove unused ` ignored_subpaths ` feature from diskwatcher ( # 82210 ) this feature is unused , but i think there are also significant problems with it , which would require work for it to be used : - the ` vec ` isn ' t very scalable and that could be a footgun . it should be an ` auto_hash_map : : autoset ` or a ` fxhashset ` . - it ' s unclear that _just_ ignoring watch events is a good idea . i understand that we don ' t want to allow source code to depend on outputs , but it seems like it would be better to prevent reads in the first place in the ` diskfilesystem ` ( e . g . pretend the file doesn ' t exist and emit an issue ) . this would not require support from the watcher , as we just wouldn ' t create the invalidator at all . - there ' s no test coverage of this feature .
56	revert " [ next - lint ] test : remove eslint config snapshot testing " ( # 77824 ) co - authored - by : sebastian sebbie silbermann <sebastian . silbermann @ vercel . com>
57	build ( turbopack ) : update ` swc_core ` to ` v30 . 0 . 1 ` ( # 81179 ) # # # what ? changelog : https : / / github . com / swc - project / swc / compare / swc_core % 40v29 . 4 . 2 . . . swc_core % 40v30 . 0 . 1 # # # why ? apply https : / / github . com / swc - project / swc / pull / 10754 to fix preset - env
58	docs ( terminal ) : fix wrong terminal command and add missing hash symbols ( # 71180 ) # # ðŸ“š improving documentation hello , i ' ve corrected an incorrect terminal command and added missing hash ( ` # ` ) symbols in the ` next . mdx ` file . # # # 1 . terminal command the ` npm run ` command is for running scripts , so using it in this context doesn ' t work properly . additionally , [ ` create - next - app ` ] ( https : / / nextjs . org / docs / app / api - reference / cli / create - next - app ) also uses ` npx ` instead of ` npm run ` . ! [ image ] ( https : / / github . com / user - attachments / assets / d678f8b6 - ff13 - 436b - 9a93 - 0c3efac7b6df ) # # # 2 . missing hashes of links some links were missing the ` # ` symbol , preventing users from navigating the document properly . co - authored - by : jj kasper <jj @ jjsweb . site>
59	[ turbopack ] no op the webpack bundle analyzer under turbopack ( # 84614 ) this never worked with turbopack , but with the recent default flip using this now breaks the build since it complains about configuring webpack in a turbopack build . so print a warning and no - op the analyzer . this isn ' t ideal but it is more actionable than a crash for users .
60	update typo in authentication docs ( # 69966 ) improved page copy for a better understanding of its text . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - > co - authored - by : jj kasper <jj @ jjsweb . site>
61	docs ia 2 . 0 : add ` caching and revalidating ` page ( # 79493 ) closes : https : / / linear . app / vercel / issue / doc - 3700 / getting - started - caching - and - revalidating - page redirects : https : / / github . com / vercel / front / pull / 46120
62	[ link ] add prefetch = " auto " option ( # 78689 ) adds a " auto " as a valid value for the ` <link> ` component ' s prefetch prop . it acts as an alias for the default behavior , i . e . same as no prefetch prop at all . - - - a common source of confusion is the difference between ` <link> ` , ` <link prefetch = { null } > ` , and ` <link prefetch = { boolean } > ` : - ` prefetch = { true } ` â†’ dynamically prefetch the whole page - ` prefetch = { false } ` â†’ disable prefetching entirely - no prop , ` prefetch = { null } ` , ` prefetch = { undefined } ` â†’ default behavior if you want to conditionally opt into dynamic prefetching , you have to write something like this : ` ` ` <link prefetch = { shoulddynamicallyprefetch ? true : null } > ` ` ` after this pr , you can do this instead : ` ` ` <link prefetch = { shoulddynamicallyprefetch ? true : ' auto ' } > ` ` ` it ' s still a bit confusing if you aren ' t aware of the subtleties of dynamic versus static prefetching , but at least the " auto " string gives slightly more of a hint that ` true ` is different from the default . ( in retrospect , we probably should have made ` true ` an alias for the default , and chosen a separate value to opt into dynamic . )
63	docs : fix typo ( # 80501 )
64	docs ( cli ) : add mention of default port with experimental - https ( # 70497 ) # # why ? there is no mention of what the default port is when you ` next dev - - experimental - https ` . x - ref : https : / / x . com / rauchg / status / 1839092783392632867 - - - - - - - - - co - authored - by : will binns - smith <wbinnssmith @ gmail . com>
65	updated the environment variables examples to utilize the app router ( # 70392 ) this pr updates the ` environment - variables ` example to use the app router . here are the changes that have been made : - created an ` app ` folder and added ` page . tsx ` file . - added ` layout . tsx ` file - updated the ` readme . md ` file . - updated the ` package . json ` file . cc : @ samcx - - - - - - - - - co - authored - by : samcx <sam @ vercel . com>
66	ensure resolvedpathname normalizes trailing slash ( # 81265 ) fixes case with trailing slash from refactoring done in https : / / github . com / vercel / next . js / pull / 81144
67	turbopack : handle non chunkable modules in module batches ( # 77282 ) # # # what ? fix the handling of non - chunkable modules in module batches
68	react sync : reduce manual tasks ( # 66095 )
69	disable fetch cache size limit for implicit caching during build ( # 80480 ) during build - time prerendering , when we ' re only caching ` fetch ` calls implicitly to improve build performance , and not because the user has explicitly opted into fetch caching , we should not enforce the 2mb size limit . 1 . the size limit is not required of the file - system - based cache that ' s used at build time . 2 . the warning is not helpful to users , as they are not aware of the implicit caching behavior . related prs : - https : / / github . com / vercel / next . js / pull / 68546 - https : / / github . com / vercel / next . js / pull / 79384
70	enable mcp server by default ( # 85058 )
71	docs ( typo ) : fix typos in ` turbo . mdx ` ( # 71188 ) # # ðŸ“š improving documentation hello , i ' ve fixed some typos in ` turbo . mdx ` . 1 . ` css ` - > ` css ` 2 . delete ` d ` . i think it is a typo . 3 . delete ` s ` . it ' s a typo too .
72	use prefer offline flag for ci ( # 74663 ) aims to speed up ci by avoiding checking npm registry un - necessarily for every test run since we mostly hard code our test package versions when the version matters .
73	add support for ignore - listing sources in index maps ( # 72913 ) we now look through each section for the source and use that section to determine if a frame is ignore - listed . previously , stacks from turbopack sourcemaps were not ignore - listed since they were index maps .
74	babel - loader : avoid calling expensive ` isreactcompilerrequired ` check when we must run babel anyways ( # 84103 ) this check uses swc , so it ' s expensive . this can be worth it if it lets us avoid running babel entirely , but if you ' ve got a custom babel config , we ' re forced to run babel anyways , so it ' s probably not worth it in that case .
75	skip ` build_and_deploy ` on docs - only changes ( # 73659 )
76	remove ` internal_disablesyncdynamicapiwarnings ` flag ( # 75231 )
77	[ segment explorer ] builtin slots style ( # 80972 ) show builtin slots with a style showing that component is possible for users to customize ! [ image ] ( https : / / github . com / user - attachments / assets / 60351baf - ed0b - 44fb - 8ede - 754b79b16dde ) closes next - 4540
78	docs : add ppr page to getting started section ( # 79076 ) closes : https : / / linear . app / vercel / issue / doc - 4653 / partial - prerendering related : https : / / linear . app / vercel / issue / doc - 4555 / ppr - and - dio redirects : https : / / github . com / vercel / front / pull / 45481 - creates a placeholder page for ppr in getting started . - reviews and updates content - adds examples
79	[ turbopack ] add a startup cache which caches the first 100mb of accessed data ( # 71431 ) # # # what ? when the os filesystem cache is cold , accessing the database can be quite slow and add a few seconds of build time since database is accessed kind of randomly . this adds a cache file on top of the key value database which caches the first 100mb of data accessed from the database and puts it into a separate file . that file is sequentially read and pulled into memory on startup .
80	turbopack : implement hmr for module - scoped environment variable changes ( # 68209 ) while we currently refetch rsc updates on changes to the environment ( e . g . ` . env ` files ) , we never cleared the require cache to re - evaluate rscs with the new environment . this implements that . test plan : added tests . ` turbopack = 1 pnpm test - dev test / development / app - hmr / hmr . test . ts `
81	partial fallback prerendering ( # 68958 ) this work introduces the new concept of * * partial fallback prerendering ( pfpr ) * * . traditionally , when a dynamic page needed to be routed to that wasn ' t pregenerated , it required a render to generate even the first few bytes of the static page itself . this resulted in slow page loads for pages not frequently visited and a reduced time to first byte ( ttfb ) score on core web vitals ( cwv ) . pfpr takes advantage of the new systems of partial prerendering ( ppr ) that allows the application to suspend at different points mid - render , and resume it later . we mark any unknown parameter access as dynamic access , and suspend the rendering up to the next suspense boundaries at those points . under ideal conditions ( correctly placed ` <suspense / > ` boundaries or ` loading . jsx ` files ) this generates a static shell that can be served to users as soon as the request hits next . js , right out of the static cache . this minimizes the ttfb for all requests , dynamic or not for those pages that enable ppr . for example , the following page would create a usable shell : ` ` ` jsx / / / app / users / [ userid ] / page . jsx import { suspense } from ' react ' function profile ( { params } ) { const { userid } = params return <div>hello { userid } ! < / div> } export default function profilepage ( { params } ) { return ( <div> <h1>user profile< / h1> <suspense fallback = " loading . . . " > <profile params = { params } / > < / suspense> < / div> ) } ` ` ` due to the way that suspense works within react components , access of params within the root page component would cause the whole page to suspend . thankfully , that ' s where the ` loading . jsx ` comes in handy . adding a ` loading . jsx ` at a segment will automatically wrap the ` page . jsx ` with a suspense boundary , setting the contents of the root ` loading . jsx ` as the fallback component to use for it . this lets you maintain your existing style of accessing parameters at the root of the components while also taking advantage of pfpr . to enable this feature , you first need to enable both ppr and pfpr : ` ` ` js module . exports = { experimental : { ppr : true , pprfallbacks : true , } } ` ` ` once pfpr has stabilized with hosting providers , the experimental flag will go away and it will become the default with the ppr flag .
82	update rust toolchain to nightly - 2024 - 05 - 31 ( # 66428 ) depends on https : / / github . com / vercel / turbo / pull / 8256
83	[ test ] keep playwright stackframes out of tests ( # 81240 )
84	disable failed scroll restoration warning ( # 74875 ) we already know all the cases where we currently fail to restore scroll ( https : / / github . com / vercel / next . js / pull / 74751 / ) . users cannot work around this warning so it ' s pure noise .
85	chore : remove ` " ` from github issue template ( # 71055 ) just get rid of unwrapped ` " ` . co - authored - by : jj kasper <jj @ jjsweb . site>
86	fix : add aria - hidden to error overlay voting icons ( # 74568 ) # # what ? added accessibility improvements to the error overlay voting buttons by making their icons properly hidden from screen readers . # # why ? to enhance accessibility for users relying on screen readers by preventing redundant icon announcements while maintaining the clear button labels " mark as helpful " and " mark as not helpful " . # # how ? - added ` componentprops< ' svg ' > ` type to thumbsup and thumbsdown components to allow passing svg attributes - spread props to svg elements to enable aria attributes - added test coverage to ensure icons have ` aria - hidden = " true " `
87	enable repeated ` tsc ` runs in ` packages / next ` without having to build first ( # 79782 )
88	[ codemod ] install eslint v9 if version under for next - lint - to - eslint - cli ( # 85182 ) when running ` next - lint - to - eslint - cli ` and eslint version lower than 9 , upgrade to ` ^ 9 ` to ensure full flat config support .
89	port toolbuttonsgroup ( # 74099 ) ported the toolbuttonsgroup : ! [ cleanshot 2024 - 12 - 19 at 06 41 51 ] ( https : / / github . com / user - attachments / assets / 11ac5d7e - 057a - 4bdc - bf0e - 313410046612 )
90	chore ( examples ) : update reproduction template ( # 66301 ) # # why ? we get this error when we use ` npx ` to download the reproduction - template . ! [ cleanshot 2024 - 05 - 28 at 17 25 40 @ 2x ] ( https : / / github . com / vercel / next . js / assets / 28912696 / a2f3c3ce - 1a2c - 4629 - 9914 - 9e88bb9c9632 ) updating the template should fix this error .
91	build ( turbopack ) : update ` swc_core ` to ` v26 . 3 . 3 ` ( # 80059 ) # # # what ? update swc_core to ` v26 . 3 . 2 ` changelog : https : / / github . com / swc - project / swc / compare / swc_core % 40v26 . 2 . 2 . . . swc_core % 40v26 . 3 . 3 # # # why ? to apply https : / / github . com / swc - project / swc / pull / 10543
92	unflake ` ppr - full ` tests ( # 76271 ) [ flakiness metric ] ( https : / / app . datadoghq . com / ci / test / runs ? query = test_level % 3atest % 20env % 3aci % 20 % 40git . repository . id % 3agithub . com % 2fvercel % 2fnext . js % 20 % 40test . service % 3anextjs % 20 % 40test . status % 3afail % 20 % 40test . name % 3a % 2appr - full % 2a % 20 % 28 - % 40git . branch % 3a % 2a % 3f % 2a % 20or % 20 % 40git . branch % 3acanary % 29 & agg_m = count & agg_m_source = base & agg_t = count & citest_explorer_sort = timestamp % 2casc & cols = % 40test . status % 2ctimestamp % 2c % 40test . suite % 3a83 % 2c % 40test . name % 3a607 % 2c % 40git . branch & currenttab = overview & eventstack = & fromuser = false & graphtype = flamegraph & index = citest & start = 1737457116609 & end = 1740049116609 & paused = false ) this attempts to fix the flakiness of two things in the ` ppr - full ` test suite ( there might be more ) : - omit tests that rely on a route shell being cached from deploy tests , similar to # 72428 . - increase revalidate times from 60 to 120 to avoid the headers tests from receiving a ` stale ` response instead of the expected ` hit ` response .
93	remove ` clientparamparsing ` configuration & bundle it with ` cachecomponents ` ( # 84763 ) we can ' t optionally land this flag in ` cachecomponents ` so this ensures it ' s enabled when using that flag . we still keep around ` rsc . clientparamparsing ` as the vercel cli still reads from it to opt into some additional routing configuration , which can be removed in the future .
94	docs : remove a duplicated word in redirect code comment ( # 74043 ) # # # what ? typo in code comment co - authored - by : jj kasper <jj @ jjsweb . site>
95	update sanity example deps and implementation ( # 65744 ) - uses the new ` presentationtool . resolve . locations ` instead of ` presentationtool . locate ` api , which doesn ' t require wrangling ` rxjs ` . - sets up the new ` presentationtool . resolve . maindocuments ` api , which automatically opens up the post you ' re previewing on the left side in the editor on the right side . - removes the ` sanity - typegen . json ` config file as ` sanity typegen ` now looks for top level ` app ` and ` sanity ` folders by default . - enables ` ^ ` semver ranges for deps again now that our turbopack support is stable , so that we only have to send you prs when bumping majors or changing the implementation itself . - sets up ` sanity . config . ts ` so it ' s possible to use ` npx sanity dev ` for quickly iterating on schemas .
96	docs : fix typo on file extensions ( # 68043 )
97	[ ppr ] move resume data cache into postponed state ( # 72284 ) in order to take advantage of the existing plumbing of the postponed state , we ' re injecting the resume data cache into the postponed state itself , as the data is always co - located . this ensures that stale resumes can utilize the data out of the box without any additional infrastructure configuration .
98	allow usage of node . js prereleases ( # 72635 ) local builds of node . js will be considered prereleases e . g . a local build of node . js will have ` 24 . 0 . 0 - pre ` as their version . now these versions are accepted as long as their base version still matches .
99	[ turbopack ] fix bug in the new backend that connects edges incorrectly ( # 72324 ) # # # what ? fixes some bugs in the new backend that causes and incorrect aggregated graph , which leads to task not being scheduled . also renames some stuff to make it more clear . closes pack - 3383
100	skip failing test via manifest instead ( # 78161 ) skip another test via the manifest instead turbopack still doesn ' t print the ` middleware contains invalid middleware config : expected string ` error closes # 76979
101	update 04 - linking - and - navigating . mdx , partial rendering , explain about unmounting and losing state ( # 70397 ) # # # what ? update 04 - linking - and - navigating . mdx , 4 . partial rendering section , add information that rerenders of sibling routes mean full rerender of the page , unmounting and losing the state of the page # # # why ? i ' ve spent a lot of time trying to understand why in the app router when switching between sibling routes ( and dynamic segments ) i lose scroll position . finally , find a discussion that this is the intentional behaviour of the next . js team . would be good if the next . js users could find information in the documentation instead of searching for issues and discussions in the documentation . https : / / github . com / vercel / next . js / discussions / 50711 # # # how ? updated docs - - - - - - - - - co - authored - by : jj kasper <jj @ jjsweb . site>
102	codemod : handle the async api type ( # 70785 )
103	enable source maps for ` pnpm debug ` ( # 71653 ) now ` pnpm debug ` is like ` pnpm next ` with ` node_options = - - inspect `
104	update turbopack production test manifest ( # 69214 ) this auto - generated pr updates the production integration test manifest used when testing turbopack .
105	perf ( turbopack ) : decode sourcemap partially ( # 80177 ) # # # what ? use the forked version of ` sourcemap ` . we can improve performance by utilizing https : / / github . com / kdy1 / rust - sourcemap / pull / 1 # # # why ? it ' s much faster . 3 % ~ 12 % build performance improvement ! [ image ] ( https : / / github . com / user - attachments / assets / f664fc4c - 4ce2 - 4b2c - ab29 - 3a860ed24da7 ) # # # how ?
106	docs ( generate - static - params ) : add typescript example and missing jsx switcher ( # 73962 ) hi team . this pr enhances the generate static pararms documentation by adding typescript examples , and adding missing jsx switcher code blocks , which previously caused some content to disappear when switching to javascript due to the absence of corresponding jsx examples . co - authored - by : jj kasper <jj @ jjsweb . site>
107	feat ( test ) : introduce cache components testing infrastructure ( # 81394 ) # # # what ? introduces a testing infrastructure to validate next . js behavior with the experimental cache components feature ( ` dynamicio ` ) enabled . this pr adds dedicated ci jobs and configuration to run a subset of existing tests with cache components activated . this has 271 more disabled test suites than the legacy ppr test suite manifest . the expectation is that we will be resolving the test failures in followup prs . # # # why ? cache components ( dynamicio ) represents a significant architectural change in how next . js handles component caching and rendering . to ensure a smooth transition when this becomes the default behavior , we need to : 1 . * * validate compatibility * * - ensure existing applications continue to work correctly when cache components is enabled 2 . * * identify edge cases * * - catch potential issues early by running tests in this new mode 3 . * * build confidence * * - provide a safety net for the eventual migration to cache components as the default the manifest - based approach allows us to incrementally expand test coverage as we fix compatibility issues , rather than attempting to run all tests at once which would be overwhelming and block progress . # # # how ? - * * test manifest * * ( ` test / cache - components - tests - manifest . json ` ) : defines which tests to run and tracks known failures that need addressing - * * ci workflow changes * * : adds three new job groups that mirror existing test jobs but with cache components enabled : - ` test - cache - components - integration ` - ` test - cache - components - dev ` ( parallelized across 6 groups ) - ` test - cache - components - prod ` ( parallelized across 7 groups ) - * * conditional feature activation * * : when ` __next_experimental_cache_components = true ` is set during testing , ` dynamicio ` is automatically enabled unless explicitly disabled - * * test adjustments * * : updates error message expectations in tests to handle the different environment label ( " prerender " vs " server " ) when cache components is active the infrastructure is designed to be temporary and will be removed once cache components becomes the default behavior . nar - 172
108	refactor ( turbo - tasks ) : remove public operationvc constructor , introduce a macro annotation for creating operationvc types ( # 72871 ) introduces a new ` operation ` argument to the ` # [ turbo_tasks : : function ] ` macro for creating functions that return ` operationvc ` : ` ` ` / / this function ' s external signature returns an ` operationvc ` # [ turbo_tasks : : function ( operation ) ] async fn multiply ( value : operationvc<i32> , coefficient : i32 ) - > result<vc<i32>> { ok ( vc : : cell ( * value . connect ( ) . await ? * coefficient ) ) } ` ` ` this is important to solve a few major footguns with manually - constructed ` operationvc ` s : - it can be hard to know if a ` vc ` is an operation or not , and the only warning you ' d get if you got it wrong was a runtime error . - local - task - based resolution ( # 69126 ) will implicitly create local ` vc ` s if an argument isn ' t resolved . - ~ we want to enforce that all arguments to ` operationvc ` - returning functions are also ` operationvc ` s or non - ` vc ` values . otherwise you could end up with a stale / wrong ` operationvc ` . ~ scrapped , this was too hard / impractical , see below . this removes the public constructor . methods are not currently supported because : 1 . operations are uncommon , and it ' s not worth the effort , imo . 2 . there ' s no way to make it work for dynamic - dispatched method calls , as we cannot resolve the type of ` self ` . it could be made to work for inherent impls and non - object trait types . - - - this is basically implementing @ sokra ' s todo comment in the old ` operationvc : : new ` constructor : ` ` ` / / todo to avoid this runtime check , we should mark functions with ` ( operation ) ` and return / / a operationvc directly ` ` ` but with assertions for the function arguments , based on some discussion in dms : <img src = " https : / / graphite - user - uploaded - assets - prod . s3 . amazonaws . com / hazvitxrnnzz8qmipn4a / 13952614 - f421 - 4c8a - 99b8 - 3ce5f19715ae . png " width = " 600 " / > we allow * either * ` resolvedvc ` or ` operationvc ` as arguments because : - only accepting ` operationvc ` arguments was impossible to refactor to , as this made it " viral " and there are too many places where we need to use operations that have too many dependencies . - while it makes sense for ` state ` to require ` operationvc ` as arguments to any operation ( keeps the whole dependency / call tree alive ) , for collectibles , sometimes you want the arguments to be ` resolvedvc ` . it ' s just a matter of if you want to include collectibles generated when creating the arguments or not .
109	fix ( turbopack ) : use strongly consistent reads for sourcemaps in napi ffi boundary ( # 77511 ) all turbo - task reads from an ffi boundary must be strongly - consistent . otherwise , we might propagate errors due to inconsistent cell state . we suspect it ' s the root cause for this : https : / / vercel . slack . com / archives / c04mkmsev3k / p1742874851690489
110	ensure issue overlay sourcemaps externals in turbopack ( # 73439 ) closes https : / / linear . app / vercel / issue / ndx - 473 /
111	fix : throw error during build when invalid export for proxy ( # 84886 ) # # # why ? when proxy / middleware had invalid exports ( valid : named function ` proxy ` for ` proxy . js ` , named function ` middleware ` for ` middleware . js ` , or default function ) , it errored during runtime but not during build . this error can sneak into production as it only throws during runtime . # # # how ? walk ast of the proxy / middleware file , and if a valid export is not found , throw during build . - - - - - - - - - co - authored - by : benjamin woodruff <benjamin . woodruff @ vercel . com>
112	update bundler development test manifest ( # 77040 ) this auto - generated pr updates the development integration test manifest used when testing alternative bundlers .
113	examples : fix view source pathname at ` image - legacy - component ` ( # 73414 ) # # description # 73344 updates the [ image - legacy - component ] ( https : / / github . com / vercel / next . js / tree / canary / examples / image - legacy - component ) example for using the app router . however , [ ` viewsource ` ] ( https : / / github . com / vercel / next . js / blob / canary / examples / image - legacy - component / components / view - source . tsx ) component isn ' t updated . then i update the pathname . cc : @ samcx # # # adding or updating examples - [ x ] the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - [ x ] make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md co - authored - by : sam ko <sam @ vercel . com>
114	refactor ( turbopack ) : use graph for server action workaround ( # 72812 ) # # # what ? previously , we had a workaround while consuming the graph and converting them to ` module ` s . # # # why ? everything should be stored in the dependency graph because we are going to optimize it using graph node traversal . # # # how ?
115	[ turbopack ] pass inner modules to chunking to match chunking types ( # 76227 ) # # # what ? run chunking for the inner modules of the wrapper modules
116	ensure cookies set in middleware can be read in a server action ( # 67924 ) # # # what if middleware targets a server action handler and sets or updates a cookie , the newly updated cookie would not be reflected in the ` cookies ( ) ` response of the action handler # # # why in # 65008 we fixed a bug where cookies set in middleware were not reflected in the ` cookies ( ) ` call in a server component from the same request . we did this by introducing a ` x - middleware - set - cookie ` header , that signaled to downstream handlers that middleware had run on the request & set a cookie . however this handling was only applied to the sealed / read - only cookies . cookies accessed from a server action use ` mutablecookies ` , since those aren ' t frozen as a server action is allowed to modify cookies . # # # how this pulls the cookie merge handling into a function and applies the merge to ` mutablecookies ` . fixes # 67814 closes ndx - 95
117	[ test ] fix flaky error - recovery test ( # 76789 ) fixes https : / / github . com / vercel / next . js / actions / runs / 13651039022 / job / 38159568577 ? pr = 76787 # step : 33 : 639 sometimes we didn ' t get to assert in time before more errors come in . now the test ensures that each error is intentional .
118	turbopack build : add marker for when a build used turbopack ( # 77674 ) # # what ? when using turbopack build it currently requires ` turbopack = 1 ` when running in production . this is handled automatically in ` next dev ` / ` next build ` / ` next start ` . however there ' s cases where ` next start ` is not used , e . g . on deployment platforms . for those cases i ' ve added a new marker file ` is_turbopack_build ` part of the build output ( ` . next / is_turbopack_build ` ) so that it can detect turbopack build and apply ` turbopack = 1 ` env var for the relevant places . this marker is also needed in order to improve the error when someone accidentally forgets ` - - turbopack ` on ` next start ` after doing a turbopack build . going to add that error in a separate pr .
119	chore ( cna ) : re - add / public ( # 69887 ) # # why ? to prevent confusion about the ` / public ` , re - adding to create next app . x - ref : https : / / x . com / ytcodeantonio / status / 1832856105447473351
120	[ turbopack ] fix hanging and flaky issues ( # 76032 ) # # # what ? * fix active counting when balancing edges * release lock correctly to avoid a deadlock
121	update caching . mdx ( # 81129 ) # # # what ? fix misleading information in the docs about mixing cached and uncached ` fetch ` calls during dynamic rendering . # # # why ? i followed the guide ( using next . js 15 . 3 . 2 ) and tried it out with this code : ` ` ` ts const joke = await fetch ( " https : / / api . chucknorris . io / jokes / random " , { cache : " no - cache " , } ) ; const jokedata = await joke . json ( ) ; console . log ( " fetched joke : " , jokedata . value ) ; const joke2 = await fetch ( " https : / / api . chucknorris . io / jokes / random ? category = dev " ) ; const jokedata2 = await joke2 . json ( ) ; console . log ( " fetched joke2 : " , jokedata2 . value ) ; ` ` ` after building and starting the production server , when i refresh the page , both ` jokedata . value ` and ` jokedata2 . value ` are different , uncached . if i want the other ` fetch ` to be cached , i need to explicitly enable caching , e . g . ` ` ` ts const joke = await fetch ( " https : / / api . chucknorris . io / jokes / random " , { cache : " no - cache " , } ) ; const jokedata = await joke . json ( ) ; console . log ( " fetched joke : " , jokedata . value ) ; const joke2 = await fetch ( " https : / / api . chucknorris . io / jokes / random ? category = dev " , { cache : " force - cache " , } ) ; const jokedata2 = await joke2 . json ( ) ; console . log ( " fetched joke2 : " , jokedata2 . value ) ; ` ` ` this way the first fetch is not cached while the second one is . # # # how ? the previous version claimed : > other ` fetch ` requests that do not opt out of caching will still be cached in the data cache . but below in the guide , we can see this : > the default caching behavior of fetch ( e . g . , when the cache option is not specified ) is equal to setting the cache option to no - store : so the first citation is misleading - the fetch requests are not cached by default ( with dynamic rendering - static rendering would cache the single call it into the output ) , so we actually need to explicitly enable caching to have them cached . co - authored - by : joseph <joseph . chamochumbi @ vercel . com>
122	add @ sparticuz / chromium - min to default server externals ( # 81309 ) this package needs to be externalized to have it ' s wasm dependencies traced properly for node runtime so this adds it to the default list .
123	fetch tag before reset for create - release - branch ( # 83006 )
124	[ dev - overlay ] unify error deduplication logic ( # 78017 )
125	update next command name , add types & update variable wording ( # 68007 ) # # # what ? this pr adds updates the command name and adds argument types to the ` next ` script to improve internal dx , code quality and correctness .
126	[ ci ] : split clientsegmentcache test runners off from experimental ( # 84440 ) we are preparing to enable ` clientsegmentcache ` by default on canary . to prepare , this splits it into a separate ci runner and adds a failing test manifest so we can incrementally migrate / fix failing tests before stable release .
127	prevent duplicate rsc fetch when action redirects ( # 66620 ) when checking which segment ( s ) need to be refreshed , we currently compare the current page url with the segment ' s refresh marker . we should inspect the ` mutable . canonicalurl ` value first since that ' s the url we ' re changing to , followed by ` state . canonicalurl ` as a fallback ( indicating that there ' s no url change pending ) . this is because the server action handler will receive a redirect url prior to ` location . pathname ` being updated , so the router will incorrectly think it needs to refresh the data for the page we ' re going to . closes next - 3500
128	update rspack production test manifest ( # 78123 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
129	[ sourcemaps ] ignore - list sources whose sourcemaps ignore - list everything ( # 81231 ) webpack - only at the moment since i have no easy stack to test this on in turbopack until we sourcemap the turbopack runtime . this applies the same heuristic chrome uses . for sources whose associated sourcemap ignores everyone of its sources , we ignore - list that source even if we didn ' t find a mapping . this is similar to other common heuristic where the closest mapping is used when no exact mapping exists .
130	update rspack production test manifest ( # 82601 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
131	examples : remove amp example ( # 84355 ) stacked on https : / / github . com / vercel / next . js / pull / 84312 removes the amp example , which is no longer supported .
132	codemod : type cast async api calls in non entry file exports ( # 71040 )
133	update turbopack production test manifest ( # 80600 ) this auto - generated pr updates the production integration test manifest used when testing turbopack .
134	turbopack : make another callback return a result ( # 80608 ) we already do this in a bunch of these callbacks , because sometimes you have some ` option<> ` in there that you know is always set . except for eventual consistency , unfortunately . that ' s the main usecase for a result here .
135	docs : fix typos in 08 - mutating - data . mdx ( # 74856 )
136	[ cache components ] error for sync io in server components during static prerender ( # 82500 ) currently we error if you cannot produce a shell unless you have a suspense boundary above the root . this is fine for normal io but sync io like math . random ( ) and new date ( ) have much more significant bad consequences for prerendering . instead of treating these errors as another flavor of " must have a shell " validation we should instead treat them like they must be guarded behind something else dynamic like ` await connection ( ) ` . in addition to unconditionally erroring for sync io in server components when prerendering this change also removes the sync io warning for runtime prefetches . this is because at the moment there is no way to debug these errors in dev . in the future we will add validation for prefetches and need to add back in some ability to warn for these cases but until then we will leave this case as a silent deopt .
137	[ typescript plugin ] match method signature ( ` somefunc ( ) : void ` ) type for client boundary warnings ( # 79144 ) best to be reviewed with " hide whitespace " . # # # why ? the props marked ` ( ) : any ` bypassed the warning for non - serializable props . ` ` ` tsx ' use client ' export function comp ( { onclick } : { onclick ( ) : any } ) { / / . . . } ` ` ` added tests to prevent regression . - - - - - - - - - co - authored - by : janka uryga <lolzatu2 @ gmail . com>
138	replace chalk by picocolors ( vercel / turbo # 8390 ) we replaced chalk with picocolors as it is much more optimal and smaller . discussions : vercel / turbo # 8341 in this pr has been the replacement in all the packages inside / packages / , i will make another one for the update of the examples , but i can also include in this same pr . i have deleted in 2 package . json the dependency on : @ types / chalk - animation as i checked and it was not being used . picocolors does not have the function to pass a hexadecimal colour to ascii , to keep the colours , i have created the function and here 2 things to comment . i have created this function in the most used place in the turbo - utils / logger , but it is also used in 1 specific place , that ' s why i have used the export . 1 . the implementation does not use the â€˜bitsâ€™ because typescript gives error , if you see it necessary i can change the implementation . 2 . i don ' t know if this is the right place to put this function , do you think it ' s necessary to create a test ? - - - - - - - - - co - authored - by : torresgol10 . itd <torresgol10 . itd @ gmail . com> co - authored - by : anthony shew <anthony . shew @ vercel . com>
139	perf ( turbo - tasks ) : turn on ` local_resolution ` feature by default ( # 75051 ) enables the ` turbo - tasks / local_resolution ` feature from https : / / github . com / vercel / next . js / pull / 69126 by default .
140	perf ( turbopack ) : do not allocate vectors if we are not going to use it ( # 80504 ) # # # what ? avoid allocations when we are not going to use it # # # why ? i think static tools can technically analyze all of these kinds of needless allocations , but i ' m not sure , so i ' ll try to find them by hand .
141	docs ( route - segment - config ) : remove line in force - dynamic mentioning it ' s like getserversideprops ( # 75773 ) # # why ? ` force - dynamic ` is not like ` getserversideprops ` in pages router , so this bullet point needs to be removed . - fixes https : / / github . com / vercel / next . js / issues / 75697
142	cleanup unnecessary map in dev server ( # 73745 ) this isn ' t in use anymore since we moved these errors to a swc transform .
143	[ dev - overlay ] remove unnecessary code from / pages dev error boundary ( # 79983 ) no longer needed in react 18 +
144	docs : poc ( # 81419 ) closes : - https : / / linear . app / vercel / issue / doc - 4841 / setup - minimum - working - app - in - the - nextjs - repo - https : / / linear . app / vercel / issue / doc - 4845 / add - community - readme - - - - - - - - - co - authored - by : joseph chamochumbi <joseph . chamochumbi @ vercel . com>
145	docs ia 2 . 0 : add ` deep dive ` section placeholder ( # 77724 ) this section will be for developers who want to understand how things work . it ' s not essential knowledge , but good to know . a place for conceptual information and colorful diagrams that explain the magic behind things âœ¨ ðŸŒˆ
146	update devdependecies tar and type ( # 66580 ) update devdependecies tar and type . i have only imported the necessary function , maybe it is a little unverbose , we can use instead of â€˜xâ€™ = > â€˜extractâ€™ . - - - - - - - - - co - authored - by : torresgol10 . itd <torresgol10 . itd @ gmail . com> co - authored - by : sam ko <sam @ vercel . com>
147	turbopack build : fix typeof - window - replace tests ( # 69883 ) this test assumed the code would be in the entry file , but that is not always the case , and with turbopack we even have more chunks so the files can be in both ` . next / server / pages ` or ` . next / server / chunks ` . updates the test to reflect that , replacing was already implemented in turbopack . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
148	[ dev - overlay ] replace the react hydration error link with nextjs one ( # 76438 )
149	turbopack : use bail instead of panic ( # 82745 ) this behaves more gracefully due to eventual consistency
150	cna : fix typo ( # 83121 )
151	docs : rewrite ` cookies ` page to follow template , add missing methods ( # 69614 ) closes : https : / / linear . app / vercel / issue / doc - 3296 / cookies - reference - page - rewrite page to follow reference template - add undocumented ` clear ( ) ` and ` tostring ( ) ` methods ( [ source ] ( https : / / github . com / vercel / next . js / blob / adc94b49d47cd263140ba6523bc2db2e6d09e0d2 / packages / next / src / compiled / % 40edge - runtime / cookies / index . d . ts # l144 ) ) - add a list of supported cookies options ( [ source ] ( https : / / github . com / vercel / next . js / blob / adc94b49d47cd263140ba6523bc2db2e6d09e0d2 / packages / next / src / compiled / % 40edge - runtime / cookies / index . d . ts ) ) - adds ts code blocks - adds examples
152	[ turbopack ] avoid allocating on aggregationupdatequeue : : new ( # 76034 )
153	update script location used in ` pnpm unpack - next ` ( # 79626 )
154	feat ( rsc ) : allow host or forwarded ( # 74199 ) # # # what ? match on either the host or forwarded host when running server actions . - - - - - - - - - co - authored - by : jj kasper <jj @ jjsweb . site>
155	sync - react : automatically update all references to the react peer dependency version ( # 69194 )
156	fix : improve types in turbopack runtime ( # 74119 ) adds types to node modules require ( ) d in the node runtime . these imports were untyped , which was hiding an issue with our ` pathtofileurl ` usage .
157	test ( examples ) : update turbopack manifest ( # 75092 ) # # summary at # 74180 and # 74180 , ` with - styled - components - rtl ` and ` with - react - jss ` examples were deleted . then i removed them from [ turbopack - dev - examples - manifest . json ] ( https : / / github . com / vercel / next . js / blob / canary / test / turbopack - dev - examples - manifest . json ) . cc : @ samcx co - authored - by : sam ko <sam @ vercel . com>
158	docs : added documentation for ` " use cache : private " ` ( # 85038 ) added documentation for ` use cache : private ` . - - - - - - - - - co - authored - by : joseph chamochumbi <joseph . chamochumbi @ vercel . com>
159	error when output : export is used with intercepting routes ( # 75058 ) intercepting routes are built on top of [ rewrites ] ( https : / / nextjs . org / docs / app / api - reference / config / next - config - js / rewrites ) which is one of the listed [ unsupported features ] ( https : / / nextjs . org / docs / app / building - your - application / deploying / static - exports # unsupported - features ) of ` output : " export " ` . however , because the next . js server injects the interception routes , it ' s not caught by existing validation logic in the export flow . this properly documents that intercepting routes are not currently supported by ` output : " export " ` and hard errors in next dev / build if detected . previously route interception would just not have worked , instead serving the non - intercepted page when built , leading to a confusing experience . we eventually want to support this with improved spa / export features , however that ' s out of scope for this pr : the goal here is to ensure we ' re providing more immediate feedback about the fact that this is unsupported .
160	docs : update ` tailwind . config . ts ` to use ` satisfies ` operator ( # 73924 ) co - authored - by : lee robinson <me @ leerob . io>
161	[ ci ] : increase number of runners for test jobs ( # 85049 )
162	refactor ( turbopack / next - api ) : implement nonlocalvalue for traceddigraph and singlemodulegraph ( # 74506 ) this allows ` singlemodulegraph ` to implement ` nonlocalvalue ` , removing the ' local ' opt - out on the ` turbo_tasks : : value ` macro .
163	build : update ` swc_core ` to ` v10 . 2 . 5 ` ( # 75002 ) # # # what ? update swc crates . - changelog : https : / / github . com / swc - project / swc / compare / swc_core % 40v10 . 1 . 0 . . . swc_core % 40v10 . 2 . 5 # # # why ? to keep in sync .
164	avoid timeout error when transformed params are passed to ` " use cache " ` ( # 80463 ) with # 79743 , we ' re now providing a filled resume data cache ( rdc ) when prerendering optional fallback shells for routes that have some params defined in ` generatestaticparams ` . this allows us to treat a cache miss in the rdc as an indication that params were part of the cache key . in this case , we can make the cache function a dynamic hole in the shell ( or produce an empty shell if there ' s no parent suspense boundary ) . currently , this also includes layouts and pages that don ' t read params , which will be improved when we implement nar - 136 . otherwise , we assume that if params are passed explicitly into a ` " use cache " ` function , that the params are also accessed ( same as in # 78882 ) . this allows us to abort early , and treat the function as dynamic , instead of waiting for the timeout to be reached , even when params are transformed with an async function , before being passed into the " use cache " function , e . g . : ` ` ` js import { cachedcomponent } from ' . / cached - component ' async function getslug ( params ) { const { slug } = await params return slug } export default function page ( { params } ) { return <cachedcomponent slugpromise = { getslug ( params ) } / > } export async function generatestaticparams ( ) { return [ { slug : ' foo ' } ] } ` ` ` this escapes the instrumentation we do to bailout early on fallback params access . that handling is still needed though when prerendering fallback shells of routes that don ' t have any params defined in ` generatestaticparams ` , as we don ' t have a prefilled rdc in that case .
165	fix missing stylesheets when parallel routes are present ( # 66300 ) this takes the ` layerassets ` property from the previous pr and actually renders it , replacing the previous style handling . this ensures that when multiple page segments are rendered on screen , all of their associated css files are loaded . the existing ` findheadincache ` method only ever returns a single head node , which means itâ€™d miss stylesheets . fixes # 59308 fixes # 63465
166	[ dev - overlay ] docs : add readme ( # 76396 ) this pr added the readme for the dev overlay for future contributors . [ * * view preview * * ] ( https : / / github . com / vercel / next . js / blob / 9136b280a3e194b81c1ea9e4aa7236eeb895a843 / packages / next / src / client / components / react - dev - overlay / readme . md ) closes ndx - 656 - - - - - - - - - co - authored - by : lee robinson <lee @ leerob . com>
167	use ` next_private_debug_cache ` env variable for cache handler debug logs ( # 77585 ) instead of ` next_private_debug_use_cache ` , we ' re now using the env variable ` next_private_debug_cache ` , which is already used in other places for cache debugging . in addition , ` process . pid ` is not logged anymore . this prevents node . js api usage errors in # 77577 when bundling with turbopack .
168	add comment that we expect the function passed to bind to be anonymous ( # 85070 ) see https : / / github . com / facebook / react / pull / 34911 this is a weird one but we need some consistent name to ignore these because otherwise they show up as i / o . the simplest is to simply not assign a name to the function being passed . it also can ' t be auto - assigned by a compiler . because whatever name the function is given is the name given to the asyncresource .
169	[ after ] after is not dynamic anymore ( # 71231 ) # changes # # # 1 . ` unstable_after ( ) ` is no longer dynamic ` after ( ) ` can now run at build time and in isr / revalidations . the principle is " if it ran , then the callback runs too " . i . e . if we encountered an ` after ( ) ` call during some render task ( build / request / revalidation ) , then the callback should run at the end of that task . note that errors thrown inside ` after ` during a prerender will fail the build . this is , amongst other things , intended to support the next section # # # 2 . calling dynamic apis inside ` unstable_after ( ) ` is banned before : ` ` ` ts after ( ( ) = > { const cookiestore = await cookies ( ) ; dostuff ( cookiestore ) } ) ` ` ` after : ` ` ` ts const cookiestore = await cookies ( ) ; after ( ( ) = > { dostuff ( cookiestore ) } ) ` ` ` tracking dynamic things inside ` after ` is difficult ( can ' t throw at the callsite , because we ' re executing after the callsite is finished , so it doesn ' t mesh well with ` dynamicio ` ) . it ' s simpler if we make the user hoist the dynamic call outside of ` after ( ) ` , because then it slots right into the existing mechanisms / docs / metal models we have for this . # notes one notable limitation is that ` tags ` and ` revalidate ` written inside ` after ` have no effect . this means that if we do ` ` ` ts after ( async ( ) = > { await fetch ( ' . . . ' , { next : { tags : [ ' my - cool - tag ' ] } } ) } ) ` ` ` and try to call ` revalidatetag ( ' my - cool - tag ' ) ` , nothing will happen , because the route is not associated with the tag . same applies to ` revalidate ` . i believe this is acceptable for now , because we expect ` after ` to be mostly used to perform side effects , and thus not do a lot of { cached , tagged , revalidatable } data - fetching . it will be addressed in a follow up .
170	[ error overlay ] comprehensive refinement ( # 75471 ) this pr adds a lot of polish to the experimental error overlay : https : / / github . com / user - attachments / assets / 2540b966 - c61d - 43eb - b816 - 5ef25f3ecb11 # # # motion - stacked layers transition smoothly when switching between errors - height transition for the dialog panel to complement the stacked layers transition - dialog contents and the backdrop fade in as per geist motion guidelines ( ` scale ` , ` opacity ` ) # # # design - new language icon based on file extension Ã  la ( ` app . tsx ` ) - shadows are clipped with translucent borders to visually be more crisp - use ` backdrop - filter : blur ( ) ` for backdrop to blend with application content - use ` font - variant - numeric : tabular - nums ` for â†â†’ switcher to avoid layout shift - misc alignment improvements # # # interactions - focus is now trapped in the dialog , <kbd>escape< / kbd> will un - trap and re - focus the last ` root . activeelement ` - focus states for all interactive elements - fluid reveal & collapse of ignored call stack items â†“ https : / / github . com / user - attachments / assets / 59a81cea - 24ec - 4fe4 - be00 - b911ab484757 closes ndx - 711 closes ndx - 744 - - - - - - - - - co - authored - by : devjiwonchoi <devjiwonchoi @ gmail . com> co - authored - by : zack tanner <1939140 + ztanner @ users . noreply . github . com>
171	re - enable and fix ` create - next - app ` integration tests ( # 68084 ) these tests were disabled as part of # 65845 , probably due to mismatching peer dependency errors . this has been resolved in the meantime . as part of this pr we ' re also fixing how the tests are installing next . js in preparation for running ` create - next - app ` : the ` run - tests . js ` script already calls ` createnextinstall ` and does all the heavy lifting . calling it again in the ` create - next - app ` integration tests is wasteful . in addition , the built ` next ` tarball is exposed by ` run - tests . js ` via the ` next_test_pkg_paths ` env variable . we need to provide the filename of the tgz as ` next_private_test_version ` so that ` create - next - app ` uses it in the generated ` package . json ` as the ` next ` dependency " version " . with the previous approach , the installation was pointing ` next ` at the ` installdir ` , which has its own version of react installed . this created runtime errors ( ` typeerror : cannot read properties of null ( reading ' usecontext ' ) ` ) when running ` next dev ` in a pages project that was created with ` create - next - app ` . some of the tests were even downloading a published ` canary ` version of ` next ` instead of using the version from the current branch . this has been fixed as well .
172	[ devtools ] fork next - logo ( # 80457 ) following up on https : / / github . com / vercel / next . js / pull / 80456 , fork the next - logo as well as it is coupled with the indicator . looking at the current [ next - logo . tsx ] ( https : / / github . com / vercel / next . js / blob / 1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7 / packages / next / src / next - devtools / dev - overlay / components / errors / dev - tools - indicator / next - logo . tsx ) file , it contains multiple hooks and icons , so ported those to separate files as well .
173	[ dynamicio ] use new heuristic to track whether server render is dynamic ( # 73751 ) instead of relying on onerror just use the timing of the prerender resolution to determine whether the server render completed before aborting . react is going to remove onerror and onpostpone calls from ` prerender ` in flight [ 31715 ] ( https : / / github . com / facebook / react / pull / 31715 ) . this is because semantically the error is going to be hidden from the prerender and on resume it might not error . so rather than relying on whether the error callback is called we simply infer whether we are done by checking if the ` prerender ` resolved prior to our abort deadline . in our case it is possible we also aborted earlier than the deadline because you can call something like ` math . random ( ) ` which requires the ` prerender ` to halt synchronously so we also check the signal status in our deadline task . we don ' t expect this to change any semantics so there are no altered tests . this is only currently implemented in the dynamicio + ppr case because that is the only case using experimental react with ` prerender ` . when dynamicio is on by itself we still use ` rendertoreadablestream ` which does not have halt semantics . we will switch to ` prerender ` when it is available in react ' s stable channel
174	[ turbopack ] allow ` value_trait ` items to not be annotated with ` turbo_tasks : : function ` ( # 79217 ) allow items in ` value_trait ` definitions to not be marked with ` turbo_tasks : : function ` as a poc remove the ` function ` attribute from ` issue : : severity ` and all implementors . in a followup i will explore removing ` turbo_task : : function ` from more ` issue ` items . now if you define a ` turbo_tasks : : value_trait ` because you want to pass around values like ` vc<box<dyn trait>> ` or emit it as a collectible you don ' t have to make every trait item a ` turbo_tasks : : function ` . to call these items you will need to ` vc . into_trait_ref ( ) . await ? ` and then you can call the methods normally . this has an odd effect of kind of splitting the ` trait ` in half , some methods can be called on ` vc<self> ` and some can be called on ` & self ` . annoyingly you cannot make these items ` async ` since ` value_trait ` needs to dyn - compatible , but still this unlocks a lot of opportunities . h / t to kdy1 @ for unblocking me on how to use ptr_metadata and how to resolve the issues i was having with rust - analyzer
175	add support for cssmodules - pure - no - check to allow global css features like view transitions ( # 77321 ) # # what ? this pr adds support for ` cssmodules - pure - no - check ` in css modules by upgrading ` postcss - modules - local - by - default ` from 4 . 0 . 4 to 4 . 2 . 0 ( ` cssmodules - pure - no - check ` was also recently [ merged into lightningcss 1 . 29 . 3 ] ( https : / / github . com / parcel - bundler / lightningcss / pull / 898 ) ) # # why ? global css selectors like view transitions api require global scope to work properly . currently , there ' s no clean way to use these selectors with css modules in next . js , which causes issues when : 1 . using the view transitions api 2 . migrating from css - in - js libraries like styled - components to react server components with css modules # # how ? - upgrades ` postcss - modules - local - by - default ` to 4 . 2 . 0 - adds support for the ` / * cssmodules - pure - no - check * / ` comment pattern in css files which disables css modules localization for that file - this mirrors established escape hatches in other tools ( ` @ ts - nocheck ` , ` / * eslint - disable * / ` ) - added tests ( similar to one @ samcx wrote previously ) to ensure functionality works correctly the approach was previously approved by @ samcx in issue # 77232 , who mentioned that lightningcss was already bumped , but we needed to bump the postcss side fixes # 77232 - - - - - - - - - co - authored - by : sam ko <sam @ vercel . com>
176	otel : use ` srcpage ` for templates when ` next . route ` is unavailable ( # 83911 ) # # # why ? srcpage is relatively lower cardinality , so use this if available . in the base - server handlerequest , it is the entry of the request , so no low - cardinality target is available . https : / / github . com / vercel / next . js / pull / 75416 / files # diff - 6f4291cc2bfc5073fdca12a014011769e840ee68583db1468acef075f037015ar891
177	remove leftover console . log introduced in # 70532 ( # 70615 )
178	refactor : remove hydration link appending console interception ( # 67011 ) # # # what remove the duplicated ` setup - hydration - warning ` # # # why we already handling the warning message appending in error dialog , no need to intercept it again .
179	perf ( turbopack ) : remove ` importbinding ` fragments ( # 78470 ) # # # what ? make the ` importbinding ` node a phantom node . # # # why ? because they are not used . we have to import directly from the original module because of the static analysis like ` next / dynamic ` . so i modified the tree shaking to import directly with https : / / github . com / vercel / next . js / pull / 71704 . but # 71704 didn ' t remove the concept of ` importbinding ` . this pr finishes the work of using direct imports . additionally , this pr introduces ` reexportbinding ` fragments because these are not phantom nodes . i ' ll check if it would be possible to remove ` reexportbinding ` fragments with follow - up prs . # # # how ? - closes pack - 4366
180	[ turbopack ] [ hmr ] allow ` option ` s to be returned by ` versionedcontentmap ` ( # 69079 ) building on # 68698 , which causes ` error ` s propagated from the ` versionedcontentmap ` to surface as errors instead of reloading the page , allow intentionally missing values to be returned . there are scenarios in which this is desirable and not an error , such as when the content of entries change and the page must be reloaded . in these cases , a ` update : missing ` is returned , which causes the page to be reloaded . test plan : ci pack - 3188 - - - - - - - - - co - authored - by : tobias koppers <tobias . koppers @ googlemail . com>
181	turbopack : defer sourcemaps processing to codegen ( # 78855 ) closes pack - 3434 ` ` ` / / todo this is too eagerly generating the source map . we should store a generatesourcemap / / instead and only actually generate the sourcemap when it ' s needed . this would allow to avoid / / generating the source map when a module is never included in the final bundle . it allows / / analysis to finish earlier which makes references available earlier which benefits / / parallelism . when sourcemaps are emitted it moves that generation work to the code generation / / phase which is more parallelizable . ` ` `
182	create synchronous snapshots of recursive availablemoduleinfo struct ( # 74894 ) this : - allows for synchronous lookup of a moduleâ€™s availability information without async resolving vcs - creates a single structure that combines the entire availability information hierarchy into one . while not strictly necessary , without vc caching , the hierarchy of structs only provided overhead without advantage
183	perf ( router ) : replace lru cache with optimized doubly - linked list implementation ( # 82633 ) # # # what ? replace lru cache implementation with an optimized doubly - linked list algorithm and move from server - only to shared library location . # # # why ? the previous map - based lru cache had suboptimal eviction performance for route matching operations under high load . route matching is a critical performance path in next . js that benefits significantly from true o ( 1 ) cache operations . # # # how ? - implement doubly - linked list with sentinel nodes for true o ( 1 ) get / set / delete operations - add comprehensive test coverage including size - based eviction scenarios - update import paths across 14 files throughout the codebase - add defensive null checking for edge cases discovered during static analysis - replace deprecated ` keys ( ) ` iteration with modern ` symbol . iterator ` pattern
184	[ turbopack ] promote ` exports ` and module to factory parameters for cjs ( # 82285 ) # # optimze cjs codegen by promoting ` module ` and ` exports ` to factory parameters * tl ; dr ; destructing is hard , lets go shopping ! * currently we prefix factories for cjs modules with ` var { m : module , e : exports } = __turbopack_context__ ; ` this is problematic since swc is unable to eliminate these bindings when they are dead ( too afraid of es5 getter properties and side effects ðŸ˜­ ) . furthermore we are playing a game of telephone with ourselves since our caller basically is doing ` factory ( { m : module , e : module . exports } ) ` when they call us ( this is skimming over a bunch of details , ofc ) . instead just pass them directly as function parameters . one downside of this is that we still pass them to ` esm ` factories even though they are ignored ( and simply not declared by the factories ) . this is not too costly since the caller has trivial access already and browsers are pretty good at handling / ignoring extra parameters ( see https : / / v8 . dev / blog / adaptor - frame for the clever way v8 optimizes this ) . # # # alternatives the main alternative considered was compile time replacing references to ` module ` and ` exports ` with ` __turbopack_context__ . ( m | e ) ` . unfortunately this breaks subtle edge cases of the cjs spec since it is allowed for users to rewrite ` module ` and ` exports ` with assignments ( e . g . ` exports = ' bad idea ' ` ) . this is generally a linter error but not unheard of and we cannot break it . the other alternative considered was enhancing ` swc ` to inline and dead code eliminate destructuring patterns , but from playing with the playgound it looks like swc is pretty conservative about moving / inlining variables across side effectful statements , so we would still be paying the cost of the declaration in many cases . # # turbopack performance comparison : head vs change as expected this is a substantial improvement to commonjs evaluation . the esm results are kind of confusing . i generally expected ' neutral ' since the cost of passing a dead parameters is so small in modern vms . | test case | metric | head ( ms ) | change ( ms ) | speedup | improvement | | - - - - - - - - - - - | - - - - - - - - | - - - - - - - - - - - | - - - - - - - - - - - - - | - - - - - - - - - | - - - - - - - - - - - - - | | * * client commonjs * * | load - average | 31 . 61 | 24 . 38 | * * 1 . 30x * * | * * + 29 . 6 % * * | | | load - median | 32 . 05 | 24 . 30 | * * 1 . 32x * * | * * + 31 . 9 % * * | | | load - p75 | 33 . 10 | 24 . 90 | * * 1 . 33x * * | * * + 32 . 9 % * * | | | execute - average | 25 . 96 | 19 . 80 | * * 1 . 31x * * | * * + 31 . 1 % * * | | | execute - median | 25 . 90 | 19 . 50 | * * 1 . 33x * * | * * + 32 . 8 % * * | | | execute - p75 | 26 . 50 | 20 . 20 | * * 1 . 31x * * | * * + 31 . 2 % * * | | * * client esm * * | load - average | 22 . 28 | 21 . 94 | * * 1 . 02x * * | * * + 1 . 6 % * * | | | load - median | 21 . 80 | 21 . 60 | * * 1 . 01x * * | * * + 0 . 9 % * * | | | load - p75 | 23 . 50 | 22 . 10 | * * 1 . 06x * * | * * + 6 . 3 % * * | | | execute - average | 50 . 77 | 48 . 12 | * * 1 . 06x * * | * * + 5 . 5 % * * | | | execute - median | 50 . 85 | 47 . 55 | * * 1 . 07x * * | * * + 6 . 9 % * * | | | execute - p75 | 51 . 60 | 48 . 30 | * * 1 . 07x * * | * * + 6 . 8 % * * | | * * pages api commonjs * * | load - average | 24 . 18 | 23 . 33 | * * 1 . 04x * * | * * + 3 . 7 % * * | | | load - median | 23 . 27 | 23 . 57 | 0 . 99x | - 1 . 3 % | | | load - p75 | 25 . 29 | 23 . 96 | * * 1 . 06x * * | * * + 5 . 5 % * * | | | execute - average | 32 . 23 | 24 . 26 | * * 1 . 33x * * | * * + 32 . 8 % * * | | | execute - median | 31 . 16 | 24 . 34 | * * 1 . 28x * * | * * + 28 . 0 % * * | | | execute - p75 | 33 . 42 | 24 . 52 | * * 1 . 36x * * | * * + 36 . 3 % * * | | * * pages api esm * * | load - average | 23 . 48 | 28 . 91 | 0 . 81x | - 18 . 8 % | | | load - median | 23 . 13 | 28 . 91 | 0 . 80x | - 20 . 0 % | | | load - p75 | 25 . 55 | 29 . 57 | 0 . 86x | - 13 . 6 % | | | execute - average | 63 . 01 | 55 . 94 | * * 1 . 13x * * | * * + 12 . 6 % * * | | | execute - median | 61 . 56 | 55 . 22 | * * 1 . 11x * * | * * + 11 . 5 % * * | | | execute - p75 | 69 . 56 | 56 . 40 | * * 1 . 23x * * | * * + 23 . 3 % * * | * * legend : * * - * * bold values * * indicate performance improvements ( speedups ) - regular values indicate performance regressions ( slowdowns ) - speedup = head time Ã· change time ( >1 . 0 = faster , <1 . 0 = slower ) - p75 = 75th percentile
185	update rspack production test manifest ( # 84549 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
186	docs : update ci build caching docs to include ` bun ` and other package manager ( # 77633 ) # # # what ? - add mention of bun and other package manager in the ` ci - build - caching ` documentation # # # why ? - make the documentation account for other package managers instead of showing any sort of package manager favoritism fixes # 57079 co - authored - by : lee robinson <lee @ leerob . com>
187	add docs to mention glob behavior of trace includes / excludes ( # 68463 ) this updates our docs related to ` outputfiletracingincludes ` / ` outputfiletracingexcludes ` to mention the key is a glob and needs to be escaped accordingly as it can cause confusion . - - - - - - - - - co - authored - by : jiwon choi <devjiwonchoi @ gmail . com>
188	add @ taskr / esnext to pnpm root to resolve hoisting issues ( # 70349 ) # # # what ? add ` @ taskr / esnext ` to the root package . json to get around hoisting rules breaking ` taskr ` ' s automatic discovery ( and fix builds on some platforms where it is broken ) . # # # why ? some types of ' magically ' imported packages ( such as taskr automatically supporting es6 by just adding a package , or drizzle automatically finding a database driver ) aren ' t hoisted on some platforms in the way the tool expects , breaking it . the symptom of this is taskr throwing a syntax error on some platforms , because we use es6 syntax and it can ' t find the package it needs to support it . # # # how ? by adding it to the root package . json we ensure it is always hoisted in the way taskr expects .
189	include proper instrumentation entry in required files manifest ( # 68983 ) # # # what when the ` edge - instrumentation . js ` is not built , we do not include it into the serve required manifest . we moved the write of required server files manifest to a late phase , where we used the edge routes counter to determine if we need to write the edge entry file of instrumentation into manifest x - ref : https : / / github . com / vercel / next . js / actions / runs / 10416595866 / job / 28850695138
190	[ metadata ] change the metadata routes params to promises ( # 83560 )
191	update rspack production test manifest ( # 80561 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
192	[ turbopack ] await shutdown before ending pool ( # 75545 ) # # # what ? make sure to gracefully shutdown the turbopack process , by waiting for shutdown before killing the process . this makes sure persistent caching will have time to store the cache , before it ' s killed . that should happen in background while doing ssg . ( maybe we need to change that in future for memory reasons , but it will work for now . )
193	fix ( ci ) : on musl / alpine builds , pin llvm to llvm20 , add llvm bin directory to path ( # 81519 ) alpine edge recently removed ` llvm - config ` from the path : - 3 . 22 : https : / / pkgs . alpinelinux . org / contents ? file = llvm - config & path = & name = & branch = v3 . 22 & repo = & arch = x86_64 - edge : https : / / pkgs . alpinelinux . org / contents ? file = llvm - config & path = & name = & branch = edge & repo = & arch = x86_64 ci job : https : / / github . com / vercel / next . js / actions / runs / 16208743604 also , fix a bunch of escaping problems with how we invoke bash inside of docker . . . co - authored - by : will binns - smith <wbinnssmith @ gmail . com>
194	[ dev - overlay ] remove " unhandled runtime error " label ( # 77484 )
195	docs ( next . config . js options ) : remove experimental mdxrs feature from pageextensions ( # 66310 ) # # # what ? removed experimental [ mdxrs ] ( https : / / nextjs . org / docs / app / api - reference / next - config - js / mdxrs ) from [ pageextensions ] ( https : / / nextjs . org / docs / app / api - reference / next - config - js / pageextensions ) # # # why ? the pageextensions setting demonstrates how to allow other extensions like . md and . mdx . the inclusion of the experimental rust mdx compiler is unnecessary and can lead to confusion . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - > - - - - - - - - - co - authored - by : samcx <sam @ vercel . com>
196	fix ` revalidatetag ( ) ` behaviour when invoked in server components ( # 70446 ) fixes # 70403 # # # what ? when ` revalidatetag ( ) ` is called directly in server components , the cache is not purged for the corresponding tags . reproduction steps available in # 70403 # # # how ? check [ app - render . tsx ] ( https : / / github . com / vercel / next . js / compare / canary . . . abhi12299 : fix - revalidatetag - rsc ? expand = 1 # diff - a3e2e024db1faa1b501e0dd6040eaaf0d931cb9878ae0fb0f4c3658daa982768 ) this issue was introduced in # 65296 in this file : [ revalidate . ts ] ( https : / / github . com / vercel / next . js / pull / 65296 / files # diff - 7f0cb5bb30d44b9153d724e31c25859b9aab6cc258b35563a1d9464cd0688283 ) . the lines removed from the file resulted in the revalidation checks to be skipped when there is an rsc request . also fixed checks on ` pendingrevalidates ` to also check for ` revalidatedtags ` . - - - - - - - - - co - authored - by : jj kasper <jj @ jjsweb . site>
197	docs : fix headings ( # 79777 )
198	[ release - old ] use ` backport ` npm dist tag instead of ` stable ` for backports ( # 79612 ) pr https : / / github . com / vercel / next . js / pull / 79596 introduced setting ` stable ` dist tag for backports , but due to https : / / github . com / vercel / next . js / pull / 79538 # pullrequestreview - 2866854431 , > this sounds like something users would use . however , it might point to 14 . x when 15 . x exists and we would certainly want people to use 14 . x . it ' s also weird that 14 . x would have a ` stable ` tag but not 15 . x . > > that ' s why ` backport ` makes more sense since it ' s less specific and not common vernacular when talking about release characteristics ( e . g . " experimental " , " nightly " , " stable " , " unstable " etc . ) . > > the tag could actually just be " internal - backport " and ideally we ' d remove it right after publish . the goal here isn ' t to come up with a useful tag for backports . we just want to work around npm requiring a tag during publish . better to use another dist tag : i . e . , ` backport ` .
199	skip client reference manifests for static metadata route handlers ( # 74876 ) fixes a regression caused by # 74835 . [ x - ref ] ( https : / / github . com / vercel / next . js / actions / runs / 12773698779 / job / 35607288377 )
200	improve error handling for ` headers ` / ` cookies ` / ` draftmode ` in ` ' use cache ' ` ( # 81716 ) this ensures that we show a proper error with an error stack ( potentially source - mapped ) when accessing ` headers ` / ` cookies ` / ` draftmode ` in ` ' use cache ' ` , even when caught in user - land code . for ` searchparams ` ( currently triggering a timeout error ) we ' ll need a slightly different solution , which will be handled in a future pr . the approach chosen here is somewhat temporary , as we ' d like to implement compile - time errors instead for accessing any kind of request data in ` ' use cache ' ` functions . however , this would require a larger change to our bundlers . closes nar - 201
201	feat : add polyfill of ` url . canparse ` for browser compatibility ( # 70228 ) # # # why ? since ` url . canparse ` is incompatible with older browsers like safari 16 , we added ` canparseurl ` util at https : / / github . com / vercel / next . js / pull / 70215 . x - ref : https : / / caniuse . com / ? search = url . canparse to improve maintenance , we decided to add polyfill for ` url . canparse ` . x - ref : [ slack thread ] ( https : / / vercel . slack . com / archives / c07bva6hm17 / p1726664071636899 ? thread_ts = 1726620161 . 450109 & cid = c07bva6hm17 ) closes ndx - 302 - - - - - - - - - co - authored - by : jiachi liu <inbox @ huozhi . im>
202	exit ` next dev ` with a non - zero code when next . config . js is invalid ( # 83602 ) in ` next dev ` , we ' re currently ignoring the exit code of the spawned child process , and always exiting with ` 0 ` instead . we should exit the process with the child ' s exit code instead . this is relevant when the ` next . config . js ` is invalid , for example .
203	correct reason for turbopack incompat , remove inaccurate " good to know " ( # 72467 ) - https : / / github . com / vercel / next . js / pull / 72241 # discussion_r1832894901 < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - > # # # what ? 1 . fix the incorrect statement added in # 72241 , as per @ timneutkens ' comment here : - https : / / github . com / vercel / next . js / pull / 72241 # discussion_r1832894901 2 . remove the outdated " good to know " section stating that turbopack requires ` mdxjs - rs ` and is not compatible with ` @ next / mdx ` # # # why ? the docs are currently incorrect # # # how ? edit [ remark and rehype plugins ] ( https : / / nextjs . org / docs / app / building - your - application / configuring / mdx # remark - and - rehype - plugins ) section on docs page - - - - - - - - - co - authored - by : tim neutkens <tim @ timneutkens . nl>
204	refactor : use ` shrink - to - fit ` crate instead ( # 75777 ) # # # what ? use ` shrink - to - fit ` crate instead of inline trait in turbo - tasks . # # # why ? it ' s a separate crate , so swc ast implement the ` shrinktofit ` trait .
205	[ turbopack ] use timestamp type , allow spans less than 1Âµs ( # 75479 ) # # # what ? the minimum span size of 1Âµs was a bit limiting . this changes it to 0 . 01Âµs . a trace viewer update is also needed : https : / / github . com / vercel / turbo - trace - viewer / pull / 11
206	move client build id to a global variable ( # 72592 ) when performing rsc requests , if the incoming data has a different build id than the client , we perform an mpa navigation / refresh to load the updated build and ensure that the client and server in sync . currently we store the build id in the router state , but becauase it ' s always in lockstep with the app instance , it ' s not actually stateful . we can store it in a global . the id gets assigned as a side - effect during app initialization . it should never change after being set the first time . in practice , because setappbuildid is called before hydration starts , it will always get assigned to the actual build id before it ' s ever needed by a navigation . ( if for some reasons it didn ' t , due to a bug or race condition , then on navigation the build comparision would fail and trigger an mpa navigation . ) the logical flow of how the global is assigned is more convoluted than it should be because we currently decode the flight stream inside the react render phase ( via a hook ) , because that ' s required to propagate resource hints correctly . conceptually it would make more sense to decode the stream before starting hydration and pass the decoded data to the root component as props ; this would also allow us to block hydration until the id is set . but we ' ll need to address the hints problem first . as a follow up , we should probably do the same thing for the app router reducer , which is already a global store in practice but is referenced and passed everywhere as if it were owned by the react tree .
207	docs : static exports ( # 67181 )
208	docs : fix broken link ( # 79456 )
209	docs : clarify revalidatepath ( # 82142 ) fixes : https : / / github . com / vercel / next . js / issues / 81776
210	turbopack : add tracing for fetch calls ( # 77673 ) # # # what ? tracing did only show cpu operations , but fetch calls e . g . for next / font where not instrumented . this adds spans for them : ! [ image . png ] ( https : / / graphite - user - uploaded - assets - prod . s3 . amazonaws . com / 4wnxxau8pnahiauc2uqw / 4a37ff55 - bd50 - 44b4 - a6ee - 18368f68593f . png )
211	docs : pin react version to 18 in next . js 14 upgrade guide ( # 74222 ) # # # improving documentation i was just upgrading from next . js v13 to v14 following this guide : https : / / nextjs . org / docs / app / building - your - application / upgrading / version - 14 npm installation throws the below error : ` ` ` sh npm error code eresolve npm error eresolve unable to resolve dependency tree npm error npm error while resolving : blog @ 0 . 0 . 8 npm error found : react @ 19 . 0 . 0 npm error node_modules / react npm error react @ " 19 . 0 . 0 " from the root project npm error npm error could not resolve dependency : npm error peer react @ " ^ 18 . 2 . 0 " from next @ 14 . 2 . 21 npm error node_modules / next npm error next @ " 14 . 2 . 21 " from the root project npm error npm error fix the upstream dependency conflict , or retry npm error this command with - - force or - - legacy - peer - deps npm error to accept an incorrect ( and potentially broken ) dependency resolution . ` ` ` the react version for next . js v14 should be pinned to react @ 18 .
212	[ turbopack ] adopt inventory for our registry ( # 83074 ) # # what ? leverage the ` inventory ` crate to automatically register turbo tasks objects using specialized linker sections . see https : / / docs . rs / inventory / 0 . 3 . 21 / inventory / for details for nativefunction and traittype objects this was trivial and simplified the registry , for example . * functions only need the global registry during pc _deserialization_ so many builds can skip the cost . * even when we do allocate it , we can use a normal ` hashmap ` instead of a ` dashmap ` which should be a minor performance benefit on its own ( no locks , smaller in ram ) * traittype objects achieve similar benefits . the tricky part of course was trait impls : * every ` valuetype ` needs to know all the trait methods it implements * to support calling ` turbo_tasks : : functions ` on ` vc<box<dyn t>> ` * every ` traittype ` needs to know all the structs that implement it * to support dereferencing a trait ref , aka ` traitref<box<dyn t>> ` - > ` & dyn t ` to support calling non - turbotasks functions this required two more registries which more or less followed the existing pattern . one benefit of the new ` inventory ` approach is that the ` vtableregistry ` drops its interior mutability ( and associated locks ) . constructing vtableregistry objects also becomes lazy which is useful since many are not needed . so overall this should be equivalent but slightly better and it allows us to drop the build scripts ( see # 83156 ) one interesting note is determinism of ` traittypeid ` and ` valuetypeid ` . previously the values assigned were determined by the order of registrations in the build script . with inventory they are registered in an undefined order ( im guessing it is deterministic based on linker input order , but inventory makes no guarantees ) . as far as i can tell , this does not matter , but in the interest of determinism i have sorted the values based on their names . in the future we can use this determinism to optimize persistence # # why ? by colocating registration with the proc macros we can simplify the registration logic . switching to ' pull ' based registration also simplifies a number of datastructures and allows us to drop some rwlocks # # interesting consequences all the global type names are changing , dropping the ` @ todo : : ` this ` todo ` was a placeholder for a content hash of the current crate . this is to support a hypothetical idea where at least some of the persistent cache could survive turbopack updates . however based on team discussions we don ' t currently see a clear solution here . if we want to do this in the future i think we could still leverage hashes in names but we would need to compose them in a different way ( e . g . ` build . rs ` script sets an ` env ` var that the proc macro reads with the ` env ! ` macro )
213	update rspack production test manifest ( # 83512 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
214	refactor ( turbopack ) : remove cast to ` ecmascriptmoduleasset ` ( # 68427 ) # # # what ? now we have tree shaking implementation but it uses ` ecmascriptmodulepartasset ` as the module type . so casting to ` ecmascriptmoduleasset ` can break the tree shaking . this pr also removes ` special exports ` of turbopack , which is cumbersome . the previous analysis logic for those special exports may depend on the value being ` ecmascriptmoduleasset ` , which is resolved in this pr . # # # why ? clean code & for future woork . # # # how ? closes pack - 3175
215	feat : add typesafety with config . typedroutes to redirect ( ) and permanentredirect ( ) ( # 82860 ) see https : / / github . com / vercel / next . js / discussions / 66217 # discussioncomment - 14161194
216	guard navigation ` use ` hooks for react 18 ( # 85151 ) we need to guard these calls , otherwise they fail in our react 18 . 3 . 1 tests . x - ref : https : / / github . com / vercel / next . js / actions / runs / 18671327784 / job / 53236002824
217	turbopack : refactor codegen ( # 78685 ) refactor codegen in preparation for scope hoisting now , you can easily get the ast of the code - gen - ed module ( which i need to merge them together ) part of pack - 2960
218	misc : use correct capitals for react terms ( # 78445 ) - ` client / server component ` - ` react hooks ` - - - - - - - - - co - authored - by : sebastian " sebbie " silbermann <sebastian . silbermann @ vercel . com>
219	[ node - webstreams ] remove unused app externals from next - server bundler config ( # 81039 ) these externals have no effect since we don ' t import the legacy ` react - dom / server ` apis in ` next - server ` anyway . we only import the modern apis since we alias ` react - dom / server ` to ` build / webpack / alias / react - dom - server - edge . js ` which does not import from the legacy entrypoint . # # test plan - [ x ] ` compiled / next - server ` remained unchanged
220	fix : remove redundant performance . measure usage ( # 79475 ) ` performance . measure ` here is causing problems but i also do not see the point of keeping it , so this pr deletes it . closes ndx - 1050 fixes https : / / github . com / vercel / next . js / issues / 79188
221	docs : add missing ` default ` to page component examples ( # 73233 ) hi team . this pr updates the page component examples in the documentation to include the missing default export . co - authored - by : sam ko <sam @ vercel . com>
222	docs ( javascript ) : add module exports and experimental metadata ( # 71238 ) # # ðŸ“šimproving documentation hello , i ' ve added ` module . exports ` and ` version : experimental ` metadata . since the configuration uses ` experimental ` key , i believe it ' s necessary to include ` version : experimental ` in the metadata . additionally , in other parts of the documentation , ` module . exports ` is always present like the screenshot below . ! [ image ] ( https : / / github . com / user - attachments / assets / 4768bd9d - b6d8 - 4b4b - a74c - 93c56094c9ea ) co - authored - by : jj kasper <jj @ jjsweb . site>
223	turbopack : share entrypoint template logic between turbopack / webpack ( # 82385 ) # # goal with three different bundlers , we ' re often forced to duplicate next . js - specific logic and configuration across two or three different bundlers . e . g . https : / / github . com / symind / next - rspack - binding / would cause us to duplicate our current externals logic across all three . to help , we ' d like to have a shared crate that can be used in a few different ways : - via turbopack ( which is itself called through native napi bindings ) - via direct native napi bindings to js for webpack - via wasm bindings to js for webpack [ * ( note : ideally these would be replaced with napi ' s recent wasm support , but it doesn ' t make sense to do that until after the napi v3 migration is done ) * ] ( https : / / napi . rs / blog / announce - v3 # webassembly ) - via rspack ( we ' d build a custom binary ) the wasm bindings ( in their current state ) and rspack cannot ( or should not ) depend on ` turbo - tasks ` . however , all of the current ` next - * ` crates depend on ` turbo - tasks ` . this introduces a ` next - taskless ` crate for code that can be isolated from performing io and that does not need to depend on ` turbo - tasks ` . code in this crate can be used from wasm or rspack . # # this pr as a proof - of - concept , this deduplicates our next . js entrypoint templating logic across webpack and turbopack . it ' s a large function that doesn ' t need to directly depend on file io . some path manipulation had to be moved out of ` turbo - tasks - fs ` to support this , so that code is in ` turbo - unix - path ` . i ' m happy to accept different bikeshedded crate names . # # testing tested wasm with : ` ` ` pnpm i pnpm swc - build - wasm - - target nodejs pnpm build node_test_mode = start next_test_wasm = true next_skip_native_postinstall = 1 next_test_prefer_offline = 1 node run - tests . js test / production / pages - dir / production / test / index . test . ts ` ` ` tested turbopack with : ` ` ` pnpm i pnpm swc - build - native pnpm build pnpm test - start - turbo test / production / pages - dir / production / test / index . test . ts ` ` ` tested webpack with : ` ` ` pnpm i pnpm swc - build - native pnpm build pnpm test - start test / production / pages - dir / production / test / index . test . ts ` ` `
224	update rspack production test manifest ( # 80038 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
225	[ test ] move remaining ` experimental . cachelife ` ( # 85467 )
226	test : fix redundant double spaces ( # 72055 ) # # ðŸ“š fixed typos hello , i ' ve fixed redundant double spaces in ` test / . stats - app / app ` . co - authored - by : jj kasper <jj @ jjsweb . site>
227	[ dev - overlay ] inject ` getsquashedhydrationerrordetails ` implementation ( # 80046 ) same as with ` get * stack ` implementation
228	turbopack chunking : use chunkablemodules in ` chunk_content ` , not chunkitems ( # 74040 ) this : - replaces all use of chunk items in the interface for ` chunk_content ` with chunkablemodules - moves ` is_self_async ` from ` chunkitem ` to ` module ` - renames ` availablechunkitems ` to ` availablemodules ` and all associated structs and methods , using modules in place of chunk items - - - - - - - - - co - authored - by : tobias koppers <tobias . koppers @ googlemail . com>
229	[ devtools ] add dialog behavior to panel ui ( # 80355 ) # # # testing plan open storybook and goto ` dev - overlay > with panel ` or ` devtools - panel > default ` https : / / github . com / user - attachments / assets / d1b08482 - 9382 - 4a1c - 906d - a8e9d7c68f66 closes next - 4516
230	update docs for adding imagekit reference ( # 69554 )
231	docs ( parallel - routes ) : update 11 - parallel - routes . mdx example for modal closing ( # 72210 ) docs ( parallel - routes ) : update 11 - parallel - routes . mdx example for modal closing - updated ` 11 - parallel - routes . mdx ` to replace ` ' . . . ' ` with ` null ` in the ` page . tsx ` return statement inside the slot for closing the modal when navigating using ` link ` . - also applied the same change in the ` default . tsx ` file to ensure consistent behavior in the example . ! [ image ] ( https : / / github . com / user - attachments / assets / e0c4b2cf - 01e1 - 4cda - 8488 - 11d12a75d32a ) ! [ image ] ( https : / / github . com / user - attachments / assets / fca6d051 - 8e43 - 4022 - 986c - 60557d5da5e6 ) < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - > co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com>
232	update rspack development test manifest ( # 83208 ) this auto - generated pr updates the development integration test manifest used when testing rspack .
233	[ devtools ] fix turbopack indicator ( # 80753 )
234	chore : ensure next . js is built with a specified version of typescript ( # 71256 )
235	refactor : rename als instances to prevent bad auto imports ( # 73480 ) this is a little quality - of - life improvement , with no behavioral changes . it ' s slightly silly though . for bundling reasons , our alses should only ever be imported from ` some - async - storage . external ` , not ` some - async - storage - instance ` . unfortunately editor autocomplete doesn ' t care about that , and always suggests ` - instance ` first . we can solve this by renaming the undesireable one from ` someasyncstorage ` to ` someasyncstorageinstace ` , which makes it rank lower in the autocomplete suggestions , so the top suggestion becomes the correct one . before the rename : <img width = " 617 " alt = " screenshot 2024 - 12 - 03 at 17 53 24 " src = " https : / / github . com / user - attachments / assets / 750f653a - f108 - 4fbf - 9da5 - 4825dac6389d " > after the rename : <img width = " 587 " alt = " screenshot 2024 - 12 - 03 at 17 52 45 " src = " https : / / github . com / user - attachments / assets / fa016050 - 9df3 - 44fb - b0c1 - 2821f84696dc " > # # # alternatives considered marking the instance with ` / * * @ ignore * / ` doesn ' t work , because jsdoc comments propagate to reexports , so it hides * both * from autocomplete , which sucks .
236	remove js size reporting from next build ( # 83815 ) # # what remove the ` first used js ` and ` size ` metrics from ` next build ` cli output , as well as the manifest files that supported these metrics . # # why a recent investigation has revealed a number of bugs and longstanding known issues in the implementation . * the metrics produced by webpack builds for app router don ' t account for layouts and parallel routes correctly . * not only are they not accounted for in route sizes , they are treated as distinct routes for the ' uniqueness ' computation which means dependencies of a widely shared layout wouldn ' t be treated as ' common chunks ' * the ` first used js by all ` metric counts ` . css ` chunks as js * this happened to predominately affect turbopack reporting due the above issue in webpack ( css deps of layouts don ' t get treated as common deps ) * in app router , client components are not accurately modeled by either toolchain * webpack doesn ' t account for client components at all . leading to consistent undercounts * turbopack accumulates all referenced client components which is better but can be an overcount for conditionally rendered or mutually exclusive components . * in pages router , ` next / dynamic ` dependencies can confuse these metrics generally , if a server is using any non - trivial logic to decide what is rendered there is just no correct answer to the ' first load js size ' question . these metrics originally came out of a collaboration with chrome devrel back in 2019 ( maybe ? first reference i think is https : / / github . com / vercel / next . js / pull / 7194 ) . since then , the web has shifted to core web vitals and indeed that is what we use to evaluate actual performance . we ' ve decided to remove the metric instead as it ' s misleading at this point . see # 83823 for docs updates
237	fix ( next / image ) : improve query string validation for integers ( # 67293 ) the image optimization api currently uses ` parseint ( ) ` for ` w ` and ` q ` query string parameters . this doesn ' t handle floats as you might expect and instead coerces , for example ` parseint ( ' 99 . 9 ' ) = = = 99 ` . this pr changes the runtime to match the build time validation and only accept integers for ` w ` and ` q ` .
238	[ turbopack ] allow to disable tree shaking ( # 71114 ) # # # what ? this fixes ` experimental . turbo . treeshaking : false ` and allows to disable tree shaking
239	[ turbopack ] respect vccellmode in traitref : : cell ( # 68473 ) * this is a migrated pr . this was in the turbo repository before the next . js merge . * * * migrated from : * * https : / / github . com / vercel / turbo / pull / 8870 # # # description building on the ` vccellmode : : raw_cell ` api from # 68467 and the addition of ` valuetype : : raw_cell ` in # 68472 , this fixes an edge case where ` traitref : : cell ` didn ' t respect ` vccellmode ` and acted like it was always using ` cell = " new " ` . i noticed this problem while working on local ` vc ` resolution . because ` traitref ` doesn ' t know the real concrete type at compile time , this wasn ' t possible to fix without these new type - erased ` raw_cell ` apis . the consequences of this bug are mostly just that some data might get recomputed in certain rare edge cases ( most stuff doesn ' t use ` traitref ` s heavily ) . # # # testing instructions a regression test is included , which fails without the other changes included in this pr . ` ` ` cargo nextest r - p turbo - tasks - memory trait_ref ` ` `
240	fix ( test / e2e / prerender ) : remove race condition in test ( # 77222 ) fixed ` settimeout ` s in tests are bad for flakiness , as they introduce potential race conditions . https : / / vercel . slack . com / archives / c07uchrbwgk / p1742074798403739 instead of using a fixed timeout , check for a special marker file in a loop every 100ms .
241	refactor : reorganize patch console ( # 70374 )
242	run changed / added tests in deploy mode ( # 67612 ) leverages the work from https : / / github . com / vercel / next . js / pull / 66445 to download artifacts for a particular commit sha , so that it can be passed to the ` test - deploy ` script . this will let us run deploy tests on prs , ensuring that they ' re run from the next . js on the target branch rather than ` canary ` . this waits until ` test - new - tests - dev ` and ` test - new - tests - start ` complete for 2 reasons : - no reason to waste deploy resources if the changed / added tests don ' t even work in dev / start - it gives time for deploy - tarball to finish sample run : https : / / github . com / vercel / next . js / actions / runs / 9865244781 / job / 27241944533 ? pr = 67612 # step : 28 : 54
243	sort next - server nft json files ( # 79956 ) for more deterministic build outputs ( at least with turbopack )
244	revert " revert " [ turbopack ] compute import traces for issues " " ( # 80220 ) reverts vercel / next . js # 80215 which was a revert of vercel / next . js # 79351 closes pack - 4105
245	refactor ( turbopack ) : remove lazy_static dependency ( # 80226 ) # # why lazy_static is deprecated , see [ officially deprecate lazy_static # 214 ] ( https : / / github . com / rust - lang - nursery / lazy - static . rs / issues / 214 )
246	[ turbopack ] simplify ` request : : parse ( pattern ) ` the recursive portion doesn ' t need to be async ( # 80510 ) # # optimize request parsing in turbopack core resolver # # # what ? refactored the ` request : : parse_ref ` method and related functions to improve performance by : - converting async functions to synchronous where possible - normalizing patterns before parsing to improve cache hits - handling alternatives pattern separately in the async ` parse_inner ` function - adopt ` rcstr ! ` in a few places # # # why ? this should be a small perf enhancement , basically just noticed the ` box : : pin ` calls and decided to track down what was fundamentally async .
247	chore ( turbopack - browser ) : pedantically fix minor typos in comments about traitref ( # 73772 ) i was looking for callsites of ` traitref ` and found these minor typos , which annoyed me a bit , so i ' m fixing them : - it ' s ` traitref<box<dyn foo>> ` , not ` traitref<vc<box<dyn foo>>> ` . - this is a reference to an associated function , so it should use a turbofish . - re - wrap with the newer fixed 120 column line wrap for columns .
248	docs ( typo ) : fix redundant double spaces ( # 71137 ) # # ðŸ“š improving documentation hello , i ' ve fixed redundant double spaces in ` docs / 02 - app / 02 - api - reference / 02 - file - conventions / loading . mdx ` and ` docs / 02 - app / 02 - api - reference / 02 - file - conventions / route . mdx ` . co - authored - by : jj kasper <jj @ jjsweb . site>
249	[ metadata ] fix the metadata route like pages and refactor utils ( # 77264 ) # # # what - fix the metadata route like pages rendering , e . g . ` / sitemap / page . js ` should still work properly rather than being treated as route - refactor metadata utils , should prefer using the file matcher rather than just checking the route or page path if possible to determine if it ' s metadata route previously the metadata regex didn ' t handle the route well . for example : when it ' s not checking the end , ` / opengraph - image - abc ` can still be matched , but actually it ' s not a valid metadata route . this pr refines the route / file path regex matching for metadata entries and add more tests . the underlayer helper - ` ismetadataroutefile ` , you can use it to check if a file path is an metadata entry . the helpers built on top of it : - ` ismetadatapage ` : determine if a page path is metadata route , the input is more like a pathname . - ` ismetadataroute ` : determine if a route is metadata route , the input contains nextjs route suffix like ` / route ` . we change the most of places to use ` ismetadataroutefile ` if possible , since it ' s more accurate , especially when we check the static metadata routes , e . g . ` / opengraph - image . png ` , ` / opengraph - image . js ` will require the extension check and strict matching on file name convention . closes # 77250 fixes # 76747
250	chore ( github ) : initialize triage_with_ai . yml workflow again ( # 68292 ) # # why ? there is no way to test opening an issue without clever hacks . so need to initialize again to see the payload object , which will be necessary when i set up a tool call â†’ zod schema with the : ai - stonks : sdk . - - - - - - - - - co - authored - by : jj kasper <jj @ jjsweb . site>
251	docs : fix documentation ( # 67013 )
252	chore : remove dead code from reactdevoverlay ( # 74702 ) # # # what ? removes unused props and simplifies the error boundary implementation in the react dev overlay component . # # # why ? the overlay had unnecessary complexity with unused props like ` preventdisplay ` and ` globaloverlay ` that weren ' t providing value . simplifying the implementation makes the code more maintainable and easier to understand . # # # how ? - removed ` preventdisplay ` and ` globaloverlay ` props from reactdevoverlay - simplified errorboundary component by removing global overlay handling - updated type definitions for errordebug component - cleaned up error display logic in hooks - updated tests to reflect new component structure
253	[ test ] use new redbox matchers in app / undefined - default - export ( # 76781 ) missing stack tracked in https : / / linear . app / vercel / issue / ndx - 920 /
254	turbopack : add turbo_tasks : : run to run in turbo tasks scope without a task ( # 83847 ) # what ? refactor try_read_task_cell to take option arguments instead of having an _untracked method add turbo_tasks : : run to run in turbo tasks scope without a task use the new method in some test cases where it was possible
255	ensure datadog upload is skipped for forks ( # 76238 ) follow - up to https : / / github . com / vercel / next . js / pull / 73180 ensures we don ' t run this for forks which was dropped in the pr . x - ref : https : / / github . com / vercel / next . js / actions / runs / 13422276429 / job / 37497537420 ? pr = 75784
256	upgrade react from ` ff628334 - 20250205 ` to ` 8759c5c8 - 20250207 ` ( # 75796 ) co - authored - by : sebastian sebbie silbermann <sebastian . silbermann @ vercel . com>
257	postcss : fix failures processing . postcssrc . json ( vercel / turbo # 8303 ) we create ` internal ` ` referencetype ` s for these config files that need to be processed as json . this sets the moduleeffect for json types to run on all references , like other file types . test tbd
258	feat ( turbopack ) : add simple tree shaker ( # 78286 ) # # # what ? implement a simple tree - shaking . simple tree shaking is a tree - shaking implementation that only has two options for each export : used / unused . this information is shared among the whole application , so there ' s no fine - grained control for each export . # # # why ? because advanced tree shaking requires some more time to implement .
259	ensure we normalize . rsc / . prefetch . rsc ( # 80409 ) when we match a ` . rsc ` or ` . prefetch . rsc ` path we need to normalize the url used to not include this as it could leak through to the canonical url used for rendering and with ` usepathname ( ) ` . x - ref : [ slack thread ] ( https : / / vercel . slack . com / archives / c08vdslknvc / p1749551233763969 )
260	unflake ` undefined default export ` test ( # 79632 ) [ flakiness metric ] ( https : / / app . datadoghq . com / ci / test / runs ? query = test_level % 3atest % 20env % 3aci % 20 % 40git . repository . id % 3agithub . com % 2fvercel % 2fnext . js % 20 % 40test . service % 3anextjs % 20 % 40test . status % 3afail % 20 % 40test . name % 3a % 22undefined % 20default % 20export % 20should % 20error % 20when % 20page % 20component % 20export % 20is % 20not % 20valid % 22 % 20 % 40git . branch % 3acanary & agg_m = count & agg_m_source = base & agg_t = count & currenttab = overview & eventstack = & fromuser = false & index = citest & start = 1746962081472 & end = 1748258081472 & paused = false ) the test ' s flakiness started to increase significantly on 5 / 21 . <img width = " 414 " alt = " screenshot 2025 - 05 - 26 at 13 18 29 " src = " https : / / github . com / user - attachments / assets / 3996cbd1 - 4a54 - 412d - 9578 - 317f967030fd " / > using [ these ] ( https : / / github . com / vercel / next . js / actions / runs / 15249566684 / job / 42888664439 ? pr = 79565 ) [ two ] ( https : / / github . com / vercel / next . js / actions / runs / 15251316578 / job / 42888825737 ? pr = 79629 ) test runs as examples , we can see that the ` / _error ` page takes quite a long time to compile , which then leads to a timeout while waiting for the ` # __next ` element on the error page to be present in the dom . looking at the [ canary release from this day ] ( https : / / github . com / vercel / next . js / releases / tag / v15 . 4 . 0 - canary . 45 ) , it might be related to # 79260 . in fact , running the test before and after this pr uncovers a significant increase in dev compilation times for the ` / _error ` page , which is a pages router page . <img width = " 230 " alt = " screenshot 2025 - 05 - 26 at 13 27 23 " src = " https : / / github . com / user - attachments / assets / 00381ab1 - 3a75 - 4306 - b184 - 8a14b906d1ff " / > we ' ll address this regression in a follow - up .
261	[ docs ] update other params type of metadata image routes ( # 84491 ) co - authored - by : joseph chamochumbi <joseph . chamochumbi @ vercel . com>
262	stop handling hydration errors from unsupported react versions ( # 67903 )
263	turbopack : split task_execution_completed into multiple methods ( # 84170 ) # # # what ? code organization . also makes it more visible in cpu profiles .
264	[ turbopack ] custom persistence layer ( # 73029 ) this adds a new custom database implementation for persistent caching . why is this better than an existing database ? it can be implemented especially for our use case and can come with assumptions and restrictions that other database can ' t have . what is special about our use case ? * we only do one write at a time , but in a single very large transaction that can potentially push gbs into the database . * we want to fill that large transaction from multiple threads . * the initial cold build is very important from performance perspective . how do we tackle that ? * we only allow a single writebatch at a time , but we start writing to disk while filling that write batch . * when we commit the writebatch we write a sequence number to make these writes visible * once written and committed , files are immutable ( but they can be deleted ) * every writebatch writes additional files that logically override the values from earlier files . ( deletions are stored as tombstones ) * when the average files to read reaches a threshold we do a compaction . * a compaction runs a merge on multiple files to create new sorted files . this reduces that metric . * we limit the number of merged files to avoid long compactions . * in every file we store a key range , an amqf to quickly find out if a key can be in that file . the false positive rate per file is 0 . 1 % . * when we need to lookup a key in a file we do a binary search as keys are stored in sorted order ( sorted by their hash ) . * files are split into blocks that are stored compressed with lz4 with a two shared compression dictionary per file ( one for keys and one for values ) * we have an additional index block to find the right key block without a search . * we support multiple key families to split the database for different kinds of data . * depending on the size of the value it will be stored : 1 . in a block with other small values , 2 . in it ' s own block , 3 . in a separate file . * we have a block cache to cache decompressed blocks . * we have a amqf to cache deserialized filters * files are memory mapped for reading to leverage os cache and memory see more details in the added readme . md file .
265	handle uncaught exceptions in worker ( # 69335 ) previously any uncaught exception in a build worker would lead to the worker process being exited . this change adds a custom handler to only terminate the process if the error is a next . js specific api that expects to be called in a context where the framework can observe it . other errors that are uncaught are logged but won ' t terminate the worker process .
266	add 16 . 0 . 0 - beta . 0 to next / third - parties peerdeps ( # 84741 ) installing ` @ next / third - parties ` warns about peerdeps ` next @ 16 . 0 . 0 - beta . 0 ` ` ` ` results : 0 errors 41 unmodified 0 skipped 0 ok time elapsed : 2 . 276seconds âœ” codemods have been applied successfully . âš  found 1 dependency that seem incompatible with the upgraded package versions . you may have to update these packages to their latest version or file an issue to ask for support of the upgraded libraries . @ next / third - parties 16 . 0 . 0 - beta . 0 â””â”€â”€ âœ• unmet peer next @ " ^ 13 . 0 . 0 | | ^ 14 . 0 . 0 | | ^ 15 . 0 . 0 " : found 16 . 0 . 0 - beta . 0 ` ` ` - - - - - - - - - co - authored - by : vercel [ bot ] <35613825 + vercel [ bot ] @ users . noreply . github . com>
267	refactor ( turbo - tasks ) : use an execution id instead of the parent task id to prevent local vc escapes ( # 78487 ) re - using the task id just for the ` vc ` scope escape check isn ' t ideal : - a task can execute multiple times . just using task ids doesn ' t guarantee that the ` vc ` hasn ' t leaked across multiple executions of the same task . - this is just a fallback check to help with debugging , so allocating 32 bits to this id seems wasteful . we can do a good job with 16 bits . nothing else really needs the task id , so we can get rid of it later in this pr stack . a version of this idea was part of the original local tasks idea : https : / / www . notion . so / vercel / resolved - vcs - vc - lifetimes - local - vcs - and - vc - refcounts - 49d666d3f9594017b5b312b87ddc5bff ? pvs = 4 # da95dbdc390144a9bb1b3d2fb73867b7 even with this extra 4 bits , the overall enum size is still 16 bits due to alignment and the size of the other enum variants , so this shouldn ' t regress memory consumption . the next pr ( https : / / github . com / vercel / next . js / pull / 78561 ) removes ` taskid ` entirely . . .
268	docs : we have dropped the cors example linked ( # 84065 ) we have dropped the example linked in this page . i ' ll re - evaluate later if the section is still enough for a dev to understand how to set cors related headers .
269	add dev warning for cross - origin and stabilize alloweddevorigins ( # 77044 ) adding a warning when we block cross - origin requests in dev so users are aware this is why easier and know how to allow the origin through as custom setups can use different origins and it be valid . x - ref : https : / / github . com / vercel / next . js / pull / 76880 # issuecomment - 2718487112 - - - - - - - - - co - authored - by : jiachi liu <inbox @ huozhi . im> co - authored - by : zack tanner <1939140 + ztanner @ users . noreply . github . com>
270	update turbopack production test manifest ( # 68927 ) this auto - generated pr updates the production integration test manifest used when testing turbopack .
271	[ devtools ] increase max - width / height limit ( # 80846 ) increase the * * default * * ( not only fullscreen mode ) max - width / height of the devtools panel to provide more information to the user . the height will remain pretty much the same unless the user opens the ignored list . closes next - 4566
272	[ turbopack ] remove a bunch of dead code from the source map implementation ( # 84318 ) the ` sourcemap : : sectioned ` enum was only used recursively . once i noticed that a bunch of dead code fell out . part - of pack - 417
273	fix race with hot - reloader - client clearing overlay errors ( # 71771 ) this ` resolvependinghotupdate ` in the ` server_component_changes ` event seems to be causing a race where an error would come through in a fast refresh response and then the overlay would be cleared . i ' m not really sure why we were resolving a pending hot update here because we already call it on ` handlesuccessfulhotupdatewebpack ` and ` tryapplyupdate ` but i ' m consistently seeing correct behavior without this .
274	[ cache components ] fix env labels in perf track test ( # 85132 ) we updated the label for the runtime stage to ` prefetchable ` in # 85076 , and # 85111 wasn ' t rebased on top of that
275	remove unsupportedmodule plugin ( vercel / turbo # 8439 ) this change removes the unsupportedmodule issue module from the codebase . it was used by the unsupportedmodule resolve plugin in next . js , but there are no longer any unsupported modules . this should improve performance as this check was performed during every resolution .
276	turbopack : move tests to backend ( # 80995 ) # # # what ? we no longer have multiple backends , so no need to have these symlink hack to clone tests
277	remove nextcachehandler from request context ( # 71381 ) in # 71263 , we stopped getting ` nextcachehandler ` from the request context and switched to getting it from ` @ next / cache - handlers ` , but it wasn ' t cleaned up from its original location . i ' m assuming we can get rid of it now .
278	fix ( turbopack / napi ) : flush optional task cache hit statistics upon completion of build ( # 75122 ) ` ` ` cd ~ / front / apps / next - site rm - rf . next & & next_turbopack_task_statistics = ~ / build - stats . json turbopack = 1 turbopack_build = 1 turbopack_persistent_cache = 0 / bin / time - v pnpm next build - - experimental - build - mode = compile jq ' to_entries | sort_by ( . value . cache_hit , - . value . cache_miss ) | from_entries ' <build - stats . json >build - stats - sorted . json ` ` ` gives the following ` build - stats - sorted . json ` file : https : / / gist . github . com / bgw / cd3bafbbe08a428334ed9bec10885769
279	docs : update incorrect link address ( # 70836 ) co - authored - by : lee robinson <me @ leerob . io>
280	add missing node modules to externals ( # 70382 ) we should not attempt to bundle builtin node modules on the server . this adds modules provided by node . js to our externals list ( along with some missing internal ones in turbopack . these were copied from [ here ] ( https : / / github . com / vercel / next . js / blob / a675bde6c738318264573144663e38819aeb2661 / crates / next - custom - transforms / src / transforms / warn_for_edge_runtime . rs # l77 - l89 ) ) . fixes # 70262 closes ndx - 314
281	misc ( next - codemod ) : inform user whether current version is higher or on target version ( # 71160 ) " is already on or higher than " is sloppy . inform correctly to the user .
282	refactor : reorganize client error listeners ( # 70373 )
283	use fetchstrategy to control prefetching behavior everywhere ( # 82032 ) replaces ` includedynamicdata ` and ` prefetchkind ` with ` fetchstrategy ` wherever possible . we convert it from into a ` prefetchkind ` in ` router . prefetch ( ) ` , and back into a ` prefetchkind ` when using the old prefetching implementation .
284	updated with - sitemap example for app router ( # 66995 ) hello this pr updates the with - sitemap example to use : 1 . app router 2 . typescript 3 . sitemap . js - - - - - - - - - co - authored - by : sam ko <sam @ vercel . com>
285	hotfix : pages doc ` next - config - js ` was moved from ` 03 ` to ` 04 ` ( # 68370 ) # # # why ? ` types - and - precompiled ` is failing on ci : https : / / github . com / vercel / next . js / actions / runs / 10186089792 / job / 28178038314 # # # how ? the script ` validate - externals - doc . js ` was validating the ` docs / . . . / 03 - next - config - js / . . . mdx ` page , but the page was moved to ` docs / . . . / 04 - next - config - js / . . . mdx ` in https : / / github . com / vercel / next . js / pull / 67839
286	perf ( turbopack ) : use ` resolvedvc ` for ` turbopack - css ` ( # 73172 ) # # # what ? use ` resolvedvc<t> ` instead of ` vc<t> ` for struct fields in ` turbopack - css ` # # # why ? # # # how ?
287	turbopack : scope hoisting ( # 79459 ) enable turbopack to merge modules together ( when possible ) , getting rid of the ` " module id . . . " : ( __turbopack_context__ ) = > { . . . __turbopack_esm_export__ ( { foo : ( ) = > foo } ) ` overhead : <img width = " 1591 " alt = " bildschirmfoto 2025 - 06 - 14 um 14 13 36 " src = " https : / / github . com / user - attachments / assets / b6baccbe - a2c7 - 4acd - b17b - f7bd91c8f349 " / > # # details there is a lot of complexity here , mostly for the problem of when this is actually safe to do . generally , modules can only be merged if they are known to always execute in that exact order ( also meaning in every chunk these modules are part of ) . this is done by first propagating a bitmap on the whole module graph , to determine which modules are safe to merge together ( module type is compatible , only esm , etc ) . then , these potential merged groups are linearized in execution order _per chunk_ . these orderings are then split up until every module is just part of a single ordering ( together with the modules that are always executed before / after it , if any ) . each of these orderings then becomes a merged module . this information is then used to replace these modules with the merged version in the middle of chunking ( after the module graph - > vec of modules step , but before turning vec of modules - > vec of chunks ) . for code generation , the runtime helpers are omitted and imports just become straight variable references ( i . e . across modules ) . this ( together with preventing local variable naming collisions in the merged module ) is achieved by leveraging swc ' s syntax contexts ( each module effectively gets it ' s own syntax context , so that variables of the same name don ' t collide , and then imports are rewritten to point to the local variable in the other module ) . comments and source maps work by encoding the module into the ` bytepos ` , so that a given ` bytepos ` in the merged ast can be decoded back into the module that it originated from , to lookup comments and source locations in the right structs .
288	[ segment - explorer ] display the builtin conventions ( # 80961 ) track built - in conventions in segment explorer . the default ` global - not - found . js ` and ` global - error . js ` will be displayed . their style will be different to the others , we ' ll follow up in the later prs . closes next - 4576
289	ensure ` searchparams ` access in ` " use cache " ` triggers error when caught ( # 77838 ) accessing search params in ` " use cache " ` functions is not allowed . we need to make sure that a build or dev error is still triggered even when the ` searchparams ` access is wrapped in a try / catch block . this also fixes a bug where the errors were not correctly source - mapped with turbopack . related : # 75662 closes nar - 86
290	[ cache components ] fix caching in ` generatemetadata ` / ` generateviewport ` ( # 84228 ) when using ` ' use cache ' ` in ` generatemetadata ` or ` generateviewport ` , the caching did not work correctly , because we didn ' t apply the same special handling for the ` params ` and ` searchparams ` props that we do for layout and page components . this caused the following issues : - ` generatemetadata ` / ` generateviewport ` for a page without params , or with static params , yielded cache misses when resuming - ` generatemetadata ` for a page / layout with unused params , became dynamic when prerendering a fallback shell - ` generatemetadata ` for a page with used search params , produced a timeout error during prerendering - ` generateviewport ` for a page / layout with unused params , produced a build error ( unless opting into fully dynamic rendering ) still to be done in a follow - up : omit unused ` params ` from cache keys , and upgrade cache keys when they are used , to avoid unnecessary cache misses when resuming . closes nar - 321
291	revert " [ turbopack ] add rocksdb " ( # 72505 )
292	[ test ] fix flaky error - recovery test ( # 76753 ) fixes https : / / github . com / vercel / next . js / actions / runs / 13628820428 / job / 38093524162
293	update unstable_nostore . mdx ( # 70024 ) clarify that ` unstable_nostore ( ) ` is only for use inside of server components to opt - out of static rendering , client component though initially server rendered cannot call this function as it is a server - side only function co - authored - by : jj kasper <jj @ jjsweb . site>
294	test : fix next - form tests when running on react 18 ( # 70704 ) fixes some broken tests from # 68333 . they were skipped , but still crash in ` start ` mode , because they try to use ` useactionstate ` and crash during prerendering ( because 18 doesn ' t have that ) . we turn those pages into noops instead - - the tests that use them are skipped anyway .
295	turbopack : expose client static assets correctly ( # 84695 ) this is about whether ` new url ( " logo . png " , import . meta . url ) ` and ` import logo from " . / logo . png " ` return a client or a server asset : - a server asset is a file that will be read by the server during rendering , for example a wasm or font file ( if you think about vercel / og image generation ) . it ' s stored on the server next to the js chunks - a client asset is a file that will be used by the browser , e . g . for an ` <img src = { logo } / > ` usecase . it will be stored on the cdn and have the ` _next / ` prefix . for - client contexts , it ' s easy : all imports are client assets ( unsurprisingly ) - ssr contexts , we emulate the client ( to prevent hydration mismatches ) - api / metadata context , it ' s less clear cut what should happen , but we arbitrarily do the following : ` new url ` returns server assets and ` import logo ` returns client assets . that very last case of having client assets for imports , and server assets for ` new url ` wasn ' t implemented in turbopack . turbopack doesn ' t change anything here fundamentally , but webpack appears to have some bugs where this is less consistent ( across nodejs / edge and api / metadata routes for example ) . see tests added in https : / / github . com / vercel / next . js / pull / 84636 closes pack - 4874 closes pack - 5649 closes # 80577
296	fix : proxy not picked up on windows ( # 85443 ) proxy is not being picked up during prod on windows . it is because of two reasons : 1 . ` isatconventionlevel ` condition was false as the dir was ` \\ ` in windows , but was checking with explicit ` / ` . 2 . ` page ` value passed to ` getstaticinfoincludinglayouts ` function was in ` \\proxy ` but was expected to be ` / proxy ` , which is later used for ` isproxy ` condition . therefore , the given paths needed to be normalized . current behavior : https : / / github . com / vercel / next . js / actions / runs / 18872127141 / job / 53853048061 ? pr = 85443 # step : 34 : 160 closes next - 4756
297	fix symbol for cache ( # 71270 ) small follow - up to https : / / github . com / vercel / next . js / pull / 71263 this should be ` symbol . for ` so we use the same reference instead creating a new symbol .
298	fix : make sure caller exists in babel preset ( # 84154 ) # # # what ? https : / / github . com / vercel / next . js / pull / 82676 introduced a small bug when using the babel preset standalone without next . js itself . it throws the following error : ` ` ` cannot read properties of undefined ( reading ' transformmode ' ) ( while processing : " / home / runner / work / my - project / node_modules / next / babel . js " ) ` ` ` # # # how ? other uses of ` api . caller ` in the preset checks if the caller exists before accessing its properties . this pr makes sure we ' re doing the same in the standalone check . co - authored - by : jiwon choi <devjiwonchoi @ gmail . com>
299	sync nft test suite from upstream ( # 81189 ) prompted by https : / / github . com / vercel / next . js / pull / 81186 zeromq fails with : ` ` ` 2025 - 07 - 02t18 : 18 : 18 . 6796394z fail [ 2 . 187s ] turbopack : : node - file - trace node_file_trace_noop_backing_storage : : case_109_zeromq error : failed to load zeromq . js addon . node : error : enoent : no such file or directory , open ' / private / var / folders / s5 / 952zt8mn6ms05__7r749hkjm0000gn / t / tests_output / persistent_cache_node - file - trace / integration / zeromq . js / tests / node - file - trace / node_modules / . pnpm / zeromq @ 6 . 4 . 2 / node_modules / zeromq / build / manifest . json ' ` ` ` probably because of ` __importdefault ` here ` ` ` js var __importdefault = ( this & & this . __importdefault ) | | function ( mod ) { return ( mod & & mod . __esmodule ) ? mod : { " default " : mod } ; } ; const fs_1 = __importdefault ( require ( " fs " ) ) ; const path_1 = __importdefault ( require ( " path " ) ) ; const manifest = json . parse ( fs_1 . default . readfilesync ( path_1 . default . resolve ( builddir , " manifest . json " ) , " utf - 8 " ) ) ; ` ` ` created pack - 4987 to track that
300	docs : fix 10 - dynamic - routes . mdx ( # 70126 ) params from ` { } ` to ` { slug : undefined } ` . fixes # 70124
301	chore : fix eslint - typechecked - require with template ( # 82328 )
302	[ dev - overlay ] : fix invalid font in info panels ( # 76519 ) fixes a typo
303	turbopack : respect ` - - profile ` cli param ( # 84920 ) previously , ` next build - - profile ` wasn ' t doing anything , it was still using the non - profiling react build . specifying it in next . config . js was already working . but we didn ' t copy over the cli flag into ` config . reactproductionprofiling ` for turbopack .
304	turbopack : fix search_index merging in trace server ( # 78625 ) fix a regression in https : / / github . com / vercel / next . js / pull / 78357 bug found by @ sokra as well : https : / / github . com / vercel / next . js / pull / 78357 # discussion_r2063544480
305	turbopack : fix race condition in test case ( # 82728 ) # # # what ? fixes a race condition in the test case . since we are using a single value for multiple vcs ( via readref : : cell ) the counter can have multiple invalidators .
306	misc : add ` . cursorignore ` ( # 74763 ) this pr added a ` . cursorignore ` file to ignore * * 27 , 500 files * * for cursor to index . ` ` ` . gitignore # the reverse pattern did not work . * ! packages / * * ` ` ` # # # before ! [ cleanshot 2025 - 01 - 11 at 03 47 56 ] ( https : / / github . com / user - attachments / assets / 21ebf15b - 301f - 4238 - b500 - 1e21529130cf ) # # # after ! [ cleanshot 2025 - 01 - 11 at 03 58 50 ] ( https : / / github . com / user - attachments / assets / f3842039 - c6e5 - 43e0 - 924b - ac1c24ebd281 )
307	ensure deploymentid is used for css preloads ( # 77210 ) this just ensures we use the deployment id if configured for preload css links . x - ref : [ slack thread ] ( https : / / vercel . slack . com / archives / c03s8ed1dkm / p1742146672858189 )
308	ensure tags are fetched for release branch ( # 83012 ) follow - up to https : / / github . com / vercel / next . js / pull / 83006 this ensures we actually pull the tag refs otherwise we can ' t reset to them . verified here : https : / / github . com / vercel / next . js / actions / runs / 17217751382
309	fix ( turbo - persistence ) : fix ` verify_sst_content ` feature , improve unit test performance ( # 78388 ) # # why ? i ' m trying to run https : / / github . com / boshen / cargo - shear over our workspace to remove unused dependencies . it runs ` cargo expand ` with ` - - all - features ` , which was breaking on this crate . # # changes summary - add ` opt - level = 1 ` in dev for this crate . - reduce the iterations used in tests . if we really want tons of iterations , we should use benchmarks or write a fuzzer utility . unit tests should be small and fast . - increase the test for blobs to use a 65kib blob size and assert that ' s larger than the blob threshold . - cleanup : use the more - correct ` u32 ` type for the ` family ` field in a few more places instead of ` usize ` and make the numeric representations of the ` keyspace ` enum a bit more explicit . # # prior to these changes - building with ` - - features turbo - persistence / verify_sst_content ` would fail with compilation errors - unit tests would take multiple minutes to run - the blob test didn ' t appear to actually test blobs ( 10kib < 64kib ) # # after these changes - the ` verify_sst_content ` feature works and passes unit tests - unit tests finish in about a minute with ` cargo test ` and ` cargo nextest ` , this is still slow , but much better than it was . - unit tests actually test blobs as intended . ! [ screenshot 2025 - 04 - 21 at 2 . 12 . 32 pm . png ] ( https : / / graphite - user - uploaded - assets - prod . s3 . amazonaws . com / hazvitxrnnzz8qmipn4a / ff7aa104 - c193 - 4514 - 9fde - 1a6fcc11acf8 . png ) # # potential future work it would be useful to be able to adjust the medium and large ( blob ) size thresholds to allow us to lower those thresholds in tests .
310	fix ( webpack ) : update cssnano - preset - default to v7 ( # 68748 ) # # why ? our default css minifier had a bug â†’ https : / / github . com / cssnano / cssnano / issues / 1655 , which was also reported ( below ) . since it is now fixed upstream , we need to update our cssnano in next . js . - fixes https : / / github . com / vercel / next . js / issues / 68476 # # how ? - update ` cssnano - preset - default ` to v6 - add unit test to cover the case for being able to declare layer names ( the added unit test errors in an way that ' s unreadable on canary ) ! [ cleanshot 2024 - 11 - 04 at 22 32 32 @ 2x ] ( https : / / github . com / user - attachments / assets / ef3a302a - 2aec - 4b63 - 9db2 - 40869daaf5ad )
311	turbopack : make ` turbopack - ecmascript ` rust 2024 ( # 79132 ) these were all https : / / doc . rust - lang . org / nightly / edition - guide / rust - 2024 / match - ergonomics . html
312	use random port for cargo test ( # 70926 ) we can ' t guarantee this port will always be available so use random one instead x - ref : https : / / github . com / vercel / next . js / actions / runs / 11221640914 / job / 31192432034
313	update turbopack development test manifest ( # 78225 )
314	docs ( mdx ) : add a dynamic imports section for app router ( # 73466 ) # # why ? adding a section dedicated to dynamically importing mdx files inside pages for app router . - x - ref : https : / / github . com / vercel / next . js / discussions / 70417 - - - - - - - - - co - authored - by : lee robinson <me @ leerob . io>
315	docs : minor fixes in the next / head doc ( # 70510 ) # # # what ? updated the documentation for ` next / head ` to clarify how ` <title> ` and ` <base> ` tags are handled uniquely . specifically , the documentation states that these tags are automatically checked for duplicates by next . js and do not require the ` key ` attribute . # # # why ? the current documentation suggests using the ` key ` attribute to prevent duplicate tags in the ` head ` . however , ` <title> ` and ` <base> ` tags are automatically managed by the ` unique ` function in next . js ( ` head . tsx ` ) , ensuring only one instance is rendered without needing a ` key ` . this update provides clearer guidance and prevents potential misunderstandings . # # # how ? - added a note explaining that ` <title> ` and ` <base> ` tags do not need a ` key ` attribute as they are automatically checked for duplicates by next . js . # # # reference source code confirming this behavior : [ head . tsx # l85 - l93 ] ( https : / / github . com / vercel / next . js / blob / 3ead2d1fe98f78307861b12983c76d5a7a88c41a / packages / next / src / shared / lib / head . tsx # l84 - l93 ) <img width = " 741 " alt = " window " src = " https : / / github . com / user - attachments / assets / a3a6f3fd - 6aab - 48a2 - 8d15 - 26df0692b0e1 " > co - authored - by : jj kasper <jj @ jjsweb . site>
316	prevent client prefetch stream from closing ( # 72420 ) based on : - # 72418 - - - when ppr is enabled , prefetch streams may contain references that never resolve , because that ' s how we encode dynamic data access . in the decoded object returned by the flight client , these are reified into hanging promises that suspend during render , which is effectively what we want . the ui resolves when it switches to the dynamic data stream ( via usedeferredvalue ( dynamic , static ) ) . however , the flight implementation currently errors if the server closes the response before all the references are resolved . as a cheat to work around this , we wrap the original stream in a new stream that never closes , and therefore doesn ' t error .
317	feat ( build ) : optimize filteruniqueparamscombinations to generate sub - combinations ( # 81321 ) # # # what ? optimizes the ` generateparamprefixcombinations ` function ( previously ` filteruniquerootparamscombinations ` ) to generate all unique sub - combinations of route parameters while ensuring partial shells include complete sets of root parameters . # # # why ? the previous implementation only generated combinations at the root parameter level , which was insufficient for ppr ( partial prerendering ) shells . ppr needs all possible prefix combinations of route parameters to create effective shells for nested routes . for example , for a route ` / [ lang ] / [ region ] / [ slug ] ` , we need shells for : - ` / [ lang ] / [ region ] ` ( complete root params ) - ` / [ lang ] / [ region ] / [ slug ] ` ( full route ) without proper sub - combinations , nested routes couldn ' t benefit from ppr shell optimization , leading to performance degradation . # # # how ? - renamed ` filteruniquerootparamscombinations ` to ` generateparamprefixcombinations ` to better reflect its expanded functionality - added logic to generate all prefix combinations of route parameters , not just root - level combinations - implemented root parameter validation to ensure partial shells only include complete sets of root parameters - added comprehensive test coverage for edge cases including undefined parameters , missing keys , and parameter collisions - optimized the algorithm to skip invalid combinations early when root parameters are incomplete the function now generates prefix combinations systematically while maintaining backward compatibility and preventing invalid partial routes . nar - 159 - - - - - - - - - co - authored - by : hendrik liebau <mail @ hendrik - liebau . de>
318	turbopack : don ' t recompute empty parse results ( # 83883 ) don ' t use the recomputation mechanism for this , just make it an optional .
319	[ test ] use new redbox matchers in server - navigation - error ( # 76787 )
320	add dedicated client entry for turbopack builds ( # 65824 ) previously with turbopack , we would attempt to establish a websocket connection to the hmr server , even when running production builds . this adds ` next - turbopack . ts ` , which includes the necessary runtime code for turbopack , but does not include hmr code . test plan : ` turbopack = 1 turbopack_build = 1 pnpm next build test / e2e / app - dir / app - middleware ` - - - - - - - - - co - authored - by : tim neutkens <tim @ timneutkens . nl>
321	use correct workflow id for v0 ( # 82484 )
322	turbopack build : implement helpful error for missing sass package ( # 80155 ) # # what ? implements the same error message that we add to the webpack handling . i ' m not super happy about this solution ( though it matches what we do for webpack ) ideally we improve the sass - loader error itself in the future but that requires upgrading sass - loader as well and introducing a breaking change . for now this unblocks the test passing .
323	perf ( next - swc ) : do not allocate from ` styled - components ` when not used ( # 75267 ) # # # what ? apply https : / / github . com / swc - project / plugins / pull / 392 # # # why ? we should not create enormous amount of memory operations needlessly .
324	turbopack : only emit ` * . single . css ` chunks in dev ( # 81490 ) they are only ever used in dev . closes pack - 4767
325	upgrade turbopack ( # 67209 ) * https : / / github . com / vercel / turbo / pull / 8546 < ! - - benjamin woodruff - decrease default scope_stress test size , add env var config - - > * https : / / github . com / vercel / turbo / pull / 8563 < ! - - donny / ê°•ë™ìœ¤ - update ` swc_core ` to ` v0 . 95 . 4 ` - - > * https : / / github . com / vercel / turbo / pull / 8556 < ! - - tobias koppers - avoid cloning the source code - - > * https : / / github . com / vercel / turbo / pull / 8562 < ! - - will binns - smith - hmr : handle non - latin characters in text through base64 - encoded sourcemaps - - > * https : / / github . com / vercel / turbo / pull / 8530 < ! - - benjamin woodruff - support turbo tasks inside of ` mod ` blocks - - > * https : / / github . com / vercel / turbo / pull / 8542 < ! - - benjamin woodruff - handle ` # [ cfg ( . . . ) ] ` attributes on turbo tasks - - > * https : / / github . com / vercel / turbo / pull / 8529 < ! - - benjamin woodruff - deduplicate persistent task get_function_name logic - - > * https : / / github . com / vercel / turbo / pull / 8547 < ! - - benjamin woodruff - add new exithandler api as an alternative to exitguard - - > * https : / / github . com / vercel / turbo / pull / 8604 < ! - - benjamin woodruff - delete unused task_id_mapping support - - > * https : / / github . com / vercel / turbo / pull / 8605 < ! - - benjamin woodruff - remove nohash - hasher dependency - - > * https : / / github . com / vercel / turbo / pull / 8559 < ! - - tobias koppers - move stateful flag into done state - - > * https : / / github . com / vercel / turbo / pull / 8598 < ! - - tim neutkens - mdx support : ensure development transform is only used in development - - > * https : / / github . com / vercel / turbo / pull / 8557 < ! - - tobias koppers - reduce size of task output struct - - > * https : / / github . com / vercel / turbo / pull / 8558 < ! - - tobias koppers - remove prepared task type - - > < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
326	feat ( next - codemod ) : add ` upgrade ` command ( # 69935 ) # # # why ? switching between ` canary ` , ` rc ` , and ` latest ` also requires react version changes which could be time - consuming . this is essential for reproduction , confirming issue fixed on canary , and migration . also , to run the codemods for breaking changes , users have to go through the documentation and find which codemods to run for their project . # # # how ? ` @ next / codemod upgrade ` expects the user to select ` canary ` , ` rc ` , or ` latest ` version to upgrade . also , it detects any possible codemods to run , and suggest the user whether to run it . https : / / github . com / user - attachments / assets / 3aa3fee8 - 75f2 - 4178 - b5ce - fef725109d6b - - - - - - - - - co - authored - by : devjiwonchoi <devjiwonchoi @ gmail . com>
327	temporarily skip flaky turbopack build test ( # 72488 ) need to investigate why this flakes only in turbopack . disabling in that context for now .
328	docs : fix typo ( # 66749 ) fix typo in ` unstable_cache ` api page . re : https : / / github . com / vercel / next . js / pull / 66716
329	update turbopack development test manifest ( # 78660 )
330	perf ( turbopack ) : reduce size of ` effectarg ` ( # 74973 )
331	docs : add ` - - debug - build - paths ` next build option ( # 85097 ) related : https : / / github . com / vercel / next . js / pull / 85052
332	turbopack : don ' t revisit nodes ( # 80455 ) don ' t revisit the nodes repeatedly because of differing ` exportusage ` .
333	update rspack development test manifest ( # 79356 )
334	refactor ( napi ) : implement napi traits for rcstr ( # 79806 ) this lets us use ` rcstr ` directly in function arguments and as part of ` # [ napi ( object ) ] ` s . * you can just ` rcstr ` things ! * here ' s an example of rspack doing something similar for a custom napi type : https : / / github . com / web - infra - dev / rspack / blob / 35f1126963d5ba6860e9eba939fd5d62f9aa217f / crates / rspack_regex / src / napi . rs
335	docs : add ` app - dir - runtime - config - experimental - edge ` codemod ( # 71008 ) added missing docs for codemod https : / / github . com / vercel / next . js / pull / 70968
336	[ devtools ] omit line / col numbers for anonymous sources ( # 81223 )
337	docs : create - next - app react - compiler and new prompts ( # 85213 ) update the create - next - app options and prompts
338	update bundler development test manifest ( # 77315 ) this auto - generated pr updates the development integration test manifest used when testing alternative bundlers .
339	fix : update url resolution logic to handle search parameters on root path / ? foo = bar ( # 78262 ) # # what ? this pr fixes and implements test for an url resolution issue that stripped the searchparam when ` metadatabase ` was defined and a search param was set on the root path . this created a behavior where : ` ` ` export const metadata : metadata = { title : " create next app " , description : " generated by create next app " , metadatabase : new url ( " https : / / www . example . com " ) , alternates : { canonical : " / ? foo = bar " , } , } ; ` ` ` would result in ` <link rel = " canonical " href = " https : / / www . example . com " > ` instead of ` <link rel = " canonical " href = " https : / / www . example . com / ? foo = bar " > ` # # related issues - fixes # 65776 - fixes # 74689 co - authored - by : jiwon choi <devjiwonchoi @ gmail . com>
340	docs : update tailwind installation instruction to v4 ( # 75739 )
341	upgrade react from ` 1324e1bb - 20251016 ` to ` 58bdc0bb - 20251019 ` ( # 85072 ) [ diff facebook / react @ 1324e1bb . . . 58bdc0bb ] ( https : / / github . com / facebook / react / compare / 1324e1bb . . . 58bdc0bb ) <details> <summary>react upstream changes< / summary> - https : / / github . com / facebook / react / pull / 34911 - https : / / github . com / facebook / react / pull / 34907 - https : / / github . com / facebook / react / pull / 34906 - https : / / github . com / facebook / react / pull / 34898 - https : / / github . com / facebook / react / pull / 34893 - https : / / github . com / facebook / react / pull / 34892 - https : / / github . com / facebook / react / pull / 34885 - https : / / github . com / facebook / react / pull / 34881 - https : / / github . com / facebook / react / pull / 34894 - https : / / github . com / facebook / react / pull / 34880 - https : / / github . com / facebook / react / pull / 34849 - https : / / github . com / facebook / react / pull / 34900 - https : / / github . com / facebook / react / pull / 34887 < / details>
342	docs : remove repeated to ( # 84325 ) # # # what ? removed an extra " to " # # # why ? semantics error / not required co - authored - by : joseph <joseph . chamochumbi @ vercel . com>
343	enable another turbopack build test ( # 73166 ) we forgot to update the manifest when merging the nft prs
344	refactor ( next - core ) : remove local annotations from structs in next - core / src / app_structure . rs ( # 74200 ) these only need trivial modifications to implement ` nonlocalvalue ` .
345	fix fetch logging after revalidation via server action ( # 82643 ) when revalidating a tag or path with a server action , we do want to log any fetches that are made during the subsequent rerendering , when [ fetch logging ] ( https : / / nextjs . org / docs / app / api - reference / config / next - config - js / logging # fetching ) is enabled . this got accidentally broken in # 64746 , where we wrote : > [ . . . ] this ensures we don ' t keep tracking fetch metrics after the request has ended as we only report on request end that ' s incorrect though , because we report fetch metrics when the _response_ is closed , and not the request : https : / / github . com / vercel / next . js / blob / 0bd7423844e218b19537880a7fa4314749fdf57d / packages / next / src / server / dev / next - dev - server . ts # l530 - l546 this is crucial for server actions , when the request is likely already closed while we ' re rerendering and streaming the response to the client . fixes # 80444 closes nar - 307
346	turbopack : also inline env vars with undefined value ( # 80990 ) previously , only env vars with set values were inline . but some of them , e . g . ` process . env . __next_manual_trailing_slash ` and ` process . env . __next_cross_origin ` are always set , but might be ` undefined ` in the env mapping . don ' t drop these but replace them with undefined , as webpack does .
347	add ability to customize cache - control ( # 69802 ) this continues https : / / github . com / vercel / next . js / pull / 39707 bringing the changes up to date with canary and adds test cases to ensure it ' s working as expected . closes : https : / / github . com / vercel / next . js / issues / 22319 closes : https : / / github . com / vercel / next . js / pull / 39707 closes : ndx - 148
348	exclude changes that already landed in canary when finding changed tests ( # 64218 )
349	[ devoverlay ] add docs link button ( # 74560 ) this pr added a docs link button . it parses whitelisted urls from error messages and links to the first one . ! [ cleanshot 2025 - 01 - 07 at 19 51 24 ] ( https : / / github . com / user - attachments / assets / b97a25b7 - 101d - 412e - 842f - 73da785d7dfe ) closes ndx - 574 closes ndx - 603
350	pass ` starttime ` to initial rsc payload stream ( # 85144 ) ` starttime : 0 ` tells react to align the debug start time of the initial rsc stream ( i . e . the one used for hydration ) to the start of the document navigation . in other words , the timing information will now include the network latency of the html document request .
351	[ dev - overlay ] remove unused storybook addons ( # 75521 ) this pr removed two unused storybook addons : - ` @ storybook / addon - onboarding ` - > unnecessary after onboarding - ` @ chromatic - com / storybook ` - > requires to sign up to chromatic
352	pages router : ensure x - middleware - cache is respected ( # 67734 ) ` x - middleware - cache : " no - store " ` in pages router is a way to signal to the client that it should not store the response in the cache . however in certain circumstances , namely when ` unstable_skipclientcache ` is true , the data request would be awaited and then stored in the ` inflightcache ` regardless of the header . the original implementation of this in the router has logic to delete the response from the inflight cache after the request has fulfilled because ` inflightcache ` stores the unresolved promise . but in this optimistic prefetch case , when we ' re only storing it in the cache once the request is fulfilled , we can prevent a race condition where the ignored prefetch is erroneously re - added to the cache by ensuring it ' s never added to the cache to begin with if the response says not to . fixes # 66881 closes next - 3550
353	support temporary references for server actions ( # 71230 ) implements https : / / x . com / sebmarkbage / status / 1842240773867126939 supersedes and closes # 66054 ( with permission )
354	generate per - segment responses for any static page ( # 73945 ) originally i gated per - segment prefetch generation on the ppr flag , because i thought the client segment cache would require ppr to be enabled on the server . however , since then the strategy has evolved and i do think we can roll out the segment cache independently of ppr . dynamic pages without ppr won ' t be able to take full advantage of the segment cache , but if the page is fully static then there ' s no reason we can ' t implement all the same behavior . so during per - segment prerendering , i ' ve changed the feature condition to check for the ` clientsegmentcache ` flag instead of the ppr one . - - - additionally , when i broadened the feature check , a failing test revealed that i neglected to set up error digest decoding correctly , so the first commit in this stack fixes that .
355	upgrade sharp dependency to version ^ 0 . 34 . 4 ( # 83892 ) # # âœ… sharp dependency upgrade to version ^ 0 . 34 . 4 - lockfile fixed # # # task summary : successfully upgraded the ` sharp ` dependency from version ` ^ 0 . 34 . 3 ` to ` ^ 0 . 34 . 4 ` and * * fixed the pnpm lockfile issue * * by running ` pnpm install ` to update the lockfile . # # # âœ… completed steps : - [ x ] explore repository structure and understand current sharp dependency ( ^ 0 . 34 . 3 in packages / next / package . json ) - [ x ] verify pnpm and corepack availability - [ x ] enable pnpm using corepack in the repository - [ x ] navigate to packages / next directory - [ x ] update sharp dependency from ^ 0 . 34 . 3 to ^ 0 . 34 . 4 using pnpm add sharp @ 0 . 34 . 4 ( manual edit after pnpm command ) - [ x ] update sharp dependency in test / integration / sharp - api / app / package . json for consistency - [ x ] * * fix : run ` pnpm install - - no - frozen - lockfile ` to properly update pnpm - lock . yaml * * - [ x ] * * apply caret range ^ 0 . 34 . 4 instead of exact version per maintainer feedback * * - [ x ] validate json syntax of all modified package . json files - [ x ] verify version numbers are correctly updated - [ x ] run comprehensive verification tests - [ x ] final verification and cleanup completed # # # ðŸ“ changes made : 1 . * * packages / next / package . json * * : updated ` " sharp " : " ^ 0 . 34 . 3 " ` to ` " sharp " : " ^ 0 . 34 . 4 " ` in optionaldependencies ( caret range to allow patch updates ) 2 . * * test / integration / sharp - api / app / package . json * * : updated ` " sharp " : " ^ 0 . 34 . 3 " ` to ` " sharp " : " ^ 0 . 34 . 4 " ` in dependencies ( caret range for test compatibility ) 3 . * * pnpm - lock . yaml * * : * * fixed * * - properly updated with ` pnpm install ` to include sharp @ 0 . 34 . 4 and new ` @ img / colour ` dependency # # # âœ… lockfile fix verification : - âœ… sharp @ 0 . 34 . 4 now properly referenced 2 times in pnpm - lock . yaml - âœ… no remaining sharp @ 0 . 34 . 3 references in lockfile - âœ… new ` @ img / colour @ 1 . 0 . 0 ` dependency included ( replacing old ` color ` package as noted by @ styfle ) - âœ… all platform - specific sharp binaries updated to 0 . 34 . 4 - âœ… lockfile is now consistent with package . json changes - âœ… caret range ` ^ 0 . 34 . 4 ` allows future patch updates while maintaining compatibility # # # ðŸŽ¯ requirements met : - âœ… used ` corepack enable pnpm ` as requested - âœ… attempted ` pnpm add sharp @ 0 . 34 . 4 ` in . / packages / next directory as requested - âœ… * * fixed lockfile issue by running ` pnpm install ` as suggested by @ styfle * * - âœ… * * applied caret range ^ 0 . 34 . 4 instead of exact version per maintainer feedback * * - âœ… successfully upgraded to version 0 . 34 . 4 with proper semver range - âœ… made minimal changes to only necessary files - âœ… maintained existing code structure and functionality the upgrade is complete with the caret version range to allow future patch updates and the ci lockfile error should now be resolved !
356	fix : ensure absolute paths are handled correctly with ` - - file ` option in ` next lint ` command for ` lint - staged ` compatibility ( # 69220 ) helloðŸ˜Š thanks for having attention to this issue . # # # what ? * * fixed a bug . * * the ` next lint ` command ' s ` - - file ` option was intended to allow users to lint specific files directly by specifying their paths . however , it only worked with relative paths and did not handle absolute paths correctly . this limitation hindered the flexibility and usability of the linting process . furthermore , ` lint - staged ` returns absolute paths when running lint commands on staged files . without proper handling of these absolute paths , linting was not performed correctly , leading to issues in automated linting workflows . # # # why ? # # # # environment ( results by ` next info ` ) ` ` ` bash operating system : platform : win32 arch : x64 version : windows 11 home available memory ( mb ) : 16058 available cpu cores : 8 binaries : node : 20 . 12 . 2 npm : n / a yarn : n / a pnpm : n / a relevant packages : next : 14 . 2 . 6 / / latest available version is detected ( 14 . 2 . 6 ) . eslint - config - next : 14 . 2 . 6 react : 18 . 3 . 1 react - dom : 18 . 3 . 1 typescript : 5 . 5 . 4 next . js config : output : n / a ` ` ` # # # # steps to reproduce 1 . make a ` js ` or ` jsx ` file like below . this makes eslint * * error * * named ` no - unused - vars ` ` ` ` javascript / * src / app / test . jsx * / const a = 1 ; ` ` ` 1 . run ` eslint ` and ` next lint ` to the same file . see screenshot below . ` eslint ` command works correctly with absolute path . * * * but , * * * ` next lint ` command doesn ' t work correctly with absolute path . ! [ ìŠ¤í¬ë¦°ìƒ· 2024 - 08 - 23 173447 ] ( https : / / github . com / user - attachments / assets / b0e88f73 - 005b - 4581 - b16a - 477ab848c7df ) # # # # code details ` ` ` javascript / * packages / next / src / cli / next - lint . ts * / / / . . . const pathstolint = ( filestolint . length ? filestolint : eslint_default_dirs ) . reduce ( ( res : string [ ] , d : string ) = > { const currdir = join ( basedir , d ) if ( ! existssync ( currdir ) ) { return res } res . push ( currdir ) return res } , [ ] ) / / . . . ` ` ` * * ` pathstolint ` * * - ` pathstolint ` gets an empty array ` [ ] ` when ` filestolint ` array is ` [ ' d : \\cloud_git\\web - blog\\src\\app\\test . jsx ' ] ` passed by ` - - file ` option from cli . * * the ` reduce ` function * * - for each element ( ` d ` ) in ` filestolint ` , it combines it with ` basedir ` to create ` currdir ` . - it checks if this path exists using ` existssync ( currdir ) ` . - if the path does not exist , it does not add it to the resulting array ( ` res ` ) , and if it does exist , it adds it . * * cause of the issue * * - ` join ( basedir , d ) ` : - the ` join ` function is used to combine file paths and directory paths . - if ` basedir ` is ` d : \cloud_git\web - blog ` , then ` currdir ` becomes ` d : \cloud_git\web - blog\d : \cloud_git\web - blog\src\app\test . jsx ` , creating an incorrect path . - ` existssync ( currdir ) ` : - with the incorrect path ( ` d : \cloud_git\web - blog\d : \cloud_git\web - blog\src\app\test . jsx ` ) , ` existssync ` determines that this path does not exist , so it does not add it to the ` res ` array . - as a result , ` pathstolint ` ends up being an empty array ` [ ] ` . # # # how ? ( solution ) the code should be modified to use the file path as - is , without combining it with ` basedir ` . if a file path is provided , it should be directly included in ` pathstolint ` . - updated path handling : modified the code that processes the ` - - file ` option to properly handle absolute paths . this involved ensuring that absolute paths are correctly interpreted and used by the linting command . - enhanced compatibility with lint - staged : adjusted the linting logic to handle absolute paths returned by lint - staged , ensuring that linting works as expected in automated workflows . the code below is the built code of the modified version . ` ` ` javascript / * node_modules / next / dist / cli / next - lint . js * / / / . . . const pathstolint = ( filestolint . length ? filestolint : _constants . eslint_default_dirs ) . reduce ( ( res , d ) = > { const currdir = ( 0 , _fs . existssync ) ( d ) ? d : ( 0 , _path . join ) ( basedir , d ) ; if ( ! ( 0 , _fs . existssync ) ( currdir ) ) { return res ; } res . push ( currdir ) ; return res ; } , [ ] ) ; / / . . . ` ` ` - - - closes : i tried to find but no related issues . fixes : i tried to find but no related issues . - - - - - - - - - co - authored - by : jj kasper <jj @ jjsweb . site>
357	upgrade react from ` b0c1dc01 - 20250925 ` to ` df38ac9a - 20250926 ` ( # 84276 ) co - authored - by : sebastian sebbie silbermann <sebastian . silbermann @ vercel . com>
358	codemod : leave comment on spread props ( # 70979 )
359	perf ( turbopack ) : use ` resolvedvc ` for ` turbopack - env ` ( # 73202 ) # # # what ? use ` resolvedvc<t> ` instead of ` vc<t> ` for struct fields in ` turbopack - env ` . # # # why ? # # # how ?
360	[ docs ] : clarify scroll bahavior and traversing dom ( # 72071 ) this pr clarifies scroll behavior when components are added to a page that do not contain visible elements . this pr adds a note to the ` link ` docs explaining how next . js traverses the dom and bypasses certain components looking for a scrollable element . fixes : https : / / linear . app / vercel / issue / doc - 3391 / add - guidance - on - metadata - placement - and - page - scroll - with - link - - - - - - - - - co - authored - by : jj kasper <jj @ jjsweb . site>
361	skip unnecessary work in server action transforms for client modules ( # 71417 ) the hoisting of the proxy expressions only needs to be done for the server layer . we can skip this part completely when we know we ' re compiling a module for the client layer .
362	turbopack : refactor segment config parsing ( # 83297 ) closes pack - 5382 previously , turbopack validated every single module for route segment config , leading to false positives ( on non - page files ) and worse build performance . there were also three separate implementations of this logic . now , all of these cases are fatal errors , not just warnings . examples for errors ` ` ` . / bench / basic - app / app / export / inherit / page . tsx : 1 : 28 next . js can ' t recognize the exported ` preferredregion ` field in route . it needs to be a static string or array of static strings . > 1 | export { default , runtime , preferredregion } from ' . . / basic / foo ' | ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ the exported configuration object in a source file needs to have a very specific format from which some properties can be statically parsed at compiled - time . https : / / nextjs . org / docs / app / api - reference / file - conventions / route - segment - config ` ` ` this error message is slightly different now : ` ` ` browser log : . / test / integration / app - dir - export / app / another / [ slug ] / page . js : 6 : 8 next . js can ' t recognize the exported ` generatestaticparams ` field in route . app pages cannot use both " use client " and export function " generatestaticparams ( ) " . 4 | 5 | > 6 | export function generatestaticparams ( ) { | ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ > 7 | return [ { slug : ' first ' } , { slug : ' second ' } ] | ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ > 8 | } | ^ ^ 9 | 10 | export default async function page ( props ) { 11 | const params = await props . params the exported configuration object in a source file needs to have a very specific format from which some properties can be statically parsed at compiled - time . import traces : client component browser : . / test / integration / app - dir - export / app / another / [ slug ] / page . js [ client component browser ] . / test / integration / app - dir - export / app / another / [ slug ] / page . js [ server component ] client component ssr : . / test / integration / app - dir - export / app / another / [ slug ] / page . js [ client component ssr ] . / test / integration / app - dir - export / app / another / [ slug ] / page . js [ server component ] https : / / nextjs . org / docs / app / api - reference / file - conventions / route - segment - config ` ` `
363	build ( turbopack ) : update ` swc_core ` to ` v26 . 4 . 4 ` ( # 80161 ) # # # what ? changelog : https : / / github . com / swc - project / swc / compare / swc_core % 40v26 . 3 . 3 . . . swc_core % 40v26 . 4 . 4 # # # why ? to allow using https : / / github . com / swc - project / swc / pull / 10560
364	[ turbopack ] make persistent caching not printing so much ( # 71092 ) # # # what ? reduce console verbosity for persistent caching
365	[ dev ] define request id for rsc requests on the client ( # 84605 ) previously , we defined a request id for rsc requests on the server . the request id is used to tag debug information sent via websocket to the client , which then routes those chunks to the debug channel associated with this id . however , this meant that the client had to await the server response to retrieve the request id from the response headers , before we could pass the response ( and the debug channel ) to react . for # 84580 , we want to pass the response promise directly to react , to accurately show timing information about the request in the react devtools . to achieve this , we now define the request id on the client , and send it to the server via a request header . this means that the client can create the debug channel immediately , without waiting for the server response . closes nar - 426
366	[ test ] improve debug logs for playwright tests ( # 83431 )
367	turbopack : name the module factory function ( # 73553 ) # # # what ? in development give the module factory a useful name , so it ' s clear in stack traces that this is the module evaluation part of the execution . this also fixes some bugs with the stack trace parser , which seems to struggle if function names contain brackets . the automatically inferred function name would be the module id , which contains brackets .
368	[ segment cache ] add " client - only " option ( # 77655 ) we ' re currently working through some issues surfaced by the new per - segment routes introduced by the segment cache experiment . testing of this feature in production has been blocked while we figure that out . however , aside from per - segment prefetching , there are a bunch of client - only changes and improvements to the segment cache implementation that we can test in the meantime . so , i ' ve added a " client - only " option the ` clientsegmentcache ` flag . when enabled , next . js will not generate per - segment prefetch responses , but the client will switch to the new prefetching implementation . this includes : - de - duping of shared layouts across prefetch requests . - more resilience to race conditions . - prefetch cancellation on link viewport exit . - re - prefetching stale data after revalidatetag / revalidatepath . etc . it ' s essentially a complete rewrite of the client - side prefetching implementation . given the scope of the change , it may contain subtle regressions that i haven ' t yet discovered . that ' s why it ' s so urgent for me to start testing this in real apps . i initially hesitated to implement the " client - only " option because 1 ) there are already so many combinations of flags and forked implementations to juggle , and i didn ' t want to add another one , and 2 ) i thought it would take less time to fix the deployment issues that are blocking the wider rollout . but it turned out to be less net new complexity than i anticipated , given that i already had to support ` ppr : " incremental " ` , which works in a largely similar way .
369	turbopack : add separate turbopackpersistentcachingforbuild / fordev flags ( # 84215 ) # # # what ? move persistent caching for ` next build ` into a separate config option : ` turbopackpersistentcachingforbuild ` . and ` next dev ` to ` turbopackpersistentcachingfordev ` .
370	bring back passing tests for css - order for turbopack build ( # 67562 ) in # 67317 i moved a bunch of passing tests to ` failing ` because i thought it would be quick to run the manifest update action but that turned out to be partially broken . already landed a fix for it but that will run tomorrow morning , this ensures the 48 tests that pass are part of the manifest again and are reflected on areweturboyet . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
371	add ` next - custom - transforms ` tests to verify source maps ( # 75005 )
372	rename app directory " components " to " modules " ( # 70285 ) this is a pure refactoring . not every reserved file in the app directory represents a component module . currently , ` route ` is the only exception , but a future pr will introduce another one .
373	make sure that all the taiki - e / install - action calls use our env ( vercel / turbo # 8831 ) # # # description in some cases we can time out in ci because the cargo install action will fetch binaries from github . # # # testing instructions run ci 100 times and see our rust setup step hang less : p
374	fork the globset strategy for turbopack ( # 79333 ) # # what after discussion with [ upstream ] ( https : / / github . com / burntsushi / ripgrep / issues / 3049 ) it was determined that upstreaming a function like ` can_skip_directory ` wasn ' t aligned . it turns out the needs of ripgrep and ours are somewhat divergent . instead they encouraged me to just fork and modify which is what we do here . this copies the glob - >regex translation logic and drops much of the other functionality that is optimized for large sets of globs . then i have added our ` can_skip_directory ` function following a similar pattern . # # why this approach allows us to easily support for character ranges ( e . g . ` [ a - za - z0 - 9_ - ] ` ) and improves performance . i also suspect that this will be easier to maintain as debugging the generated regular expressions should be quite straightforward . # # alternatives we could just adopt globset directly as proposed in # 79116 however we would lose the ability to skip directories during traversal which can reduce the cost of setting up turbotasks dependencies and directory watchers . the other alternative that i pursued was a direct nfa implementation ( see # 78976 ) . this would be more memory efficient than regular expressions since both queries can share the same nfa , but the regex crate is much faster and better maintained . if memory overhead becomes a concern we can configure the regexes to use less , however , i suspect many of our generated regexes will be quite simple and thus generate small automata . closes pack - 4401 fixes # 72196
375	docs : polyfills usage in app router ( # 80447 ) closes : https : / / linear . app / vercel / issue / doc - 4752 / docs - polyfills - in - app - router fixes : https : / / github . com / vercel / next . js / issues / 74730
376	turbopack : don ' t hardcode ` edge - instrumentation . js ` ( # 75289 )
377	update turbopack development test manifest ( # 81104 ) this auto - generated pr updates the development integration test manifest used when testing turbopack .
378	style : simplify string formatting ( # 66772 ) co - authored - by : jiwon choi <devjiwonchoi @ gmail . com>
379	pages bugfix : prevent cancellation errors from being logged ( # 69766 ) when another data request is received by the pages router , a cancellation error is thrown and is meant to be caught by ` change ` to signal that the navigation request was aborted . however we were logging the error right before we handled the logic to properly bubble the error up . this meant that it was logging an exception to the console that wasn ' t actionable . fixes # 40554 closes next - 3731
380	turbopack : make tracing nicer ( # 84263 ) # # # what ? cleanup the info level spans and add missing top - level spans for all operations
381	docs : fix upgrade codemod command ( # 71578 ) this needs to be updated to specify the version .
382	[ segment explorer ] redesign file pills and boundary trigger ( # 81302 )
383	create forked impl for link component ( # 73019 ) there ' s significant drift between how link is implemented in pages vs app dir , and we ' re planning to make even more changes . ( for example , we want to change the intersection observer prefetch behavior , but only in app router ) to simplify this drift in behavior , this will alias ` next / link ` to ` client / app - dir / link . tsx ` in app dir bundles . there is no change in behavior to the ` link ` component in this pr . the next pr in the stack will remove the current forked handling to remove things that are irrelevant to the router it ' s rendered in .
384	switch from ld ( the default linker ) to using lld for gnu linux targets ( # 65898 ) copies changes from https : / / github . com / vercel / turbo / pull / 8166 , and updates contributing documentation to include the installation of lld . > * * what ' s wrong with ` ld ` ? * * it ' s very slow and uses a lot of memory . > > * * why ` lld ` ? * * it ' s fast , mature , and well - supported . meta and google use it for all their linking workloads . we ' re already using it for macos and x86 - 64 windows . there is [ ongoing work to make it the default for rustc ] ( https : / / github . com / rust - lang / rust / issues / 71515 ) , and it already is default on a few platforms . > > * * why not ` mold ` ? * * mold is generally faster , but the margin is slim enough for our workloads that it doesn ' t really matter . mold only recently got support for lto , doesn ' t support v0 rust symbol demanging , doesn ' t support bolt ( though we don ' t use that yet ) , etc . mold is maturing quickly , but ` lld ` still seems like the " safer " choice .
385	feat ( turbopack ) : add ` __turbopack_original__ ` while tree shaking ( # 71547 ) # # # what ? preserve the original import specifier when tree shaking , so the import analyzers after tree shaking can work . # # # why ? this is required for ` next / dynamic ` . # # # how ? closes pack - 3307
386	fix ( next / image ) : undo tight coupling between ` priority = true ` and ` fetchpriority = high ` ( # 67351 ) # # history when we added ` priority ` prop to ` next / image ` , there was no ` fetchpriority ` so we instead used this to preload the image in the head . then when browsers added support ` fetchpriority ` , we automatically added ` fetchpriority = high ` when ` priority = { true } ` to signal to the browser that this was a high priority image . this priority is added to the img and the preload . however , we saw cases where images are blocking critical css . per @ gnoff : > react currently prioritizes font preloads then high priority images , then css in the initial page load due to these changes in react ( aka float ) , we should no longer set ` fetchpriority = high ` , although the user can still manually add that prop if needed .
387	delete abandoned segment parsing code ( # 82458 ) originally , as part of the clientparamparsing feature , i expected that i would omit param values from the flightrouterstate when sending data from the server , and add it on the client . however , i ' ve since realized this is unnecessary because flightrouterstate is only used during runtime server responses . not in static responses , like per - segment prefetches . since the goal of clientparamparsing is to omit param values from static responses , we don ' t need to change anything about flightrouterstate . we may still want to update how params are processed on the server to more closely match the implementation on the client , but that still doesn ' t require any changes to flightrouterstate . so , this deletes all the code related to adding client - parsed params to flightrouterstate on the client . none of this was being used anywhere ; it was added by previous prs in anticipation that it would eventually be used . but now we don ' t need it .
388	turbopack : better error for sassoptions . functions as it ' s unsupported ( # 85073 ) # # what ? implements an error for the case where turbopack is used with sassoptions . functions . fixes # 65241
389	fix ( next / image ) : reduce avif sharp effort from 4 to 3 for faster encoding ( # 73030 ) # # history in a previous pr https : / / github . com / vercel / next . js / pull / 65846 the chroma subsampling setting was removed for avif images . this caused the default of ` 4 : 4 : 4 ` to be used which increased the image size and cpu a lot . i considered switching back to ` 4 : 2 : 0 ` but found that reducing the ` effort : 3 ` actually yielded significantly better performance with only a slight difference in size . # # benchmark for example , take this png that has a width of 1805 . ` ` ` curl - jo https : / / images . bookroo . com / site / landing / homepage / book - collection . png ` ` ` using ` w = 1850 ` and ` q = 75 ` : ` ` ` current : 2_778ms and 153_364 bytes chroma : 2_214ms and 132_927 bytes this pr : 1_265ms and 158_862 bytes ` ` ` using ` w = 1500 ` and ` q = 75 ` : ` ` ` current : 625ms and 95_810 bytes chroma : 524ms and 89_500 bytes this pr : 185ms and 99_127 bytes ` ` ` using ` w = 1200 ` and ` q = 75 ` : ` ` ` current : 506ms and 74_738 bytes chroma : 407ms and 68_998 bytes this pr : 144ms and 77_955 bytes ` ` ` for this particular image , the size will increase a bit but there are other images i tested where the size was actually smaller . so its a big improve in cpu usage compared to reverting to the chroma subsampling setting . we also are keeping avif smaller than webp which is the expected behavior . # # learn more [ chroma subsampling ] ( https : / / en . wikipedia . org / wiki / chroma_subsampling ) is the practice of encoding images by implementing less resolution for [ chroma ] ( https : / / en . wikipedia . org / wiki / chrominance ) [ information ] ( https : / / en . wikipedia . org / wiki / information ) than for [ luma ] ( https : / / en . wikipedia . org / wiki / luma_ ( video ) ) information , taking advantage of the human visual system ' s lower acuity for color differences than for luminance image compression deep - dive video : https : / / www . youtube . com / watch ? v = f1kybny6mwg sharp options : https : / / sharp . pixelplumbing . com / api - output # avif
390	[ devtool ] migrate global inline style tag to css ( # 82778 )
391	remove ppr feature check from segment cache client ( # 74669 ) follow - up to # 73960 . we should no longer check if ppr is enabled when determining whether to use the segment cache or the old client cache .
392	docs : add chrome debugging port configuration steps ( # 75845 ) this configure step is potentially required for the ports to show up in the remote targets .
393	unstable_after : support nested unstable_after calls ( # 65950 ) adds support for nested ` unstable_after ( ) ` . this pattern previously threw a " not supported yet " error , but works now : ` ` ` js function mycomponent ( ) { after ( ( ) = > asyncwork ( ) ) ; return <div> . . . < / div> } async function asyncwork ( ) { after ( ( ) = > { / * look ma , nesting ! * / } ) / / more stuff . . . } ` ` ` # # # implementation notes switched ` aftercontext ` to use a proper promise queue ( [ ` p - queue ` ] ( https : / / www . npmjs . com / package / p - queue ) ) instead of plain a callback array to support adding more callbacks as we execute ( i . e . from nested ` after ` s ) . used a package because i didn ' t want to reinvent the wheel here . as a nice bonus , ` p - queue ` lets us limit the concurrency of running tasks if we ' re worried about resource consumption . * * this pr doesn ' t do that * * , but it ' s very easy to add . that could be controlled via ` process . env . next_after_max_concurrent_tasks ` , a next . config . js option ( ` unstable_after : { maxconcurrenttasks : 5 } ` ) , or something like that .
394	updated layout - component with new feature layout . js ( # 67447 ) hello this pr updates the layout - component example to use : - app router - layout . js - removed customer implementation of layout in _app . js file . - - - - - - - - - co - authored - by : samcx <sam @ vercel . com>
395	fix ( next ) : properly pass layout - level ` maxduration ` config to the children page segments on build ( # 68793 ) > [ ! note ] > this pr is recommended to [ hide whitespace ] ( https : / / github . blog / news - insights / product - news / ignore - white - space - in - code - review / ) when reviewing . # # # what ? fixed layouts to properly pass route segment config ` maxduration ` to their children page segments . ` ` ` tsx / / layout . tsx export const maxduration = 5 ` ` ` # # # why ? - we separately handle the route segment configs on different places . - ` maxduration ` was missing logic to get value from the layouts unlike [ other route segment configs ] ( https : / / github . com / vercel / next . js / blob / canary / packages / next / src / build / utils . ts # l1636 - l1652 ) . # # # how ? - instead of explicit logic for the ` maxduration ` , get the route segment configs from the layout on the page ' s static info . - ensure to inherit the value from the layout only if is a page segment . # # # # see changes by commits - current : 522b9537d5d249e39e606f4f69459ac9f9519ded - expected : 12496d445703bb23dc4beb14ed13dcbec458a539 - fix : 196e0e86ee11b9319c899123e16d3a632dbbe37c fixes ndx - 196
396	[ dev - overlay ] fix the code frame title alignment ( # 76175 ) # # # what aligb the text to left and avoid icon being shrinked | after | before | | : - - - - - | : - - - - - - - | | ! [ image ] ( https : / / github . com / user - attachments / assets / bb39379d - ec52 - 4f2e - 9a6b - ccf102e40556 ) | ! [ image ] ( https : / / github . com / user - attachments / assets / cc495680 - 18b8 - 4380 - b577 - 23891023b204 ) | | ! [ image ] ( https : / / github . com / user - attachments / assets / db32427e - 103f - 4304 - 9d3b - 931a0bccc001 ) | ! [ image ] ( https : / / github . com / user - attachments / assets / fa8921ed - 1f13 - 48d7 - 9313 - 8944596eda56 ) | closes ndx - 826
397	fix : handle non - directory files in cache folder when performing cleanup ( # 84930 ) https : / / vercel . slack . com / archives / c046hau4h7f / p1760563400531829 repro this by creating a non - directory file in ` cache / turbopack ` , and then invalidating it : ` ` ` touch . next / dev / cache / turbopack / notadirectory touch . next / dev / cache / turbopack / __turbo_tasks_invalidated_db ` ` ` before : ! [ screenshot 2025 - 10 - 15 at 4 . 13 . 33 pm . png ] ( https : / / app . graphite . dev / user - attachments / assets / 670eba50 - d87d - 4d2a - a28d - d338cfd3863c . png ) after : ! [ screenshot 2025 - 10 - 15 at 4 . 14 . 09 pm . png ] ( https : / / app . graphite . dev / user - attachments / assets / 30ba99ab - 7859 - 475c - 954a - 77c1a0cd45a9 . png ) see that the directory was cleaned up .
398	test : attempt to unflake uselinkstatus interrupted navigation test ( # 77969 ) this test flaked for me here : https : / / github . com / vercel / next . js / actions / runs / 14353556171 / job / 40239845657 # step : 33 : 678 i suspect this is because \ [ the assertion that the pending state should disappear\ ] sometimes runs too soon . i made it wait until the side - effect of clicking the " debug mode " button becomes visible before checking if the pending state is gone . if this fix doesn ' t improve the situation , it indicates a bug in ` uselinkstatus ` , because the pending state is still hanging around for some reason . ( i chose not to just wrap the assertion in a ` retry ( ) ` , because we want to ensure that the indicator disappears immediately , not at some unspecified point in the future )
399	move unhandled rejection handling to shared path ( # 77997 ) the conventional wisdom of node . js and other runtimes is to treat unhandled errors as fatal and exit the process . but next . js is not a generic js runtime â€” it ' s a specialized runtime for react server components . many unhandled rejections are due to the late - awaiting pattern for prefetching data . in next . js it ' s ok to call an async function without immediately awaiting it , to start the request as soon as possible without blocking unncessarily on the result . these can end up triggering an " unhandledrejection " if it later turns out that the data is not needed to render the page . example : ` ` ` js const promise = fetchdata ( ) const shouldshow = await checkcondition ( ) if ( shouldshow ) { return <component promise = { promise } / > } ` ` ` in this example , ` fetchdata ` is called immediately to start the request as soon as possible , but if ` shouldshow ` is false , then it will be discarded without unwrapping its result . if it errors , it will trigger an " unhandledrejection " event . ideally , we would suppress these rejections completely without warning , because we don ' t consider them real errors . but regardless of whether we do or don ' t warn , we definitely shouldn ' t crash the entire process . even a " legit " unhandled error unrelated to prefetching shouldn ' t prevent the rest of the page from rendering . so , we intentionally override the default error handling behavior of the outer js runtime to be more forgiving . - - - this was already the behavior of next . js for self - hosted deployments â€” i . e . ` next start ` â€” but the rejection listeners were being installed in a code path that does not run for other deployment targets , like vercel . so what this pr does is move the rejection handling code to a path that ' s common to all deployement targets . one possibly controversial aspect that is new to this pr is that it removes all existing " unhandledrejection " handlers , before next . js installs its own . this is to override any handlers that exit the process . generally we think this is fine because it ' s unlikely that next . js will be deployed in such a way that it ' s sharing a process with non - next . js applications ; however , if we get feedback to the contrary , we ' ll figure out a strategy to deal with it .
400	[ devtools ] use ` useeffectevent ` instead of ignoring exhaustive deps ( # 83236 )
401	fix : styledcomponents schema ( # 69230 ) # # why ? both the ` toplevelimportpaths ` and ` meaninglessfilenames ` should not need a minimal of 1 item in their arrays . - fixes https : / / github . com / vercel / next . js / issues / 68573
402	docs ( draft - mode ) : fix missing ` switcher ` for ts and js codeblock ( # 72215 ) the same codeblock is displayed twice . ! [ image ] ( https : / / github . com / user - attachments / assets / 01da38e1 - 4437 - 4b0a - a08e - a911bf9fea94 ) ! [ image ] ( https : / / github . com / user - attachments / assets / 5194faf6 - 7d5f - 44aa - a445 - 21e02e635809 ) signed - off - by : eng zer jun <engzerjun @ gmail . com> co - authored - by : jiwon choi <devjiwonchoi @ gmail . com>
403	move request header parsing for ` app - render ` into a dedicated function ( # 67524 ) previously , parsing options from the request headers was a bit scattered accross the ` rendertohtmlorflightimpl ` function . i will add another header in # 67527 , so this is a refactoring that ' s in preparation for that .
404	[ ppr ] data route fixes ( # 66109 ) ensures that app routes ( like the ` favicon . ico ` added in the test case in this pr which is represented as an app route ) do not have a prefetch rsc also attached .
405	fix : add chrome - ligthouse to htmllimitedbots ( # 80656 ) co - authored - by : jiachi liu <inbox @ huozhi . im>
406	fix : ` warnonce ( ) ` lru ( # 73742 ) we regressed in https : / / github . com / vercel / next . js / pull / 73483 since the lru calculates the value based on the value , not the key ( and we were not setting the value ) .
407	[ turbopack ] remove a debug assertions in client references endpoint ( # 82725 ) remove a debug assertion code in the ` globalbuildinformation ` implementation that was validating client references for endpoints . this was inserted as a sanity check that two traversals were doing the same thing , but this is overkill and can be trigged accidentally by an eventual consistency condition . just drop them . if an application is edited during this computation it is possible that the module graph that globalbuildinformation has access to is different than the set of references that ` find_server_entries ` will identified , this transient condition could trigger the panic .
408	move known failed test back into ` failed ` set in turbopack manifest ( # 76542 ) the test was moved out of ` failed ` in # 76472 , but still fails with turbopack and react 18 . 3 . 1 . for posterity : known failed tests are excluded [ here ] ( https : / / github . com / vercel / next . js / blob / 91e61592a3137ad3bcc67f876f3e5eac8e51d7e9 / test / get - test - filter . js # l81 ) . running react 18 tests for the update prs like # 76472 is addressed in # 76544 . closes # 76535
409	[ turbopack ] update event_listener to fix hanging bug ( # 75481 ) # # # what ? it has a bug about pinning . . .
410	examples : remove the old files from ` with - postgres ` ( # 73587 ) # # summary follow up # 73531 . remove the old example files . cc : @ samcx # # # adding or updating examples - [ x ] the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - [ x ] make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md co - authored - by : sam ko <sam @ vercel . com>
411	remove extra base - server code ( # 81944 )
412	docs : onrequesterror request header type ( # 83988 ) aligning with the actual type https : / / github . com / vercel / next . js / blob / canary / packages / next / src / server / instrumentation / types . ts # l18
413	tests : migrate on - reuqest - error tests to new model ( # 83383 )
414	create turbo - static for compile time graph analysis ( vercel / turbo # 8037 ) # # # description
415	undeprecate revalidate apis and rename expire apis ( # 73193 ) as discussed we are removing the deprecated field from ` revalidatetag ` and ` revalidatepath ` as they aren ' t going away anytime soon and the new ` expire ` apis will have slightly different semantics so not a 1 - 1 rename with no arguments change anymore . we are also adding the ` unstable_ ` prefix for ` expiretag ` / ` expirepath ` while we iterate on them so it ' s clear they will change . - - - - - - - - - co - authored - by : zack tanner <1939140 + ztanner @ users . noreply . github . com>
416	add activity name to route layouts and pages ( # 85011 ) this is the name that will be displayed in the suspense devtools . a name is given to any boundary that corresponds to a user - defined layout or page . it omits " virtual " segments that are inserted automatically by the router .
417	fix : fix tree shaking even more ( vercel / turbo # 8864 ) # # # description fix server action and rename the injected variable . the previous code fails if the name of the top - level variable is ` v ` . this was not a problem for almost all modules , but some packages like [ ` @ firebase / webchannel - wrapper ` ] ( https : / / unpkg . com / @ firebase / webchannel - wrapper @ 0 . 2 . 41 / dist / index . esm . js ) is published after mangling , so it can be a problem # # # testing instructions see https : / / github . com / vercel / next . js / pull / 66689
418	turbopack : trace module . createrequire ( # 84335 ) only ` module . createrequire ( import . meta . url ) ` for now , but that seems to be the most popular use anyway .
419	examples : improve supabase example ( # 69308 ) co - authored - by : terry sutton <saltcod @ gmail . com> co - authored - by : lee robinson <me @ leerob . io>
420	[ dev - overlay ] remove unused code ( # 80279 ) best reviewed without whitespace changes .
421	add experimental flag for retrying static generation ( # 66393 ) transient / recoverable errors can cause page ( s ) to fail . when building an app with a lot of static pages , a single page failing to build can be frustrating , especially if it it ' ll pass on a retry . this adds an experimental ` staticpagegenerationtimeout ` property that can be used to configure how many times next . js attempts to build a particular page before giving up . i recommend reviewing this pr [ without whitespace ] ( https : / / github . com / vercel / next . js / pull / 66393 / files ? w = 1 ) < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
422	[ segment cache ] omit from bundle if flag disabled ( # 76622 ) alternative to https : / / github . com / vercel / next . js / pull / 76597 . this works by importing all segment cache related code through a single entry point ( segment - cache . ts ) , and wrapping each export in a feature flag check . this fixes the size regression in v15 . 2 but long term i don ' t love this approach . since experimental flags are an essential part of our workflow , we should establish a better pattern for dead code elimination . ideally it would be done at the bundler level , like how react ' s build process works . in the react repo , you don ' t even need to add any extra configuration per experiment â€” if the code is not reachable , it gets stripped from the build automatically by rollup . or , shorter term , we could stub out experimental modules at build time by updating the build config , i . e . a more automated version of what i ' m doing manually for this particular flag .
423	[ devoverlay ] cleanup hydration error ui ( # 75499 )
424	fix regression in ts plugin : allow ` reset ` prop in error files ( # 69777 ) the typescript error ` props must be serializable for components in the " use client " entry file , " reset " is invalid . ` for the ` reset ` prop in ` error . tsx ` and ` global - error . tsx ` was fixed in # 46898 and # 48756 , respectively . however , a regression of the fix was accidentally introduced in # 67211 . this pr restores the previous behavior and adds fixtures for manual testing . ( since the next . js ts plugin only applies to vscode , manual testing in vscode is required . see [ ` test / development / typescript - plugin / readme . md ` ] ( https : / / github . com / vercel / next . js / blob / a5f30e68f8d1fe614965abc5df0234a869c6db8a / test / development / typescript - plugin / readme . md ) for details . )
425	test : exclude the ts testing files from tsconfig during local dev in nextjs repo ( # 74647 ) # # # what we ' re suffering from local dev that every time the ` * . test . ts ` files are resolved with the local tsconfig . json , which was intended to be handled by the root tsconfig . json in the next . js monorepo as they require to resolve the utils alias . by leveraing the ` next_private_skip_canary_check ` flag which is renamed to ` next_private_local_dev ` for our development . this only happen in local development in our monorepo , not in development of users or any other situations . # # # benefits this helps us to always write the tests with correct type hints especially for the rare cheerio or playwright interface apis with our testing suite
426	chore ( turbo - tasks - backend ) : disable flaky performance test by default ( # 70974 ) the ci environment is * * very * * noisy and this test can ( and does ) flake : https : / / github . com / vercel / next . js / pull / 69667 # discussion_r1792296524 ` ` ` cargo nextest r - p turbo - tasks - memory many_calls_to_many_children - - no - capture ` ` ` ` ` ` turbopack_test_performance = yes cargo nextest r - p turbo - tasks - memory many_calls_to_many_children - - no - capture ` ` ` the plan to solve this is to integrate codspeed , which should guarantee low noise via an emulated cpu .
427	fix : ensure onrequesterror is invoked when otel enabled ( # 83343 ) co - authored - by : jiachi liu <inbox @ huozhi . im>
428	ci : ensure fnm is installed in build_reusable ( # 74891 ) ` build_reusable ` assumes ` fnm ` is available but on gh hosted runners we have to ensure it ' s installed . this adds an installation step if fnm is not available . fixes failing deployment tests , eg : https : / / github . com / vercel / next . js / actions / runs / 12778327338 / attempts / 3 validated in https : / / github . com / vercel / next . js / actions / runs / 12778954324
429	revert " [ test ] fix flaky test of basepath navigation " ( # 80259 )
430	[ turbopack ] only invalidate fs writes with a different content ( # 75936 ) # # # what ? there are cases where two write tasks write to the same file . this can happen e . g . when two different image source files with the same content are used and end up with the same content hashed filename . but since dependency tracking is disabled for one off builds , this results in an invalidation of the first write task when the second write task effect is executed . and an invalidation will panic in dependency - tracking - disabled mode . this change only invalidates other write tasks when they write a different content and keeps writes with the same content intact . this should avoid the panic as no task is invalidated .
431	update rspack development test manifest ( # 83876 ) this auto - generated pr updates the development integration test manifest used when testing rspack .
432	turbopack : add server actions loader to module graph ( # 74951 )
433	update to turbopack - 240605 . 2 ( # 66568 ) includes https : / / github . com / vercel / turbo / pull / 8303
434	update failing e2e deploy tests ( # 84395 ) x - ref : https : / / github . com / vercel / next . js / actions / runs / 18146430374 / job / 51651546603 x - ref : https : / / github . com / vercel / next . js / actions / runs / 18146430374 / job / 51648845664
435	docs : clarify that ` unstable_after ` version is unstable ( # 71484 )
436	chore ( github ) : improve triaging issues with ai ( # 68995 ) # # why ? we need to update the triage guidelines , so random issues are not flagged to the team . # # how ? - moved ` triage_guidelines . txt ` to an external source , so we don ' t have to constantly create a pr - added a ` vercel_protection_bypass ` secret to to next . js repo - refactor ` generatetext ( ) ` by moving some logic to ` system ` - minor refactors to ` main ( ) `
437	fix ( next @ 15 ) : use the asset prefix when loading a css in app router ( # 72095 ) # what this pr fixes a bug when using next @ 15 , next / dynamic and assetprefix config in app router . # why the current behavior loads the css with only the pathname and so , it results with a 404 . # how the new behavior uses the full url of the asset . fixes # 72470 < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - > - - - - - - - - - co - authored - by : tobias koppers <tobias . koppers @ googlemail . com> co - authored - by : jj kasper <jj @ jjsweb . site>
438	[ ppr ] allow fallback pages to be revalidated ( # 70199 ) # # # what ? this allows fallback pages that have partial prerendering enabled to be revalidated in minimal mode . # # # how ? when a request comes in without any ` x - now - route - matches ` headers and has partial prerendering enabled , it will consider it a revalidation request for the fallback page .
439	turbopack : really fix export collection ( # 80240 ) - for ` export default class foo ` , we don ' t insert a ` var __turbopack__default__export__ = foo ` variable because it should be a live binding . so put the correct name / syntax context into ` importmap . exports ` - the ` __turbopack__default__export__ ` generated by module fragment tree shaking should use the same syntax context as the one generated by ` module_item . rs ` ( which is ` syntaxcontext ( 0 ) ` ) .
440	port turbopack - resolve to resolvedvc ( # 73083 )
441	revert " [ breaking ] skip next . js internal routes ` / _next ` in middleware " ( # 84697 ) reverts vercel / next . js # 84239 [ slack thread ] ( https : / / vercel . slack . com / archives / c06dgj420tz / p1760022841341369 ? thread_ts = 1759907388 . 654779 & cid = c06dgj420tz )
442	update turbopack production test manifest ( # 79435 )
443	update rspack production test manifest ( # 80136 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
444	remove redux devtools from router reducer ( # 70495 ) it ' s a bit odd that we expose this internal debugging capability in production and it seems to cause potential production issues when serializing unsupported data structures ( [ x - ref ] ( https : / / github . com / vercel / next . js / discussions / 69436 ) ) if we feel a need to re - introduce the ability to introspect on the router state even in production we could consider relanding it in an opt - in way , and not run on every action . but i think since we ' ve moved away from throwing promises in reducers ( back when the reducers could potentially be replayed by react , in early suspense implementations ) , i ' m not sure this provides as much value . fixes # 70441
445	perf ( turbopack ) : introduce runtime analysis for immutable tasks ( # 80422 ) # # # what ? after the execution of a turbo task function , we can mark it as immutable if it does not have a way to invalidate itself . with the immutable flag , we optimize some overhead of turbo tasks by skipping activeness tracking . # # # why ? # # # how ?
446	babel - loader : fix a few issues with config caching ( # 83973 ) - ` isreactcompilerrequired ` needs to be called in ` getcachecharacteristics ` , not in ` getfreshconfig ` because it depends on the file contents , so we don ' t want to cache the result of ` isreactcompilerrequired ` . - moving react compiler detection outside of the cache lets us avoid using the full file path for a cache key ( which negates much of the benefit of the cache ) . - ` getfreshconfig ` shouldn ' t use the real file path or source map , those should always be injected later . - it doesn ' t look like we were updating ` inputsourcemap ` on cached config objects ( ! ? ! ? )
447	set up options / hooks to enable turbotrace ( # 72306 ) adds tracing settings to the various contexts that are used for nft there are cases where we need to know whether tracing is useful , this pr sets up that state ahead of the next one ( s ) which actually take advantage of them . closes pack - 3377
448	chore ( github ) : add error overlay area ( # 76167 ) # # why ? adding an ` error overlay ` area ( will add label as well ) so we can start tracking issues with the new error overlay .
449	update rspack production test manifest ( # 82771 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
450	emit build error when ` ' use cache ' ` directive is misspelled ( # 83756 ) handles cases like : - ` ' use cache : remote ' ` ( missing space after colon ) - ` ' use cache : default ' ` ( extra space before colon ) - ` ' use cache private ' ` ( missing colon ) - ` ' use cache : ' ` ( missing cache kind ) closes nar - 392
451	verify cache - busting param during segment prefetch ( # 79563 ) not all cdns respect the vary header when caching . we must assume that only the url is used to vary the responses . the next client computes a hash of the header values and sends it as a search param . before responding to a request , we must verify that the hash matches the expected value . neglecting to do this properly can lead to cache poisoning attacks on certain cdns . in this initial pr , the verification i ' ve added only runs during per - segment prefetch requests , since those are the only ones that both vary on a custom header and are also cacheable . but for safety , we should run this verification for all requests , once we confirm the behavior is correct . will need to update our test suite , since there are a handful of unit tests that send fetch requests with custom headers but without a corresponding cache - busting search param . it would be even better if we stopped using custom request headers , and instead fully encoded everything into the search param . at least for cacheable requests .
452	fix ( turbopack ) : remove the duplicate slowfilesystem warning ( # 81972 )
453	docs : update static - tweet to react - tweet ( # 73253 ) # # description now that next - tweet has been renamed [ react - tweet ] ( https : / / github . com / vercel / react - tweet ) , [ static tweet ( demo ) ] ( https : / / static - tweet . vercel . app / ) navigates https : / / react - tweet . vercel . app . so updated the link . # # # adding or updating examples - [ x ] the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - [ x ] make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com>
454	upgrade react from ` a4eb2dfa - 20251006 ` to ` 3025aa39 - 20251007 ` ( # 84613 ) [ diff facebook / react @ a4eb2dfa . . . 3025aa39 ] ( https : / / github . com / facebook / react / compare / a4eb2dfa . . . 3025aa39 ) <details> <summary>react upstream changes< / summary> - https : / / github . com / facebook / react / pull / 34759 < / details>
455	fix : remove a few old references to ' next lint ' ( # 82800 )
456	docs : remove - / + diff marker ( # 72278 ) # # description [ next - request - in - use - cache error page ] ( https : / / nextjs . org / docs / messages / next - request - in - use - cache ) uses - / + icons in code block . however , it doesn ' t work correctly because it ' s not diff code block . then add highlight instead of that . # # # improving documentation - [ x ] run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - [ x ] read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com>
457	enable ` @ typescript - eslint / switch - exhaustiveness - check ` rule ( # 81583 )
458	[ dev - overlay ] show error overlay on any thrown value in / app ( # 79658 ) may have been a leftover from earlier . we always consider any throw . even without a sync stack , we might still have an async stack to show . and even if we have no stack at all , the message is still relevant . basically , never hide errors .
459	represent " virtual " segments like route groups ( # 82422 ) small update to # 82383 . instead of using a special symbol to represent the " virtual " segments that get inserted into the loader tree for parallel routes , we can represent them like route groups , since they serve the same purpose . that will allow us to remove a special case in the param parsing logic , since we have to skip groups regardless ; both will be skipped by the same check .
460	change deterministic module id strategy to match webpack ( # 70200 )
461	chore : add ` swc - build - native ` script at root package . json ( # 67345 ) when developing in next . js repo , the maintainers / contributors sometimes need to build swc native files . added a script ` swc - build - native ` to run the command ` pnpm - - filter = @ next / swc build - native ` which was verbose to run .
462	fix : add ' . next / types / * * / * . ts ' to the pages router tsconfig ( # 83029 ) see # 83010 previously , typed links only worked in app router . now they work in pages router too , but we forgot to update the templates .
463	chore : update pnpm to 9 . 4 . 0 ( # 64945 ) # # why ? notable change of v9 is corepack is enabled by default . so we can ensure all package manage / resolved exact same version of pnpm . - [ * * v9 . 0 . 0 * * ] ( https : / / github . com / pnpm / pnpm / releases / tag / v9 . 0 . 0 ) : discontinued support for node . js v16 and introduced corepack compatibility checks . new configuration updates include enabling ` dedupe - injected - deps ` and changing the lockfile to version 9 , with better readability and resistance to git conflicts . . . . - [ * * v9 . 4 . 0 * * ] ( https : / / github . com / pnpm / pnpm / releases / tag / v9 . 4 . 0 ) - kudos to @ ryota - murakami for the original : pr : ! â†’ https : / / github . com / vercel / next . js / pull / 64854 # # changes - https : / / pnpm . io / npmrc # link - workspace - packages defaults to ` false ` now , so setting it to ` true ` closes next - 3211
464	update rspack production test manifest ( # 79923 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
465	remove dependecy graceful - fs and types ( # 67194 ) remove the dependency ` graceful - fs ` and types . i have looked at the project and it is only used in one file , inside this file only ` fs ` is imported but not the functionality provided by the library , finally it uses the native one through ` graceful - fs ` , i have simplified the logic and removed the unnecessary library . the retry functionality is implemented in the file and is not used from the dependency co - authored - by : torresgol10 . it <torresgol10 . itd @ gmail . com> co - authored - by : jj kasper <jj @ jjsweb . site>
466	ci : enable ` experimental . isolateddevbuild ` for ` test - integration ` ( # 84558 ) enabling ` experimental . isolateddevbuild ` required many changes to the current workflow , so we will incrementally roll out to the tests . enabling on test - integration instead of test - experimental - integration because ` - experimental ` cis are filtered via ` experimental - tests - manifest . json ` and they don ' t cover all tests . we want to enable this feature by default so we should ensure this incremental rollout is covered on all test cases . 1 . ~ ~ test - experimental - dev ( [ link ] ( https : / / github . com / vercel / next . js / pull / 84099 ) ) ~ ~ 2 . test - dev ( [ link ] ( https : / / github . com / vercel / next . js / pull / 84562 ) ) 2 . test - prod ( [ link ] ( https : / / github . com / vercel / next . js / pull / 84556 ) ) 3 . test - integration ( here ) 4 . test - unit 5 . enable by default , remove the flag , and update the rest x - ref : https : / / github . com / vercel / next . js / pull / 84043
467	update turbopack development test manifest ( # 77108 ) this auto - generated pr updates the development integration test manifest used when testing turbopack .
468	remove the node - file - trace crate ( # 70998 ) # # # what ? this is a 2nd prefactor for adding node - file - trace into turbopack . when implementing this , we have a few options namely : - a ) expose turbotrace ( node - file - trace - rs ) as a napi library and try to insert it into the current codebase - b ) expose turbotrace and try to reuse the turbo backend - c ) move turobtrace into the rust process and do it in parallel with everything else we chose c we have already ripped out the js code path , this pr nukes the now - orphaned node - file - trace rust binary and napi bindings . # # # why ? the crate is unmaintained and probably will not be used in its current form .
469	[ turbopack ] replace uses of ` value<pattern> ` with just ` pattern ` ( # 80134 ) replace uses of ` value<pattern> ` in the resolve crate with ` pattern ` this required a manual implementation of ` taskinput ` which ended up being trivial since there are no captured ` vcs ` . however , the ` derive ` macro failed because it is a recursive type . # # # why ? the value<> type is confusing and error prone , lets destroy it ! as discussed over slack , turbo_tasks : : value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks . â€¢ https : / / vercel . slack . com / archives / c03ewr7lgen / p1743456121241529 â€¢ https : / / vercel . slack . com / archives / c04ngv98tps / p1743455453764879
470	docs : fix incorrect usage in server action in a client component example ( # 68965 )
471	docs ( errors ) : add failed - to - find - server - action error page ( # 75678 ) # # why ? we should also have an error page when somebody gets this error â†’ https : / / github . com / vercel / next . js / blob / d70cac3eb4dee1d1361629d1b4c765365f184e26 / packages / next / src / server / app - render / action - handler . ts # l1086 .
472	docs : update pages automatic static optimization rendering page ( # 72545 ) # # improving documentation i just add * * good to know * * to below path note which was in a block but not add the tag . > pages > rendering > automatic static optimization * * before : * * > statically generated pages are still reactive : next . js will hydrate your application client - side to give it full interactivity . * * now : * * > * * good to know : * * statically generated pages are still reactive . next . js will hydrate your application client - side to give it full interactivity . co - authored - by : sam ko <sam @ vercel . com>
473	bypass source map dev middleware for client chunks ( # 72581 ) a multi - zone next . js app might have complex rewrites for its client assets . for these apps , resolving a source map through the ` / __nextjs_source - map ` dev middleware might fail because the asset might belong to a different app . instead of trying to resolve those rewrites ( i . e . using ` fetch ` instead of ` fs ` ) , we can just bypass the source map dev middleware for client chunks . because we control how those source maps are generated , we can safely assume that the ` sourcemappingurl ` is relative to the filename , with an added ` . map ` extension . the browser can just request this file , and it gets served through the normal dev server , without the need to route this through the source map dev middleware . reverts # 72258
474	singlemodulegraph : yield edge weights during traversal ( # 74620 ) this adds the edge weight ( the ` chunkingtype ` ) of the edge during ` traverse_edges_from_entry ` and ` traverse_edges_from_entry_topological ` , rather than only providing only the originating node . test plan : added a log to verify edge types were provided to these visitors .
475	[ turbopack ] cleanup and documentation ( # 73496 ) # # # what ? * avoid flagging " thread " span as incomplete * improve error message * add comments * fixup print_stats * fix lmdb feature
476	remove ` staticworkerrequestdeduping ` flag & unused ipc code ( # 66655 ) this flag remained experimental because the ipc implementation didn ' t play nicely with requests containing large payloads , due to it being stringified as get parameters . this branching logic also poses challenges for some upcoming work related to detecting io . this removes the handling for the ` experimental . staticworkerrequestdeduping ` flag which we can revisit in the future with a sounder approach . this also cleans up some of the ipc server utilities as it wasn ' t in use anywhere else . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
477	chore ( turbopack ) : fix typo ( # 80983 ) # # # what ? fix a typo # # # why ? https : / / github . com / vercel / next . js / pull / 80830 # pullrequestreview - 2964742420
478	polish ui for dev indicator popover ( # 74872 ) | * * change * * | * * before * * | * * after * * | | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - | | * * padding : 12px to 6px * * | ! [ before ] ( https : / / graphite - user - uploaded - assets - prod . s3 . amazonaws . com / rkseewxbnzdfs9t0yyxn / 1d0b4e6a - 65a4 - 4de6 - 8e35 - 71ac1543c491 . png ) | ! [ after ] ( https : / / graphite - user - uploaded - assets - prod . s3 . amazonaws . com / rkseewxbnzdfs9t0yyxn / 82b07cda - 8c44 - 4481 - 9ec4 - ef0f887055cc . png ) | | * * hover : non - selectable row * * | ! [ before ] ( https : / / github . com / user - attachments / assets / ab67f78d - cdd1 - 4d05 - a2ae - 55f80cfbc4b9 ) | ! [ after ] ( https : / / github . com / user - attachments / assets / 8497e5b4 - 0228 - 4dfd - 9520 - b5bcfe89ecaf ) | | * * issue count icon background color * * | ! [ before ] ( https : / / github . com / user - attachments / assets / ec00e0b4 - 10ea - 4654 - a87f - 46664514814f ) | ! [ after ] ( https : / / github . com / user - attachments / assets / b120caa1 - 83ae - 40e6 - 8543 - aab7a13d8aaf ) | | * * close popover on outside click * * | [ before ] ( https : / / github . com / user - attachments / assets / 545ca252 - bf3e - 4ba6 - b2aa - b8e02069eb4a ) | [ after ] ( https : / / github . com / user - attachments / assets / c2a4f2cf - 5642 - 4b9e - 8ce4 - 1a44b8db3a53 ) | | * * works with high z - index elements * * | [ before ] ( https : / / github . com / user - attachments / assets / 1bdf14ce - afb4 - 4db8 - 91e3 - b1d9647571be ) | ! [ after ] ( https : / / github . com / user - attachments / assets / cabf80f8 - ecf6 - 424c - bf97 - 0cbd2db06660 ) |
479	bump to swc v44 ( # 84420 )
480	docs ( typo ) : fix typos in ` 08 - testing / index . mdx ` ( # 72057 ) # # ðŸ“š improving documentation hello , i ' ve fixed ` testing ` to ` testing ` . ( lowercase to uppercase ) ! [ image ] ( https : / / github . com / user - attachments / assets / 3d3198cf - e750 - 4957 - b436 - 1e964d6976e9 ) in other documents , ` t ` is always uppercase as shown in the screenshot above . co - authored - by : jj kasper <jj @ jjsweb . site>
481	turbopack : vc stability of modulegraph ( # 77052 )
482	support turbo : true option for custom server ( # 69464 ) adds an option to the custom server api to enable turbopack . âš ï¸ you can ' t mix / match turbopack / webpack in the same process because it also requires a separate build of react . so if you do use ` next ( ) ` twice you ' ll want to enable ` turbo : true ` on both , or separate them into multiple processes . fixes # 65479 closes pack - 3048 < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
483	docs : fix nav item lettercasing for multi - zones ( # 78250 )
484	turbopack : optimize addedroutes and removedroutes calculation ( # 83840 ) # # what ? apply suggestion from this review : https : / / github . com / vercel / next . js / pull / 83829 # discussion_r2352698323
485	update turbopack production test manifest ( # 80888 )
486	turbopack : disable lightningcss mediarangesyntax feature ( # 85086 ) # # what ? always downlevels mediarangesyntax to ensure max - width doesn ' t get upleveled to mediarangesyntax which is shorter but doesn ' t work with chrome devtools ` show media queries ` feature . fixes # 72559
487	logger : skip logging full element ( # 85194 )
488	update turbopack production test manifest ( # 78273 )
489	revert " [ breaking ] remove deprecated ` publicruntimeconfig ` and ` serverruntimeconfig ` ( # 83944 ) " ( # 84167 ) this pr reverts # 83944 as it was missing a deprecation warning in the app , which is easy to miss for the users .
490	chore ( examples ) : updated the example of with - goober to utlize the app router ( # 71349 ) this pr updates the ` with - goober ` example to use the app router . here are the changes that have been made : - renamed the ` pages ` folder to the ` app ` folder . - converted the ` index . tsx ` to ` page . tsx ` file as part of the app router . - created a new ` layout . tsx ` file in the app directory . - merged functionality from both ` _app . tsx ` and ` _document . tsx ` into ` layout . tsx ` : - goober setup from ` _app . tsx ` - css extraction and injection from ` _document . tsx ` - updated the ` package . json ` file . the following actions were performed as part of this pr : - ran ` pnpm prettier - check ` with no issues found . - executed the ` pnpm check - examples ` script . * * cc : * * @ samcx - - - - - - - - - co - authored - by : samcx <sam @ vercel . com>
491	perf : optmize ` react_server_component ` transform ( # 67335 ) # # # what ? - use ` rc ` instead of cloning vector . - use faster hash algorithm . # # # why ? ` react_server_component ` showed up in the profiling result . # # # how ? closes pack - 3120
492	turbopack : simplify emitdecoratormetadata test ( # 76678 ) # # what ? reuse the same code as is checked in page . js , making them consistent and dropping an additional dependency which also makes it easier to run while testing .
493	perf ( turbopack ) : spawn only one thread for one ` write file ` effect ( # 79318 ) # # # what ? replace ` retry_future ` call with ` retry_blocking ` . # # # why ? ` tokio : : fs ` is a trap for this kind of usage . each function call will spawn one thread until it reaches the thread pool limit . our previous code could spawn at most eight threads to handle one ` write file ` effect . the numbers at x - ref : https : / / vercel . slack . com / archives / c06ppgz0fd3 / p1747437041264999
494	ensure accessing search params mark dynamic usage ( # 67105 ) when accessing search params , we only track dynamic access during static generation . this has implications on fetch caching , because the fetch cache relies on hints set during render that it ' s in a dynamic scope . in 15 , this would signal that it should not attempt to cache the fetch at all . in 14 , this could impact the heuristic that bails from fetch cache if dynamic access came before certain requests types , e . g . posts .
495	revert " docs : add fleek ' s next . js template " ( # 73054 ) reverts vercel / next . js # 72988 right now , we ' re focused on making sure the examples linked are guaranteed to work and placed inside the next . js community github organization .
496	perf ( turbopack ) : remove indent in intermediate string ( # 79754 ) # # # what ? remove ` ` ( two whitespaces ) in intermediate texts . # # # why ? - in dev , browser devtools will provide formatting anyway . - in production , we are going to parse it again and feed it to the swc minifier regardless . # # # how ? - - - x - ref : numbers at https : / / vercel . slack . com / archives / c06ppgz0fd3 / p1748380301451689
497	expose allowheader ( # 72033 )
498	[ app ] send errors not handled by explicit error boundaries through ` reporterror ` ( # 76101 )
499	turbopack build : properly isolate scss / webpack - error test ( # 67995 ) when this test was in ` test / integration ` it tried to hack around sass always being installed . by leveraging the test isolation helpers we can just opt to not installing ` sass ` which ensures it matches reality . this doesn ' t fix the test with turbopack enabled yet but it does highlight the real error , instead of showing a strange resolving error about a non - existent sass - begone package . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
500	[ dev - overlay ] use css var for ` <a> ` tag focus ring ( # 76374 ) # # # why ? when clicking the dialog and tabbing , the ` <a> ` tag inside the terminal component was focusable but was missing an outline . # # # how ? to have a unified outline for the focused ` <a> ` tag , use the css var ` - - focus - ring ` . this gives a unified style and also fixes this issue . # # # before https : / / github . com / user - attachments / assets / 7a3b7e45 - c9e8 - 42f5 - 84fb - 9ac4cf203d24 # # # after https : / / github . com / user - attachments / assets / 6309f153 - 1fe2 - 4087 - a81e - 49ff0e51e3fd closes ndx - 856
501	docs : fix typo ( # 80549 )
502	development : remove matchers . reload ( ) on each request ( # 83829 ) # # what ? re - apply # 83720 . it was reverted because of tests flaking significantly more often . dug into this with @ mischnic and @ sokra yesterday and we found that it ' s a race condition because of the two separate watchers . in ` setup - dev - bundler . ts ` there ' s a watchpack instance and turbopack has it ' s own watcher . the specific case where it caused flakes is when the watchpack aggregate event runs before turbopack ' s watcher has emitted a change event . since the watchpack aggregate callback emits ` added_page ` / ` removed_page ` over the websocket it would end up triggering the browser ` location . reload ( ) ` too early , before the turbopack side has the updated list of routes . the right solution is to move the ` matchers . reload ( ) ` and ` added_page ` / ` removed_page ` events to where turbopack emits that the list of routes ( entrypoints ) has updated .
503	docs : getting started guide on images and fonts ( # 73470 )
504	feat : enable tree shaking in next . js ( vercel / turbo # 8523 ) # # # description - next . js counterpart : https : / / github . com / vercel / next . js / pull / 66689 # # # testing instructions
505	turbopack : make tracing easier ( # 75958 ) - add an env var to run turbopack in the same process : ` next_turbopack_use_worker = 0 ` - put some turbo - task spans behind a feature . this alone makes traces 20 % smaller . there is still one span that accounts for the time spent in turbo - tasks : ! [ bildschirmfoto 2025 - 02 - 12 um 13 33 20 ] ( https : / / github . com / user - attachments / assets / 0cdf9250 - d289 - 4208 - 962f - 9b2ba0105ee7 )
506	[ cache components ] allow hiding logs after abort ( # 84579 ) when next . js prerenders with cache components enabled it will abort prerenders before they have completed . it is common for user code to log in a catch block and with this new prerendering behavior these logs will trigger frequently for cases where the rejection only happened because we are abandoning the work . this is analagous to treating a fetch rejection as an error even when you pass an abortsignal into the fetch and then abort it . currently when logs occur after an aborted prerender we dim the log output to signify that the log line is not particuarly important . this is useful and for folks who want to see everything output by their program this is potentially the best behavior . however many log collectors don ' t support colors and have no way of contextualizing the dimmed log which can lead to them appearing to be more significant than they are . to combat this we expose a new experimental flag that allows you to completely disable logs after aborting . this means the log lines you see are much higher signal . the implementation is somewhat complex because we install the environment extensions as early as possible before any user code can run but we can ' t install the hiding behavior until we have a config in scope . i ' ve added the hiding installation to next - server and the worker exportpages entrypoints . i believe this is sufficient to cover all contexts in which we will prerender .
507	chore ( turbopack ) : add instrumentation to ` code : : generate_source_map ` ( # 80978 ) # # # what ? # # # why ? it turns out that ` minify ( ) ` function itself was consuming lots of memory , instead of the swc minifier .
508	[ test ] unflake turbopack dev navigation test case ( # 80407 ) unflake turbopack dev test ` ` ` pnpm test - dev - turbo test / e2e / app - dir / actions / app - action . test . ts ( turbopack ) app - dir action handling > should forward action request to a worker that contains the action handler ( node ) app - dir action handling > should forward action request to a worker that contains the action handler ( edge ) ` ` ` x - ref : https : / / github . com / vercel / next . js / actions / runs / 15581296918 / job / 43881444430 ? pr = 80392
509	add create release branch workflow ( # 81687 ) this creates a new workflow to create a release branch and apply the necessary configs to allow releasing from that branch as this is quite common for backports .
510	refactored module ids optimization ( # 68846 ) # # # what ? refactored module id strategies implementation to walk modules graph individually for each endpoint . based on feedback from [ next . js # 68408 ] ( https : / / github . com / vercel / next . js / pull / 68408 ) and [ turbo # 8912 ] ( https : / / github . com / vercel / turbo / pull / 8912 ) . comments marked with ` note ( lichuacu ) ` are intended to make reviewing easier and will be removed before merging .
511	turbopack : remove undocumented legacy syntax for built - in conditions ( e . g . foreign , browser ) ( # 83068 ) - https : / / github . com / vercel / next . js / pull / 82857 provides a better way to do this that we intend to document . - this syntax was never documented ( outside of the types and tests ) . you wouldn ' t be able to figure out the built - in conditions without digging through the turbopack source code .
512	revert " [ image , link ] fix ref merging for callback refs that return a cleanup function " ( # 68176 ) seems this is causing us to hit the following error our vercel - site ` ` ` sh referenceerror : navigator is not defined vercel - site : build : at s ( / vercel / path0 / apps / vercel - site / . next / server / chunks - edowhfq0fcxdtuqmp - 83_ / 65787 . js : 161 : 168406 ) vercel - site : build : at u ( / vercel / path0 / apps / vercel - site / . next / server / chunks - edowhfq0fcxdtuqmp - 83_ / 65787 . js : 50 : 154810 ) ` ` ` reverts vercel / next . js # 68123
513	turbopack : add webpack scope - hoisting tests ( # 79457 ) add them already , they should pass even without scope hoisting .
514	perf ( turbopack ) : remove needless clone of sourcemap ( # 78972 ) # # # what ? use ` sourcemap : : sourcemap : : adjust_mapping ` directly instead of relying on ` swc_common ` . # # # why ? https : / / github . com / swc - project / swc / blob / 6750459d9180048a39c11e14b02c9bfed251a12e / crates / swc_common / src / source_map . rs # l1385 - l1388 ` ` ` rust if let some ( mut orig ) = orig . cloned ( ) { orig . adjust_mappings ( & map ) ; return orig ; } ` ` ` if we pass ` orig , ` the original source map is cloned . i ' ll fix this api issue from the swc side in the future . x - ref , numbers : https : / / vercel . slack . com / archives / c03ewr7lgen / p1746729015204369 ? thread_ts = 1746727709 . 014039 & cid = c03ewr7lgen
515	[ test ] isolate parallel metadata test ( # 78134 ) # # # what isolate parallel - routes related test cases for streaming metadata into a standalone test suite . prepared to add more parallel route test cases into it .
516	feat ( turbopack ) : add support for esm externals in app dir ( # 64918 ) # # # what ? writes the async flag to the client reference manifest to support esm externals in app dir . the ` app - ssr ` context can ' t have esm externals as that might cause a module to be async in ssr but not on the client . closes pack - 2967 fixes # 64525
517	update rspack production test manifest ( # 82397 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
518	update rspack development test manifest ( # 84480 ) this auto - generated pr updates the development integration test manifest used when testing rspack .
519	add explicit section about type overriding for v15 ( # 72866 ) this breaks out the type overriding note from a small good to know section to it ' s own section as it ' s fairly important and easy to miss currently . also the minimal note isn ' t getting picked up in our search currently . x - ref : [ slack thread ] ( https : / / vercel . slack . com / archives / c0676qzbwks / p1731602395153929 )
520	update rspack development test manifest ( # 80137 ) this auto - generated pr updates the development integration test manifest used when testing rspack .
521	add codemod for removing ` experimental_ppr ` ( # 84979 ) ` experimental_ppr ` is removed by https : / / github . com / vercel / next . js / pull / 84871 , so add codemod for it .
522	turbopack : add unknown into analysis for mutable for - of loops ( # 70080 ) closes pack - 3249 closes # 70056 array indexing always inserts ` unknown ` into the result for mutable arrays ( because the array might have been mutated somehow in the meantime ) . the same wasn ' t done for ` iterated ` ( for - of loops ) .
523	[ ci ] : fix app - static snapshots with clientsegmentcache ( # 84468 ) more things that are only broken because we assert on ` . next ` files . updates snapshots and removes the failing tests from the clientsegmentcache manifest .
524	[ turbopack ] simplify take_issues and peek issues ( # 84199 ) * don ' t construct a ` cell ` just use an ` arc ` * this will make it possible to call ` peek_issues ` in a top level transient task * this required making ` autoset ` ` taskinput ` compatible . the downside is that a few tasks get a more complicated hash / eq implementation for their inputs but the ` delegatinginputtracer ` value is generally very small so this should be fine . * these functions are no longer async or failable , so simplify the signature
525	fix ( rustdoc ) : fix rustdoc warnings , block on rustdoc failures in ci ( # 76448 ) when we break rustdoc , it causes warnings on every pr , e . g : ! [ screenshot 2025 - 02 - 24 at 1 . 38 . 28 pm . png ] ( https : / / graphite - user - uploaded - assets - prod . s3 . amazonaws . com / hazvitxrnnzz8qmipn4a / a368e9a5 - 4ca6 - 4b3a - 913e - df68aa038b7f . png ) . . . so we should either not check the rustdocs at all , or block on them . this makes them blocking .
526	turbopack : fix sst filter handling and order for meta files ( # 80147 ) # # # what ? * fixes a bug where it crashes with ` unable to open static sorted file 00000286 . sst ` after a compaction which leaves a partial meta file . meta files need to be handled in reverse order as higher sequence numbers override lower ones * fixes another bug where sst files in meta files were processed in incorrect order this could cause reading outdated values , maybe causing the incorrect graph problem or stale tasks / errors
527	handle source map requests for turbopack client chunks ( # 71168 ) since turbopack is generating actual source map files , and not inlined source maps as webpack does , react might request a source map for a client chunk using the chunk ' s url pathname , e . g . ` / _next / static / chunks / [ project ] __edc466 . _ . js ` . in the source map dev middleware , we need to convert those url pathnames to filenames before requesting the source map for the file from turbopack . # # test plan - start ` pnpm next dev - - turbo test / development / app - dir / source - mapping ` - go to ` http : / / localhost : 3000 / client ` - open react devtools
528	fix : add popular embedding libraries to serverexternalpackages ( # 76574 )
529	docs : update staletimes . mdx ( # 72967 ) fix mdx formatting . previously mdx was not formatted correctly . ( see image - ` prefetch = ` ) https : / / nextjs . org / docs / app / api - reference / next - config - js / staletimes <img width = " 659 " alt = " screenshot 2024 - 11 - 19 at 15 11 57 " src = " https : / / github . com / user - attachments / assets / 44f77fd4 - 657e - 409a - 9190 - 9430fd96d5f8 " > - - - - - - - - - co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com>
530	[ ppr ] remove canary requirement ( # 66112 ) this removes the canary requirement for using ppr in a project , and now enables use on stable releases .
531	remove related e2e workflow ( # 66758 ) i ' m working on fixing our deploy tests workflow . see : - # 66721 this particular workflow runs on each pr but it uses the canary version . it also wipes the deploy test project which will cause conflicts with the main e2e one . removing this for now since it ' s not working as intended , and will reland it with fixes . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
532	[ dynamicio ] fix dev warmup ( # 77829 ) when ` dynamicio ` is enabled , we ' re triggering a warmup request in dev mode . this ensures that replayed logs are associated with the correct environment ( ` prerender ` vs . ` server ` ) , by seeding the caches before the actual render . this pr fixes two issues with the dev warmup : - ensures that cache keys are identical between the warmup , the subsequent dynamic render , and the dynamic validation , by providing the hmr refresh hash ( part of the cache key ) for all dev render phases . - ensures that stale cache entries are discarded during the warmup , by providing the implicit tags also during the warmup ( and the dynamic validation ) .
533	create empty update_react . yml as a no - op ( # 69318 )
534	[ dev - overlay ] style : make ` <a> ` tag in terminal to stand out ( # 76483 ) # # # why ? the color of a tag from the css reset has a bad color contrast with the background colors . also , the hotlink text used in the terminal component didn ' t stand out , which is easy to miss . https : / / github . com / vercel / next . js / blob / 265aba55ef048537ca5d69702b12c1231ec2d3b3 / packages / next / src / client / components / react - dev - overlay / ui / styles / css - reset . tsx # l159 - l168 | - - - - - - | before | after | | - - - - - - - - | - - - - - - - - | - - - - - - - - | | light | ! [ cleanshot 2025 - 02 - 25 at 20 25 23 ] ( https : / / github . com / user - attachments / assets / b66fd782 - 7dbd - 4846 - 9804 - a069d9be75e1 ) | ! [ cleanshot 2025 - 02 - 25 at 20 25 16 ] ( https : / / github . com / user - attachments / assets / 3213da7d - 3c25 - 4a5e - a371 - bb6827ce134d ) | | dark | ! [ cleanshot 2025 - 02 - 25 at 20 25 29 ] ( https : / / github . com / user - attachments / assets / 4a4409a8 - f78e - 4b82 - 948a - daf30c3da8e7 ) | ! [ cleanshot 2025 - 02 - 25 at 20 25 10 ] ( https : / / github . com / user - attachments / assets / c8f35fd1 - 7ac0 - 443c - 816a - c34fd47e3be3 ) | closes ndx - 900
535	[ dev - overlay ] fix : do not open error overlay when click indicator ( # 75404 ) # # # why ? as we added back the " open / dismiss issues " label next to the indicator at https : / / github . com / vercel / next . js / pull / 74975 , no need to open error overlay when clicked the indicator . # # # before https : / / github . com / user - attachments / assets / 52fac449 - 7f92 - 4793 - 84d5 - 599f85b4a8bf # # # after https : / / github . com / user - attachments / assets / 962bb3e2 - 9b25 - 4d16 - 88d7 - 1e5d05cc9a38 closes https : / / linear . app / vercel / issue / ndx - 721 / fix - toggle - behavior - for - collapsed - pill - and - issue - button
536	update font data ( # 68964 ) this auto - generated pr updates font data with latest available
537	[ dev - overlay ] do not force hide scrollbar ( # 76504 )
538	update rspack development test manifest ( # 82192 ) this auto - generated pr updates the development integration test manifest used when testing rspack .
539	hide stack for bad input by default ( # 71253 )
540	build : update ` swc_core ` to ` v0 . 95 . 2 ` ( vercel / turbo # 8502 ) # # # description - [ changelog ] ( https : / / github . com / swc - project / swc / blob / 064af5391d8da9599f277bd68fd0b479b0b1235c / changelog . md # 160 - - - 2024 - 06 - 15 ) i improved the performance of the parser by margin . # # # testing instructions
541	feat ( after ) : allow using unstable_after in generatestaticparams ( # 73217 ) allows using ` unstable_after ` in ` generatestaticparams ` . definitely niche , but since we ' re now allowing ` after ` to be used during build , i see no reason not to . also fixes an issue where we didn ' t pass ` experimental . after ` into the context used for ` generatestaticparams ` , so if ` after ` was called , it ' d always say that you have to enable ` experimental . after ` even if you already did .
542	[ segment explorer ] capture defined boundaries ( # 81232 ) capture defined boundaries ( not - found / error / loading ) and used to filter which one is available for boundary triggers the trie will now hold all the defined boundaries , but what ' s different from the existing rendered boundaries is : here ' s the difference of new defined boundary trie nodes : ` ` ` { type : " boundary : <type> " pagepath : " <pagepath> @ boundary " } ` ` ` we add a ` boundary : ` prefix to determine if it ' s node representing existence ; we add a ` @ boundary ` suffix to the filename cause the <pagepath> part is still need to use for indexing in the trie , but the ` @ boundary ` doesn ' t matter yet . we ' ll remove it once we start using the file name in the dropdown panel closes next - 4330 # # # example when there ' s only one not - found . tsx , allow to trigger the not - found boundary and disable the rest . https : / / github . com / user - attachments / assets / eb5c49a7 - 4fd2 - 496b - b778 - fb66581908b3
543	turbopack : fix setting existing env var in webpack loader ( # 78962 ) # # what ? we use a proxy around ` process . env ` , the setter was not implemented and this caused some issue in node . js when it checks for if ` process . env ` is writeable . this fixes that case . full report in # 78804 . fixes # 78804 fixes pack - 4550
544	[ turbopack ] mark ` rcstr ! ` allocated rcstr values as ' static ' and stop refcounting them ( # 81994 ) # optimize rcstr with static atom support # # what ? for rcstr values allocated by the ` rcstr ! ` macro we shouldn ' t bother reference counting them since they are pinned to a static memory location already . this uses a spare tag bit ` 0b10 ` to mark such strings as ' static ' which allows us to to optimize the ` clone ` and ` drop ` . the only practical cost is an additional constant bit mask when reading the value as a pointer . also : * add a fast path for ` partialeq<rcstr> ` to handle identical values , this is useful especially for inline rcstr values but adds a fast path for refcounted strings as well . * compute the ` hash ` of ` rcstr ! ` parameters at compile time by ` const ` - ifying the hash fn * allocate static storage for the ` precomputehash ` struct - ideally we would ' const ' allocate it , but ` string ` isn ' t const compatible . we could maybe use ` string : : from_raw_parts ` but it would depend on too many implementation details . the real solution here is probably to change the definition of prehashedstring to hold an either or a cow ? not sure if that is worth it . # # why ? atomic ref counting is cheap but not free , we have a large number of ` rcstr ! ` allocated strings and so it is pure overhead to spend any time refcounting them when the count will never hit zero . see the upstack pr for some performance measurements on vercel - site
545	run and report benchmarks ( # 66851 ) using ` @ vercel / devlow - bench ` , this benchmarks changes landed on canary and reports results to datadog .
546	bump styled - jsx to 5 . 1 . 6 ( # 66185 )
547	examples : further supabase improvements ( # 69407 ) co - authored - by : lee robinson <me @ leerob . io>
548	test : move hmr error recovery test to a separate file ( # 73592 ) > [ ! note ] > the " test new tests for flakes " may fail due to the number of tests in a single ` hmr . test . ts ` file . > the follow - up stacks are to resolve the issue . # # # why ? moved to a separate file to run the test in parallel .
549	bugfix : actions that redirect should reject the action promise ( # 69945 ) when calling ` redirect ` in a server action , the action handler will invoke a worker to fetch the rsc payload from the url being redirected to , and will return it in the action request . this allows the redirect to be handled in a single request rather than requiring a second request to fetch the rsc payload on the url being redirected to . as part of this special redirection handling , no action result is returned , so the action promise is resolved with ` undefined ` . as a result of this behavior , if your server action redirects to a page that has the same form that was just submitted , and you ' re leveraging ` useactionstate ` , the updated state value will be undefined rather than being reset to the initial state . * * more generally , redirect errors are handled by the client currently by simply resolving the promise with undefined , which isn ' t the correct behavior . * * this pr will reject the server action promise with a redirect error , so that it ' ll be caught by our ` redirectboundary ` . since react will remount the tree as part of the error boundary recovery , this effectively resets the form to it ' s initial state . if the action is rejected in a global ` starttransition ` , then it ' ll be handled by a global ` error ` handler , which will perform the redirect . and if it occurs outside of a transition , the redirect will be handled by a ` unhandledrejection ` handler . because we ' re not able to apply the flight data as - is in the server action reducer ( and instead defer to the navigation action ) , we seed the prefetch cache for the target page with the flight data from the action result so that we do not need to make another server roundtrip . we apply the same static / dynamic cache staletime heuristics for these cache entries . fixes # 68549 closes ndx - 229
550	docs : next . js 15 updates ( # 65603 ) react 19 - [ x ] react compiler - [ x ] check all examples for new api usage e . g . ` useactionstate ` , ` use ` - [ x ] review server actions page and link to react docs . next . js 15 - [ x ] ppr incremental adoption and placeholder page - for seo - [ x ] ` next / after ` - [ x ] package bundling - [ x ] upgrade guide - [ x ] clarify new ` fetch ` behavior - [ x ] route handlers - dynamic - [ x ] client - side router cache - [ x ] add " good to know " about metadata route handlers being cached 15 and beyond - [ x ] remove recommendations for ` revalidate = low value ` - [ x ] review and consolidate data fetching section - [ ] client - side data fetching patterns - [ ] streaming data pattern with react ` use ` - [ ] seeding initial data from the server redirects and blog post : https : / / github . com / vercel / front / pull / 32249 - - - - - - - - - co - authored - by : ahmed abdelbaset <a7med3bdulbaset @ gmail . com> co - authored - by : anthony shew <anthonyshew @ gmail . com> co - authored - by : michael novotny <manovotny @ gmail . com> co - authored - by : ethan arrowood <ethan @ arrowood . dev> co - authored - by : stephdietz <steph . dietz @ vercel . com> co - authored - by : stephanie dietz <49788645 + stephdietz @ users . noreply . github . com> co - authored - by : zack tanner <1939140 + ztanner @ users . noreply . github . com>
551	turbopack : fix export - all - as with name collision ( # 81510 ) ` ecmascriptmodulepartreference ` is a pretty counterintuitive reference . the ` part ` declares which module should be synthesised on the other side . that doesn ' t have anything to do with which exports are actually being imported by reference . this only triggered a bug when these exports here had the same name by coincidence ` ` ` js / / reexport . js export * as sub from ' . / sub . js ' / / < - - / / sub . js export const sub = 123 / / < - - ` ` `
552	fix export statement validations for app router pages ( # 75278 ) fixes all issues related to the current export statement validation for app router pages , as highlighted in # 75277 .
553	refactor ( cna ) : use commander ` args ` instead of ` process . argv ` ( # 68454 ) # # # why ? resolve left - out refactors from # 68233 # # # how ? used commander ' s ` args ` and ` opts ` values , which remove a few lines . synced the variable name for the ` app ` value for consistency and possible future destructuring .
554	remove dynamicio flag ( # 84872 ) this flag is now ` experimental . cachecomponents ` . we kept around the old version with auto - migration , and now that we ' ve had that around for some time , we ' re dropping support for the configuration all together .
555	stop using deprecated ` turbo_remote_only ` ( # 75832 )
556	fix parallel routes ignoring generatestaticparams from primary route ( # 84889 ) # # # what ? fixes a bug where ` generatestaticparams ` from the primary route was being ignored when dynamic segments existed in both regular routes ( ` children ` ) and parallel routes ( e . g . , ` @ breadcrumbs ` ) , causing routes that should have been statically generated to return 404 errors . also fixes a related redirect loop issue that occurred when serving 404 pages with rsc request header validation enabled . # # # why ? * * primary issue : segment deduplication * * the ` collectapppagesegments ` function had two code paths for deduplicating segments when the same dynamic parameter ( like ` [ slug ] ` ) appeared in both the primary route tree and parallel routes : 1 . * * individual segment processing * * - correctly preferred non - parallel segments 2 . * * batch processing at page boundaries * * - blindly overwrote existing segments without preference checking due to bfs traversal order , parallel route segments would overwrite the correct ` children ` route segments during batch processing . this marked parameters as ` isparallelroutesegment : true ` , which : - prevented the build system from recognizing them as regular route parameters - caused ` generatestaticparams ` to be ignored during prerendering - resulted in all routes being treated as dynamic - only ( 404s with ` dynamicparams = false ` ) this violated the architectural invariant that parallel routes are " secondary " to the main route hierarchy - the primary route tree should determine url structure and static generation behavior . * * secondary issue : 404 page redirect loop * * when serving a 404 page ( nofallbackerror ) , the experimental rsc request header validation would cause an infinite redirect loop . this happened because : - headers are already stripped when serving the 404 page - the validation comparison would always fail - this triggered a redirect , which would hit the same 404 , creating a loop # # # how ? * * segment preference fix ( ` app - segments . ts ` ) : * * applied consistent segment preference logic to both deduplication code paths in ` collectapppagesegments ` and ` collectfallbackrouteparams ` , ensuring segments from the ` children ` route are always preferred over parallel route segments . this preserves the following guarantees : 1 . * * url structure is determined by the primary route tree * * - parallel routes derive their parameters from ` children ` , not vice versa 2 . * * ` generatestaticparams ` works correctly * * - static generation is controlled by the primary route ' s configuration 3 . * * parallel routes remain decorative * * - they enhance the page without affecting core routing behavior * * redirect loop fix ( ` base - server . ts ` ) : * * skip rsc request header validation when serving 404 pages ( ` ! is404page ` condition ) , preventing the redirect loop caused by already - stripped headers failing the validation check . * * test coverage : * * added comprehensive e2e test suite covering : - root parameters with ` generatestaticparams ` and ` dynamicparams = false ` - dynamic child routes with and without ` generatestaticparams ` - parallel route slots with shared dynamic segments - prefetch behavior to ensure no redirect loops during preloading fixes # nar - 446
557	fix ( dev - overlay ) : ignore right clicks on the indicator draggable ( # 79120 ) without this change , right clicking on the indicator starts the drag action , which leads to janky behavior with the native browser context menu . only allow dragging with the primary mouse button . i also tested this in the mobile simulator mode to make sure i didn ' t break anything there .
558	chore ( turbopack ) : delete some dead code that was using unresolved vcs ( # 74705 )
559	fix : prevent url mutation in router rewrites ( # 83963 ) # # # what ? this pr fixes critical url mutation issues in next . js routing that were causing state pollution between requests and breaking compatibility between app router and pages router during rewrite handling . # # # why ? several interconnected problems were discovered in the routing system : 1 . * * url object mutation * * : the original ` parsedurl ` objects were being mutated during rewrite processing , causing state to leak between requests and potentially affecting subsequent routing decisions . 2 . * * router type confusion * * : the routing system lacked explicit tracking of whether a route belonged to the app router or pages router , leading to incorrect query parameter handling and normalization logic being applied inconsistently . 3 . * * query parameter pollution * * : app router rsc payloads were being polluted with rewrite query parameters that should only be applied to pages router routes , breaking the separation of concerns between the two routing systems . 4 . * * catch - all route normalization * * : pages router catch - all routes require specific array normalization ( e . g . , ` [ " hello " , " world " ] ` ) but this was being applied inconsistently or to the wrong router type . 5 . * * middleware filtering bypass * * : the x - matched - path header handling was bypassing proper middleware query filtering in deployment scenarios . these issues manifested as test failures where pages router catch - all routes weren ' t receiving proper array values , app router routes were getting contaminated with rewrite parameters , and the routing behavior was inconsistent between development and deployment environments . # # # dependant pr ' s https : / / github . com / vercel / vercel / pull / 13927 [ nar - 398 ] ( https : / / linear . app / vercel / issue / nar - 398 )
560	[ build - sourcemaps ] ensure errors during prerender can be sourcemapped ( # 78709 ) these weren ' t sourcemapped because we logged the stack directly as a string . only actual error instances will be sourcemapped not arbitrary strings . now we ' ll also include digest and ` cause ` in the error .
561	feat : port edge assert plugin to turbopack ( # 69041 ) # # # what ? port ` middlewareplugin ` to turbopack # # # why ? to make turbopack behave identically to webpack mode . # # # how ? closes pack - 3196
562	chore ( cna ) : switch to . mjs tailwind config ( # 72124 ) # # # what ? tailwind css [ supports an esm config ] ( https : / / tailwindcss . com / docs / configuration # using - esm - or - type - script ) file . this pr changes ` tailwind . config . js ` to ` tailwind . config . mjs ` . # # # why ? 1 . to convert one more file to esm 2 . to use the modern format 3 . to follow other similar migrations that have taken place in the next . js codebase ( e . g . ` next . config . mjs ` ) # # # how ? 1 . change file extensions from ` . js ` to ` . mjs ` 2 . change module format from commonjs to esm co - authored - by : sam ko <sam @ vercel . com>
563	[ ts - hint ] fix vscode type hint plugin enabling ( # 77099 ) # # # what fix the enabling of ts hint plugin in vscode . this is a regression introduced in # 76300 , where we use the plugin config ` { " name " : " next " } ` to directly check if it has a ` enabled ` property , and determine if we should enable the plugin . this pr fixed the way of reading plugin config and keep it enabled by default . fixes 76980
564	turbopack build : skip babel specific tests ( # 67912 ) ensures the tests that depend on ` . babelrc ` are skipped . this is not supported in turbopack without adding the babel - loader , and then ` next / babel ` is not needed . < ! - - thanks for opening a pr ! your contribution is much appreciated . to make sure your pr is handled as smoothly as possible we request that you follow the checklist sections below . choose the right checklist for the change ( s ) that you ' re making : # # for contributors # # # improving documentation - run ` pnpm prettier - fix ` to fix formatting issues before opening the pr . - read the docs contribution guide to ensure your contribution follows the docs guidelines : https : / / nextjs . org / docs / community / contribution - guide # # # adding or updating examples - the " examples guidelines " are followed from our contributing doc https : / / github . com / vercel / next . js / blob / canary / contributing / examples / adding - examples . md - make sure the linting passes by running ` pnpm build & & pnpm lint ` . see https : / / github . com / vercel / next . js / blob / canary / contributing / repository / linting . md # # # fixing a bug - related issues linked using ` fixes # number ` - tests added . see : https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # # adding a feature - implements an existing feature request or rfc . make sure the feature request has been accepted for implementation before opening a pr . ( a discussion must be opened , see https : / / github . com / vercel / next . js / discussions / new ? category = ideas ) - related issues / discussions are linked using ` fixes # number ` - e2e tests added ( https : / / github . com / vercel / next . js / blob / canary / contributing / core / testing . md # writing - tests - for - nextjs ) - documentation added - telemetry added . in case of a feature if it ' s used or not . - errors have a helpful link attached , see https : / / github . com / vercel / next . js / blob / canary / contributing . md # # for maintainers - minimal description ( aim for explaining to someone not on the team to understand the pr ) - when linking to a slack thread , you might want to share details of the conclusion - link both the linear ( fixes next - xxx ) and the github issues - add review comments if necessary to explain to the reviewer the logic behind a change # # # what ? # # # why ? # # # how ? closes next - fixes # - - >
565	updated the example of api - routes to utilize the app router ( # 68771 ) this pr updates the api - routes example to use the app router . here are the changes that have been made : - renamed the " pages " folder to the " app " folder . - updated the routing for / , & / person / [ id ] files to align with the app router . - added the layout . tsx file as part of the app router . - updated the package . json file . cc : @ samcx - - - - - - - - - co - authored - by : samcx <sam @ vercel . com>
566	docs : split " get started : route handlers and middleware " to route handlers and proxy ( # 84708 ) this pr splits the route handlers and middleware to allow for separate onboarding docs , making it easier to migrate the docs from middleware to proxy . these pr stacks are to publish a full replacement of the docs for the middleware to proxy . steps are as follows : - split " get started : route handlers and middleware " to route handlers / proxy - clone the middleware docs for proxy - add " migration to proxy " section to middleware docs - explain the rationale for the renaming to proxy - provide migration guide - add an error doc that the deprecation warning can refer to . the error doc will : - explain why this error occurred - provide migration guide - explain the rationale for the renaming to proxy
567	fix : otel root span should indicate error status on exceptions ( # 82212 ) for cases when the root span ' s status returned 500 , the span status returned ` ok ` . this results in inaccurate telemetry , as users may expect the span to indicate an error when a 500 occurs . failed ci : https : / / github . com / vercel / next . js / actions / runs / 16633984270 / job / 47070403977 ? pr = 82212 # step : 34 : 427 also , the otel documentation states : > for http status codes in the 5xx range , as well as any other code the client failed to interpret , span status should be set to error . x - ref : https : / / opentelemetry . io / docs / specs / semconv / http / http - spans / # status therefore , set the root span to ` error ` when the status is in the 5xx range . in addition , as the document states : > when instrumentation detects such errors it should set span status to error and should set the error . type attribute . added ` error . type ` attributes to places where sets ` error ` span status . fixes next - 4668
568	[ breaking ] remove deprecated built - in amp ( # 84312 ) this pr removes the deprecated built - in amp support . will follow up with cleaning up the examples , docs , and codemods .
569	update reactstrictmode . mdx enabled since 13 . 5 . 1 ( # 70557 ) spent over 2 hours checking why with 13 . 4 . 19 components didn ' t mount twice as the docs says " good to know : since next . js 13 . 4 , strict mode is true by default with app router " . but it ' s enabled by default in [ 13 . 5 . 1 ] ( https : / / github . com / vercel / next . js / releases / tag / v13 . 5 . 1 ) . version [ 13 . 5 . 0 ] ( https : / / github . com / vercel / next . js / releases / tag / v13 . 5 . 0 ) has no changelog ? maybe reactstrictmode it ' s enabled by default since 13 . 5 . 0 instead 13 . 5 . 1 ? fixes : https : / / github . com / vercel / next . js / issues / 70559 co - authored - by : jj kasper <jj @ jjsweb . site>
570	chore : update rspack to 1 . 4 . 5 ( # 81216 )
571	create erroroverlay component ( # 74073 ) # # # why ? this pr refactored overlay to have a common layout as they share much in common and are also better for testing the layout . will follow up with ` errors ` component as it needs some ui break downs . note : patched ` @ storybook / react ` for the type error : - https : / / github . com / vercel / next . js / actions / runs / 12394130672 / job / 34596896487 # step : 8 : 565
572	fix : add parser metadata for eslint 9 cache ( # 74791 ) when using ` eslint - config - next ` on eslint 9 . x with a flat config ( as per next . js [ docs ] ( https : / / nextjs . org / docs / app / api - reference / config / eslint # specifying - a - root - directory - within - a - monorepo ) ) and with the ` - - cache ` flag - eslint would fail : ` ` ` > . / node_modules / . bin / eslint - - cache oops ! something went wrong ! : ( eslint : 9 . 17 . 0 typeerror : cannot serialize key " parse " in parser : function values are not supported . at languageoptionstojson ( . . . / next - eslint - issue / node_modules / eslint / lib / config / config . js : 113 : 23 ) at languageoptionstojson ( . . . / next - eslint - issue / node_modules / eslint / lib / config / config . js : 107 : 35 ) at config . tojson ( . . . / next - eslint - issue / node_modules / eslint / lib / config / config . js : 260 : 30 ) at stringify ( . . . / next - eslint - issue / node_modules / json - stable - stringify - without - jsonify / index . js : 25 : 25 ) at module . exports ( . . . / next - eslint - issue / node_modules / json - stable - stringify - without - jsonify / index . js : 68 : 7 ) at hashofconfigfor ( . . . / next - eslint - issue / node_modules / eslint / lib / cli - engine / lint - result - cache . js : 50 : 75 ) at lintresultcache . getcachedlintresults ( . . . / next - eslint - issue / node_modules / eslint / lib / cli - engine / lint - result - cache . js : 116 : 30 ) at . . . / next - eslint - issue / node_modules / eslint / lib / eslint / eslint . js : 783 : 41 at async promise . all ( index 0 ) at async eslint . lintfiles ( . . . / next - eslint - issue / node_modules / eslint / lib / eslint / eslint . js : 759 : 25 ) ` ` ` ( see a minimal repro here : https : / / github . com / cvx / next - eslint - issue ) this happens because eslint is unable to serialize the ` parser ` object in the config . adding metadata fixes that . the issue was originally reported over at eslint repo in : https : / / github . com / eslint / eslint / issues / 19322
573	turbopack : initially shard sst files ( # 78652 ) # # # what ? when many entries are written for a key family in a write batch , shard the entries into multiple sst files by key space . this results in better initial distribution of keys and allows for 4 compactions to happen in parallel
574	align the typeenv value type with default process env value type ( # 67804 ) # # # what align the typeenv value type with default process env value type ` string | undefined ` # # # why ? when the ` experimental . typedenv ` is enabled , we generate a ` env . d . ts ` file during the dev server . the type for the loaded env values will be ` string ` on dev ( type inference ) . since we do not generate the ` env . d . ts ` file during the build time , there could be confusion from the difference of env types between the dev and build . the reason we don ' t want to strongly type as ` string ` or ` readonly string ` is because the multiple environment : dev , preview , production , where the env could be different . if we type in one place based on the loaded . env file , the environment ( like deployment preview or deployment production ) might not have these values in env files or they only have the env vars in node . js ` process . env ` . so the type file in build could be unpredictable , after discussion we decided to keep the original type for values , but the keys of envs are still be able to hint during development . # # # how ? temporarily infer the type as ` string | undefined ` . the ` typedenv ` will serve as the intellisense ( type hint ) . closes ndx - 84
575	[ turbopack ] perf improvements new backend ( # 71249 ) # # # what ? a bunch of small performance optimizations * split operation_suspend_point in inlined and cold part * keep children count instead of iterating children every time * avoid bubbling find and schedule into already scheduling parts of the graph * reduce number of turbo - tasks function calls in esmassertreference : : code_generation * avoid creating empty maps sadly no measurable effect . . .
576	show string values for configured experimental features ( # 80686 ) follow - up to # 74692 . we can not only show numbers , but also strings when printing the configured experimental features in the cli .
577	update ` swc_core ` to ` v0 . 100 . 6 ` ( # 68560 ) # # # what ? update swc crates to https : / / github . com / swc - project / swc / commit / ed635ce91086f2eb00644bbca036ca686f035dbe # # # why ? to keep in sync . # # # how ?
578	turbopack : allow overriding tsconfig path via next - config ( # 77563 ) this : - adds a test asserting the user can override the tsconfig path via the next - config . this is already supported with next . js and webpack . - implements the necessary code to pass the test and implement support with turbopack . test plan : ` pnpm test - dev test / e2e / tsconfig - path / index . test . ts & & pnpm test - dev - turbo test / e2e / tsconfig - path / index . test . ts ` closes pack - 4215
579	chore ( github ) : update stale bot ( # 75630 ) # # why ? a ` days - before - issue - stale ` period of two years has so far been successful . we can now move this to ~ 1 . 5 years ( 545 days ) .
580	docs : add canary tags to ` expirepath ` and ` expiretag ` ( # 73096 ) - ` expirepath ` and ` expiretag ` are not yet available in a stable version , so we don ' t want these apis leaking into stable docs .
581	refactor : updated route regexp handling to simplify ( # 74996 ) previously we had to do a lot of custom regexp source mangling in order to preserve extra bits ( like the ` . rsc ` or ` . json ` suffixes ) on dynamic route parameter segments . this updates the handling to simply includes those in situations where it ' s desired . unit tests have been created to verify the new behaviour , no additional e2e tests should need to be adjusted .
582	expand ` server - source - maps ` scenarios to cover edge runtime ( # 72288 ) . . . and use test patterns more consistently
583	docs : getting started guide on css ( # 73341 )
584	refactor ( turbopack ) : make invalidator flag explicit ( # 80487 ) # # # what ? retry https : / / github . com / vercel / next . js / pull / 80414 . this time , i added ` invalidator ` required only for turbo tasks function , and made it real assertion . # # # why ? we need it . # # # how ? closes pack - 4826
585	docs : change ` mjs ` codeblocks to ` js ` ( # 79163 ) closes : https : / / linear . app / vercel / issue / doc - 4450 / missing - syntax - highlighting - on - mjs - codeblocks it looks like shiki doesn ' t really support ` mjs ` code blocks . for now , we keep the filename with ` . mjs ` extension , but change to ` js ` code block type . co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com>
586	support ` uint8array ` bodies when generating cache keys for post requests ( # 81465 ) when opting into caching a post request with the ` revalidate ` option , or when the server components hmr cache implicitly caches a post request , the body of the request is now correctly handled if it is a ` uint8array ` . previously , we logged ` failed to generate cache key for . . . ` and the cache was bypassed . closes nar - 180
587	support running react 18 tests on prs with a label ( # 70737 ) when we make changes that we want to assert pass on the react 18 . 3 matrix , we should have a way to do so on prs so that we can avoid failures hitting canary . this adds a label that will make the 18 . 3 . 1 tests run on prs .
588	ensure fetch is patched before preloading entries ( # 72363 ) if a user creates a custom fetch implementation in module scope , the logic to preload entries during ` next start ` will result in fetch not being patched before the userland implementation . as a result , it won ' t opt into any caching heuristics from our patched fetch . fixes # 71881 ( in addition to the other pr in this stack )
589	[ test ] account for react ' s usage of ` eval ` in dev ( # 80857 )
590	feat ( eslint - plugin ) : add minimal built - in flat presets ( # 73873 ) add minimal flat config presets for those who are building their own eslint flat presets and want to use their own parsers and settings . the usage would be like : ` ` ` js / / eslint . config . js import eslintpluginnext from ' eslint - plugin - next ' ; export default [ { files : [ ] , plugins : { } , settings : { } , languageoptions : { } , rules : { } } , eslintpluginnext . flatconfigs . recommended , / / or eslintpluginnext . flatconfigs . corewebvitals , ] ` ` ` - - - - - - - - - co - authored - by : jude gao <jude . gao @ vercel . com>
591	docs : app router ' s react version ( # 82180 ) closes : https : / / linear . app / vercel / issue / doc - 4930 / notes - about - app - routers - react - version - - - - - - - - - co - authored - by : rich haines <hello @ richardhaines . dev>
592	turbopack : codegen esmassetreference without turbo tasks ( # 76024 ) run ` esmassetreference : : code_generation ` without cells / turbo tasks . ` ` ` testing against 0293c96cf32 canary 71d8bfcc1f 14 . 8gb 529 . 67s user 81 . 57s system 883 % cpu 1 : 09 . 18 total mischnic / codegen - fewer - tasks 72eba1ead2 14 . 8gb 533 . 13s user 82 . 01s system 874 % cpu 1 : 10 . 32 total mischnic / codegen - fewer - tasks don ' t store twice 14 . 6gb 529 . 85s user 82 . 35s system 875 % cpu 1 : 09 . 90 total mischnic / codegen - esm - asset 14 . 2gb 528 . 69s user 81 . 37s system 881 % cpu 1 : 09 . 17 total ` ` `
593	don ' t start next server unnecessarily to assert build output ( # 80994 ) in some of these tests we only need to check the cli output after a build , so we can skip starting the server to save some cycles .
594	remove usage of " @ vercel / request - context " ( # 71383 ) removes usage of ` @ vercel / request - context ` , because now we have ` @ next / request - context ` and can get ` waituntil ` from there instead . dependent on builder changes from https : / / github . com / vercel / vercel / pull / 12286 , which were [ released in ` vercel @ 39 . 1 . 2 ` / ` @ vercel / next @ 4 . 4 . 0 ` ] ( https : / / github . com / vercel / vercel / pull / 12648 ) # # # testing we can verify that , when using an older builder ( which doesn ' t provide ` @ next / request - context ` ) , the deploy tests for ` after ` fail , because they can ' t access ` waituntil ` : ` ` ` # these will fail , except some edge runtime tests # because they can use fetcheventresult . waituntil as a fallback vercel_cli_version = ' vercel @ 39 . 1 . 1 ' \ next_test_version = ' https : / / vercel - packages . vercel . app / next / commits / b1b97b8bbaa2f9d400de42957869d138a54da304 / next ' \ pnpm test - deploy test / e2e / app - dir / next - after - app - deploy ` ` ` to see the errors , need to inspect the logs and look for this error message : https : / / github . com / vercel / next . js / blob / d1e554be4c0bac8bf28c84a05065c230cb6f9d80 / packages / next / src / server / after / after - context . ts # l145 but using ` 39 . 1 . 2 ` , they will pass , because ` @ next / request - context ` is present : ` ` ` # these will pass vercel_cli_version = ' vercel @ 39 . 1 . 2 ' \ next_test_version = ' https : / / vercel - packages . vercel . app / next / commits / b1b97b8bbaa2f9d400de42957869d138a54da304 / next ' \ pnpm test - deploy test / e2e / app - dir / next - after - app - deploy ` ` `
595	turbopack : create smaller initial files to reduce memory usage ( # 78778 ) # # # what ? large sst files lead to bigger memory usage as it accumulate entries for the sst file in memory . creating smaller sst files flushes them more frequent and reduces in flight memory . compaction will merge these smaller files to larger sst files during compaction .
596	chore : update ` with - supabase ` example to use ` getclaims ( ) ` ( # 81383 ) updates the ` with - supabase ` example to use the new and much faster ( when project is configured with asymmetric jwt support ) ` supabase . auth . getclaims ( ) ` function instead of ` getuser ( ) ` . - - - - - - - - - co - authored - by : benjamin woodruff <benjamin . woodruff @ vercel . com>
597	[ ts - next - plugin ] clean up unused proxy ( # 78539 ) cleaned up a leftover unused proxy following up on https : / / github . com / vercel / next . js / pull / 78237 . besides being unused , there was an issue reported from a large repository . the repository was a monorepo , and the apps ' modules were shared with each other . the user received an error : ` ` ` [ trace ] <semantic> response received : definitionandboundspan ( 951 ) . request took 0 ms . success : false . message : error processing request . cannot read properties of undefined ( reading ' updatefromproject ' ) typeerror : cannot read properties of undefined ( reading ' updatefromproject ' ) at synchronizehostdata ( . . . ) at object . getprogram ( . . . ) at getsource ( . . . ) at getentryinfo ( . . . ) at proxy . getdefinitionandboundspan ` ` ` the issue begins when ` getdefinitionandboundspan ` is triggeredâ€”typically via ` cmd + click ` or even hovering ( ! ) to view definitions , imports , or module references . in our case , since the repository contains multiple apps , each enabling the plugin , navigating across apps using ` cmd + click ` caused ` getdefinitionandboundspan ` to fire across multiple plugin instances . the root cause is that when ` getdefinitionandboundspan ` is triggered , it calls ` synchronizehostdata ( ) ` and checks whether it is to update the project by checking the ` host . updatefromproject ` exists . however , the language service host is somehow ` undefined ` ( assuming memory is overloaded due to initiating multiple plugins ) , so we received the error above . x - ref : https : / / github . com / microsoft / typescript / blob / 11e79327598db412a161616849041487673fadab / src / services / services . ts # l1692 - l1693 if we clean up this ` getdefinitionandboundspan ` proxy , the error above will be gone , but ` synchronizehostdata ` is called pretty much every time on language service requests , including ` getsemanticdiagnostics ` we are still proxying â€” a potential issue we can ' t control that could happen for complicated repositories like the above . x - ref : [ slack thread ] ( https : / / vercel . slack . com / archives / c03s8ed1dkm / p1744231020199229 )
598	fix : display multiple lockfile warn if neither ` outputfiletracingroot ` or ` turbopack . root ` option is provided ( # 82164 ) > better to be reviewed with " hide whitespace " . this pr fixed a bug where ` findrootdir ( ) ` was called and displayed multiple lockfile warnings even if the app had ` turbopack . root ` , as there was no ` outputfiletracingroot ` . x - ref : https : / / github . com / vercel / next . js / pull / 82164 # discussion_r2240470772 also , added information about the ` outputfiletracingroot ` option and its docs to the warning , as it was omitted from https : / / github . com / vercel / next . js / pull / 82052 . closes https : / / github . com / vercel / next . js / issues / 81864 closes https : / / github . com / vercel / next . js / issues / 82096
599	upgrade react from ` 73aa744b - 20250702 ` to ` 5d87cd22 - 20250704 ` ( # 81308 ) co - authored - by : nextjs - bot <it + nextjs - bot @ vercel . com>
600	docs : changing information about data fetching cache ( # 72301 ) what is the documentation issue ? there is incorrect information about how fetch works in the new next . js version ( ^ 15 . 0 . 0 ) . the documentation says that fetch is automatically cached in the said version but now by default fetchs are no longer being cached is there any context that might help us understand ? [ link of the section ] ( https : / / nextjs . org / docs / app / building - your - application / caching # fetch - optionscache ) does the docs page already exist ? please link to it . https : / / nextjs . org / docs / app / building - your - application / caching # fetch - optionscache - - - - - - - - - co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com> co - authored - by : sam ko <sam @ vercel . com>
601	docs ( fetch ) : update wording on conflicting cache and revalidate options ( # 80591 ) clarifies that using conflicting options such as ` { revalidate : 3600 , cache : ' no - store ' } ` results in a warning in the terminal rather than an error . this change helps accurately reflect the current runtime behavior and avoids misleading readers into expecting a hard failure . the update improves developer understanding when configuring fetch / cache strategies in their applications . - - - - - - - - - co - authored - by : joseph <joseph . chamochumbi @ vercel . com>
602	docs : update ` robots ` for ` generatemetadata ` spec ( # 75229 ) typically you would want things to be indexed , so flipping the defaults shown .
603	fix : replace original request body after middleware execution ( # 77662 ) in https : / / github . com / vercel / next . js / pull / 77553 we fixed reading the request body in middleware using the ` nodejs ` runtime . however , this caused issues with subsequent reads like in server actions . in sandbox , [ we run ] ( https : / / github . com / vercel / next . js / blob / 1e62ce2c61048ddc0297f1a4f268894541975521 / packages / next / src / server / web / sandbox / sandbox . ts # l146 - l148 ) ` . finalize ( ) ` after middleware is executed so we should do the same here . fixes https : / / github . com / vercel / next . js / issues / 77646 - - - - - - - - - co - authored - by : jj kasper <jj @ jjsweb . site>
604	fix pages api rewrite case ( # 78644 ) fixes case failing in https : / / github . com / vercel / vercel / actions / runs / 14716507754 / job / 41302495247 ? pr = 13276 we were missing the default locale handling necessary to process rewrite params for i18n pages api routes . <details> <summary>validated test case< / summary> ! [ cleanshot 2025 - 04 - 28 at 16 05 57 @ 2x ] ( https : / / github . com / user - attachments / assets / a30e24fe - da95 - 4f27 - a304 - ed5e6a9fc6f6 ) < / details>
605	turbopack : make ` turbo - tasks - memory ` crate rust 2024 ( # 79130 ) isolated ` cargo fmt ` changes into their own commit . please review the first commit for core changes . - ` gen ` is now a reserved word - marked ` get_event_description_static ` and ` get_event_description ` as ` ' static ` - marked ` handle_new_edge ` as ` use<c> `
606	update turbopack production test manifest ( # 79048 ) this auto - generated pr updates the production integration test manifest used when testing turbopack .
607	turbopack : use single write to loader ipc socket ( # 78423 ) co - authored - by : niklas mischkulnig <4586894 + mischnic @ users . noreply . github . com> co - authored - by : luke sandberg <lukesandberg @ users . noreply . github . com>
608	docs : getting started pages and search params ( # 80616 ) closes : https : / / linear . app / vercel / issue / doc - 4789 / getting - started - layout - and - pages - search - params - - - - - - - - - co - authored - by : delba de oliveira <32464864 + delbaoliveira @ users . noreply . github . com>
609	increase test retries from 1 to 2 ( # 73795 ) let ' s see how this affects the failure rate and duration of our tests in ci . test times for any given group might increase a bit , while hopefully at least increasing the chance that the whole test group succeeds . this would in theory reduce the number of times we have to re - run a whole failed test group , which is quite time consuming . a possible downside of this change is that flaky tests which have a chance of getting fixed with a better implementation might be harder to detect .
610	[ error overlay ] fix highlighted lines ( # 75940 ) # # # what we should treat each line ' s first character to determine the leading sign , rather than treating the trimed line ' s first character as sign . the bad case was the close tag ` > ` was treated as leading error sign ` ` ` > <p / / should be treated as errored line âœ… > / / should not be treated as errored line âŒ ` ` ` also align the attribute name for highlighted lines
611	update bundler production test manifest ( # 77107 ) this auto - generated pr updates the production integration test manifest used when testing alternative bundlers .
612	[ devtools ] implement default ` / . well - known / appspecific / com . chrome . devtools . json ` endpoint in dev ( # 80260 )
613	rename " blocking route " error docs page ( # 85189 ) the content needs to be updated , too , but for now this just fixes the link and title so it matches the updated error message in # 85087 .
614	build : update ` swc_core ` to ` v0 . 93 . 2 ` ( # 66698 ) # turbopack * https : / / github . com / vercel / turbo / pull / 8324 < ! - - tobias koppers - fix panic in debug mode - - > * https : / / github . com / vercel / turbo / pull / 8395 < ! - - donny / ê°•ë™ìœ¤ - build : update ` swc_core ` to ` v0 . 93 . 2 ` - - > # # # what ? update ` swc_core ` . # # # why ? update ` swc_core ` . the regression of minifier is fixed by https : / / github . com / swc - project / swc / pull / 9031 # # # how ?
615	update rspack production test manifest ( # 82267 ) this auto - generated pr updates the production integration test manifest used when testing rspack .
616	docs : add missing rls step to next . js tutorial ( # 82714 ) # # what this pr updates ` examples / with - supabase / components / tutorial / fetch - data - steps . tsx ` to include a missing step about enabling row level security ( rls ) and creating a simple read policy for the ` notes ` table . fixes : # 82218 # # why currently , the tutorial shows how to : - create a ` notes ` table - insert data - query data from next . js however , since rls is enabled by default in supabase , new users will get ` permission denied ` errors when querying data unless they configure policies . the official supabase next . js quickstart docs already mention this : https : / / supabase . com / docs / guides / getting - started / quickstarts / nextjs adding this step will help newcomers understand why rls is required and how to set it up . # # changes - added a new ` <tutorialstep> ` in ` fetch - data - steps . tsx ` : - explains that rls is enabled by default - shows sql snippet to enable rls + create a public read policy - links to the supabase rls docs # # checklist - [ x ] added rls tutorial step - [ x ] verified formatting matches other tutorial steps - [ x ] added links to relevant supabase docs co - authored - by : joseph <joseph . chamochumbi @ vercel . com>
617	docs : add secured server action ids section ( # 71368 )
618	turbopack : fix ` __dirname ` ( # 76902 ) ` __dirname ` was always ` undefined ` due to a typo . this was a regression from https : / / github . com / vercel / next . js / pull / 75358 , the pr restores the behavior of 15 . 1 . 7 closes # 76497 closes pack - 4060
619	[ turbopack ] use new backend by default ( # 72434 )
620	turbopack : remove the deprecated ` . turbo ` config object ( # 84109 ) this config name was previously deprecated in a 15 . x release ( renamed to ` turbopack ` ) , and there ' s already a codemod to migrate these over .
621	ensure we only handle app nav failure for actual error ( # 68285 ) we were seeing ` null ` errors in the app navigation failure handling so this ensures we check the error is a truthy value and only handle for that case . ! [ cleanshot 2024 - 07 - 29 at 11 45 42 @ 2x ] ( https : / / github . com / user - attachments / assets / 91d0e9ad - bedd - 4c4b - 9e0e - dc8b2e589671 )
622	[ segment cache ] initial implementation ( # 72875 ) based on : - # 72874 - # 72890 - # 72872 - - - this adds an initial implementation of the client segment cache , behind the experimental ` clientsegmentcache ` flag . ( note : it is not anywhere close to being ready for production use . it will take a while for it to reach parity with the existing implementation . ) i ' ve discussed the motivation in previous prs , but i ' ll share a brief summary here again : the client segment cache is a rewrite of app router ' s client caching implementation , designed with ppr and " use cache " in mind . its main distinguishing feature from the current implementation is that it fetches / caches / expires data per route segment , rather than per full url . an example of what this means in practical terms is that shared layouts are deduplicated in the cache , resulting in less bandwidth . there are other benefits we have in mind but that ' s the starting point . i ' ve tried to extract the work here into reasonably - sized commits ( many of which have already landed ) but this one here is sorta unavoidably large . here are the main pieces : - [ segment - cache / cache . ts ] ( https : / / github . com / acdlite / next . js / blob / initial - implementation - client - segment - cache / packages / next / src / client / components / segment - cache / cache . ts ) : this module is where the cache entries are maintained in memory . an important design principle is that you must be able to read from the cache synchronously without awaiting any promises . we avoid the use of async / await wherever possible ; instead , async tasks write their results directly into the cache . this also helps to avoid race conditions . currently there ' s no eviction policy other than stale time , but eventually we ' ll use an lru for memory management . - [ segment - cache / scheduler . ts ] ( https : / / github . com / acdlite / next . js / blob / initial - implementation - client - segment - cache / packages / next / src / client / components / segment - cache / scheduler . ts ) : this module is primarily a task scheduler . it ' s also used to manage network bandwidth . the design is inspired by react suspense and rust futures â€” tasks are pull - based , not push - based . the backing data structure is a minheap / priorityqueue , to support efficient reprioritization of tasks . - [ segment - cache / navigation . ts ] ( https : / / github . com / acdlite / next . js / blob / initial - implementation - client - segment - cache / packages / next / src / client / components / segment - cache / navigation . ts ) : this module is responsible for creating a snapshot of the cache at the time of a navigation . right now it ' s mostly a bunch of glue code to interop with the data structures used by the rest of the app router , like cachenodeseeddata and flightrouterstate . the long term plan is to move everything to using the segment cache and refactoring those data structures . additional explanations are provided inline .
623	revert " [ dynamicio ] warn for disallowed dynamic in dev " ( # 71566 ) we ' re going to land this after 15 . reverts vercel / next . js # 71526
624	[ dev - overlay ] fix link styling on hydration errors ( # 75792 ) fix the link style to match the design # # # # after <img width = " 707 " alt = " image " src = " https : / / github . com / user - attachments / assets / a9734833 - 8e28 - 4bfd - 9155 - b39a06fc275c " / > # # # # before <img width = " 693 " alt = " image " src = " https : / / github . com / user - attachments / assets / a089af37 - e8b0 - 490c - 842c - f4fa9bca9275 " / >
625	fix : don ' t bail out of prefetch if head is missing ( # 82216 ) this fixes an edge case where a link is prefetched with prefetch = { true } , and the target page has a dynamic head , but the head is not fully prefetched . if all the segment data for the target page was already cached , the prefetch scheduler would bail out and skip the request . however , we typically rely on the data prefetch to fetch the metadata , so by skipping the data prefetch we were effectively also skipping the metadata . the fix in this pr is to check for this condition before bailing out of the request , and initiate a request anyway . however , this illustrates that we ' re not modeling the caching of metadata in a complete way . currently it ' s stored on the same cache entry as the route tree , but they are not always fetched simultaneously ( as in this regression case ) , so their lifetimes are not always aligned . we should consider either always fetching the metadata as part of the route tree prefetch , or caching metadata on a separate entry type . this would allow us to dedupe entries between urls that rewrite to the same route , like we already do for segments . the circumstances that lead to this scenario are relatively rare , though , hence the temporary solution in this pr .
626	chore ( ci ) : configure automated benchmark for turbopack ( # 79791 ) # # # what ? this pr configures an automated benchmark for turbopack . we can run small benchmarks for all turbopack prs , and i ' ll add more benchmarks with follow - up prs . # # # why ? we need a way to track performance consistently .
627	add support for ipv6 in tests ( # 66285 ) using the hostname ` : : ` enables dual - stack support . this prevents ` econnrefused ` errors when running tests locally , and ` localhost ` being resolved to ` : : 1 ` ( ipv6 ) instead of ` 127 . 0 . 0 . 1 ` ( ipv4 ) .
628	[ turbopack ] concurrent write batches and little endian encoding ( # 72929 ) # # # what ? allow keyvaluedatabase to implement to variants of writebatches * serial : it ' s not send + sync and writing takes a ` & mut self ` * concurrent : it ' s send + sync and writing takes a ` & self ` when using the concurrent variant we can avoid buffering the intermediate results and write that directly to the write batch . but the database need to take care of handling concurrency .
629	perf ( turbopack ) : remove needless alloc for aqmf ( # 80468 ) # # # what ? trivial ` cow ` optimization for aqmf data # # # why ? we can avoid calling ` to_vec ( ) ` on this data , and according to the profiling result , compression was a memory hog .
630	test : fix more runtime / recoverable error flakiness in hmr ( # 79371 ) follow - up to # 79254 , there ' s one more test flaking with the same issue . i pulled the label - ignoring logic out into ` ` ` ts expect ( browser ) . todisplayredbox ( ' . . . ' , { label : false } ) ` ` ` so that it ' s easy to find these later when we fix the underlying issue .
631	[ turbopack ] tweak the doc on the inner graph optimization ( # 84752 ) this optimization is enabled by default and we already link to the docs so referencing the configuration option is more misleading than helpful . fixes https : / / github . com / vercel / feedback / issues / 111264
632	fix : change duplicated post method to put method ( # 70308 ) # # # what ? non - static http methods contain ` put ` method , but there are two ` post ` methods . # # # how ? change one ` post ` method to ` put ` method co - authored - by : jj kasper <jj @ jjsweb . site>
633	refactor ( turbopack - ecmascript ) use resolvedvc in esmexport type ( # 74508 ) this removes the ` local ` opt - out from ` esmexports ` .
634	[ segment cache ] add act - inspired internal router testing helper ( # 74668 ) adds an internal test utility for e2e testing of requests initiated by the next . js router , such as prefetches and navigations . calls the given async function then intercepts any router requests that are initiated as a result . it will then wait for all the requests to complete before exiting . inspired by the react ` act ` api . i generally dislike early testing abstractions , but getting all the details right for intercepting the requests with playwright ended up being non - trivial enough that i relented and extracted it to a separate module , in the ` e2e / app - dir / segment - cache ` folder . i ' ll hold off moving it to somewhere even more generic until it ' s proven to be useful . example : ` ` ` js / / asserts that rendering a link results in a prefetch response that / / contains some expected substring await act ( async ( ) = > { await reveallink ( ) } , { includes : ' subset of linked page content ' } ) ` ` ` a few goals here : - as much as possible , avoid coupling to internal implementation details . for example , it will check for the presence of the " rsc " header to determine if a request was initiated by the router , but that ' s about it . - no timers , no race conditions . it works by intercepting the requests at the playwright network layer . there should be no long pauses when running the tests , and if an assertion fails , it should fail quickly . - account for next . js ' s internal bandwidth throttling . the router does not initiate more than a fixed number of requests at a time , so every time a request is fulfilled , it has the potential to unblock more prefetches . so we must wait a task to check for additional requests . this is similar to what react ' s ` act ` implementation does to account for asynchronous rendering tasks .
635	update font data ( # 79179 )
636	docs : scrub html in ` ld + json ` script ( # 79627 ) closes : https : / / linear . app / vercel / issue / doc - 4708 / json - ld - security - w - jsonstringify fixes : https : / / github . com / vercel / next . js / issues / 79593
637	alternate bundler : show state in app info message ( # 77259 ) when next starts , in either ` next dev ` or ` next start ` , we log a message that includes turbopack state ( ` â–² next . js 15 . 3 . 0 - canary . 12 ( turbopack ) ` ) . this implements it for rspack as well . test plan : configure the rspack plugin and start ` next dev ` . confirm ` â–² next . js 15 . 3 . 0 - canary . 12 ( rspack ) ` is shown . run ` next dev - - turbopack ` . verify turbopack is shown instead .
638	update rspack development test manifest ( # 83407 ) this auto - generated pr updates the development integration test manifest used when testing rspack .
639	docs : verbose troubleshooting for unconfigured hosts ( # 84271 ) closes : https : / / linear . app / vercel / issue / doc - 5151 / unconfigured - image - host - - - - - - - - - co - authored - by : rich haines <hello @ richardhaines . dev>
640	turbopack : remove a few clones ( # 82435 ) showed up in an ast - grep search for ` & $ $ $ . clone ( ) `
641	[ metadata ] move metadata rendering adjacent to page component ( # 74262 )
642	test : confirm that middleware may affect sitemap . xml render ( # 69140 ) add test to confirm that the middleware affects the sitemap path if the matcher is misconfigured . following of https : / / github . com / vercel / next . js / pull / 69136 closes ndx - 221
643	add nft bundle to ssrchunk ( # 72305 ) a small pr to start inserting nft on the critical path . this is only enabled in production builds and implements the bare minimum to get nft outputs by inserting it into the server assets . followed up by another pr and inserts more hooks / flags elsewhere in the apis .
644	docs : added ` use cache : remote ` docs ( # 85145 )
645	examples : reduce typegen boilerplate in sanity example ( # 69134 )
646	destructure loadcomponents where possible ( # 82986 ) # # what ? more preparation work for removing manifest loading from loadcomponents . no changes to how things function , only making it clearer what is used from loadcomponents in each place it is used .
647	remove unused nccd node - fetch ( # 76241 ) this vendored packaged is no longer needed as we removed the last usage of it . x - ref : https : / / github . com / vercel / next . js / pull / 75741
648	fix ( after ) : allow reading draftmode status in after ( # 73324 ) ` after ` was too restrictive with ` draftmode ` - - we generally allow reading ` draftmode ( ) . isenabled ` anywhere . this is because it isn ' t really a dynamic api - - it ' s fine to call it in prerender / ' use cache ' contexts , because we can just prerender / cache it as ` isenabled = false ` , and when it ' s on , it switches everything to dynamic rendering anyway , so that prerender / cache entry is ignored . however we disallow ` draftmode ( ) . enable ( ) / disable ( ) ` in ` after ` , because those methods set a cookie , and ` after ` executes too late for that . * ( nothing here will change in the upcoming ` after ` behavior update - - we fundamentally can ' t get more permissive than this ) *
649	update turbopack production test manifest ( # 77872 ) this auto - generated pr updates the production integration test manifest used when testing turbopack .
650	add test for js resource size on navigation ( # 83731 )
651	send initialcanonicalurl in array format to fix crawler issues ( # 69370 ) the initial rsc payload currently provides the ` initialcanonicalurl ` value to initialize the router state during the ssr render . however as noted in # 53274 , it seems crawlers like googlebot will crawl anything url - like that it finds in the document , regardless of whether or not it ' s actually rendered as a link somewhere ( which this isn ' t ) . this splits the ` initialcanonicalurl ` value into parts and then joins it when it ' s ready to be consumed . that way when it ' s embedded in the document , it ' s not in a path - like format . fixes # 53274 closes ndx - 243
652	refactor ( turbopack ) : remove ` swc_css ` ( # 72602 ) # # # what ? remove ` swc_css ` from turbopack . it would not break the existing codebase , so it ' s fine .
653	perf ( turbopack / rcstr ) : precompute hash for equality bailout ( # 78943 ) # # # what ? precompute hash for ` rcstr ` and use it for equality bailout . # # # why ? we have lots of ` rcstr ` in key positions of the hashmap , so adding a fast bailout path to ` = = ` improved the performance . x - ref : https : / / vercel . slack . com / archives / c06ppgz0fd3 / p1746715835436899 ? thread_ts = 1746658944 . 635819 & cid = c06ppgz0fd3
654	update multi - zones . mdx ( # 78812 ) to serve the static content from the right application you also need a rewrite rule for the static assets and not only the actual content . fixes : # 78811 co - authored - by : jj kasper <jj @ jjsweb . site>
655	remove params from segment path ( # 82249 ) when performing a segment prefetch , we send a " segment path " to the server , which represents the particular segment that we ' re requesting . originally , i thought these needed to fully encode all the param values , but since we already request the segments within the context of a particular target page , it ' s unnecessary â€” the base url already contains all the param information ( and is indeed the source of truth for where the param values come from ) . the only thing we need to put in the paths are the param names . on the client , though , these segments are cached across pages ( that ' s the whole point of the segment cache ) . so in the prefetch cache , we do need to cache them by their concrete param values . splitting out the param names and the param values into separate keys will allow us to implement " fallback ppr " behavior for the client , where if a segment entry does not reference a particular param , it can be reused for all possible values of that param . ( we already do this for search strings . ) for now , i ' ve split the current " segment path " key into two separate keys , which i ' m calling the " cache key " and the " request key " . it ' s a bit confusing since we have so many different types of cache keys , but i think it ' s ok for now â€” this will be refactored soon anyway to support the fallback ppr behavior . despite the line count , most of this pr is just a mechanical refactor . most of it was done by tab completion in cursor . the substance of the change is in the ` segment - value - encoding . ts ` file .
656	allow intercepting dynamic routes to be partially prerendered ( # 80851 ) for intercepting dynamic routes we do prerender ` . prefetch . rsc ` , as well as ` . segment . rsc ` files if ` clientsegmentcache ` is enabled . however , we omitted adding those routes to the prerender manifest , which resulted in server errors when looking up the rsc files . i ' ve added two tests to verify the one - line fix , one in ` test / e2e / app - dir / parallel - routes - and - interception ` ( relevant when tests are run with ` __next_experimental_ppr = true ` ) , and one in ` test / e2e / app - dir / segment - cache / basic ` ( has ` dynamicio ` and ` clientsegmentcache ` enabled ) . both tests are written in the style of the existing tests in the respective test suites . - - - - - - - - - co - authored - by : jimmy lai <laijimmy0 @ gmail . com>
657	update turbopack development test manifest ( # 77605 ) this auto - generated pr updates the development integration test manifest used when testing turbopack .
658	make ` notfound ( ) ` work in ` " use cache " ` page ( # 73210 ) when ` notfound ( ) ` is called in a ` " use cache " ` function , we need to make sure that the custom error digest is included in the serialized rsc payload . otherwise the ` httpaccessfallbackerrorboundary ` won ' t be able to detect the error as an ` httpaccessfallbackerror ` . ` createflightreactservererrorhandler ` already handles forwarding the digest correctly for router errors ( and other next - internal errors ) , so we can just reuse it . fixes # 73130
659	update build - complete for adapter api ( # 82452 ) this adds some additional api surface for ` build - complete ` adapter hook . wiring up prerenders and additional configs .
660	turbopack : use bail in track_glob_internal ( # 83350 ) eventual consistency strikes again ( ? )
661	[ turbopack ] remove unused no_move_vec code ( # 81141 ) a ` pub use ` statement was obscuring that half the code is dead .
662	[ perf ] skip loading client manifest for static metadata routes ( # 77260 ) # # # what during development we had a retry logic to load the client manifest for app router routes , which is the requirement since # 74835 . but for static metadata routes like ` favicon . ico ` it doesn ' t generate client manifest , loading it will cause extra loading time . refactoring the metadata helpers to determine the static metadata routes more strictly , mostly only cover the image one as their pathname and entry filename is pretty consistent . for sitemap or robots . txt it ' s still fine to leave as it in dev for now . the delay is mostly waiting for manifest . long term goal is to build the static metadata routes as static output rather than compile each time .
663	refactor ( turbo - tasks ) : remove some ` format_description ` logic from memory backend ( # 69472 ) # 69663 made improvements to the display logic , we don ' t need as much logic here .
664	sync - react : remove redundant work ( # 69199 )
665	docs : fix forbidden file paths ( # 73575 ) noticed this while reviewing the docs - - unauthorized is fine , but forbidden has incorrect file paths for the examples .
666	fix ` unstable_allowdynamic ` when used with pnpm ( # 73732 ) when using dependencies in middleware that make use of dynamic code evaluation , next . js emits a build error because this is not supported in the edge runtime . in rare cases , when the code can not be reached at runtime and can ' t be removed by tree - shaking , users might opt in to using the ` unstable_allowdynamic ` config . when combined with pnpm , the provided glob patterns as documented at https : / / nextjs . org / docs / messages / edge - dynamic - code - evaluation # possible - ways - to - fix - it did not match correctly because of pnpm ' s use of the ` . pnpm ` directory . to fix the pattern matching , we need to provide the ` dot ` option to [ picomatch ] ( https : / / github . com / micromatch / picomatch ) , which enables dotfile matching . _side note : ideally we would detect dynamic code evaluation after tree shaking , to reduce the number of cases where users need to revert to using ` unstable_allowdynamic ` . _ fixes # 51401
667	docs : type helpers don ' t need to be imported ( # 84265 ) let ' s be more clear about the usage of these types .
668	chore ( ci ) : line - wrap afterbuild blocks in build_and_test . yml ( # 78718 ) as part of # 76251 i rewrote the ` afterbuild ` job from : ` ` ` yaml - run : / bin / bash - c " $ { { inputs . afterbuild } } " ` ` ` to ` ` ` yaml - run : $ { { inputs . afterbuild } } # defaults . run . shell sets a stronger options ( ` - leo pipefail ` ) # set this back to github action ' s weaker defaults : # https : / / docs . github . com / en / actions / writing - workflows / workflow - syntax - for - github - actions # jobsjob_idstepsshell # # we must use a login shell : fnm installation may modify the ` . profile ` shell : bash - le { 0 } ` ` ` so it should handle escaping and line wrapping without problems now . because we run ` bash ` with ` - e ` , failed commands should abort the entire script , so ` & & ` shouldn ' t be needed everywhere .
669	revert changing bundler for runtime bundle but keep externals fix ( # 75412 ) this reverts the bundler change part while we investigate source map issue but keeps the externals optimize preventing the runtime bundle from inflating back to over ` 4mb ` . this reverts commit 98b0700e9746387ce63ac715d300be82100dce55 this reverts commit 04c3f0b29cbf21381202da98085b937b25689afe
670	[ devtools ] panel ui responsiveness ( # 80732 ) https : / / github . com / user - attachments / assets / a15165f2 - e340 - 4ec6 - a3e1 - a895bfac1531 closes next - 4548
671	update turborepo env in workflows ( # 84879 ) this removes un - used turborepo env values from our workflows .
672	respect webpackignore and turboignore comments in the parser ( # 68451 ) # # what this is step one of pack - 3046 , setting up the necessary parser - side changes to detect and store the webpackignore and turbopackignore comment directives . this is followed by another pr that implements the bundler side . # # why webpack supports special directives to prevent bundle - time linking of specific imports . some libraries need this ( mapbox ) and so we should support it . # # how the directives are stored in comments within ` require ` and ` import ` calls . we parse the comments alongside traversal and look for comments that exist inside the function calls . these are then collected and used in later stages when performing linking to opt out of linking packages that have been explicitly excluded .
673	[ sourcemaps ] properly devirtualize ` rsc : ` urls ( # 81554 )
